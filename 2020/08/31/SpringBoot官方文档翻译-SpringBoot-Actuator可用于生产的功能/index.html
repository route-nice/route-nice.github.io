<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Spring Boot 包含许多附加功能，可在您将应用程序投入生产时帮助您监视和 Management 应用程序。您可以选择使用 HTTP 端点或 JMX Management 和监视您的应用程序。审核，运行状况和 Metrics 收集也可以自动应用于您的应用程序。">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringBoot官方文档翻译-SpringBoot-Actuator可用于生产的功能">
<meta property="og:url" content="http://yoursite.com/2020/08/31/SpringBoot%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91-SpringBoot-Actuator%E5%8F%AF%E7%94%A8%E4%BA%8E%E7%94%9F%E4%BA%A7%E7%9A%84%E5%8A%9F%E8%83%BD/index.html">
<meta property="og:site_name" content="Route-nice">
<meta property="og:description" content="Spring Boot 包含许多附加功能，可在您将应用程序投入生产时帮助您监视和 Management 应用程序。您可以选择使用 HTTP 端点或 JMX Management 和监视您的应用程序。审核，运行状况和 Metrics 收集也可以自动应用于您的应用程序。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-08-31T03:41:40.000Z">
<meta property="article:modified_time" content="2020-09-07T02:34:47.222Z">
<meta property="article:author" content="Route-nice">
<meta property="article:tag" content="SpringBoot">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2020/08/31/SpringBoot%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91-SpringBoot-Actuator%E5%8F%AF%E7%94%A8%E4%BA%8E%E7%94%9F%E4%BA%A7%E7%9A%84%E5%8A%9F%E8%83%BD/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>SpringBoot官方文档翻译-SpringBoot-Actuator可用于生产的功能 | Route-nice</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?8b3aabf954a120e5a2920d31f3600013";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Route-nice</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/31/SpringBoot%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91-SpringBoot-Actuator%E5%8F%AF%E7%94%A8%E4%BA%8E%E7%94%9F%E4%BA%A7%E7%9A%84%E5%8A%9F%E8%83%BD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Route-nice">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Route-nice">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          SpringBoot官方文档翻译-SpringBoot-Actuator可用于生产的功能
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-08-31 11:41:40" itemprop="dateCreated datePublished" datetime="2020-08-31T11:41:40+08:00">2020-08-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-07 10:34:47" itemprop="dateModified" datetime="2020-09-07T10:34:47+08:00">2020-09-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SpringIO/" itemprop="url" rel="index"><span itemprop="name">SpringIO</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2020/08/31/SpringBoot%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91-SpringBoot-Actuator%E5%8F%AF%E7%94%A8%E4%BA%8E%E7%94%9F%E4%BA%A7%E7%9A%84%E5%8A%9F%E8%83%BD/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/08/31/SpringBoot官方文档翻译-SpringBoot-Actuator可用于生产的功能/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>Spring Boot 包含许多附加功能，可在您将应用程序投入生产时帮助您监视和 Management 应用程序。您可以选择使用 HTTP 端点或 JMX Management 和监视您的应用程序。审核，运行状况和 Metrics 收集也可以自动应用于您的应用程序。</p>
<a id="more"></a>
<h1 id="启用生产就绪功能"><a href="#启用生产就绪功能" class="headerlink" title="启用生产就绪功能"></a>启用生产就绪功能</h1><p><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator">spring-boot-actuator</a>模块提供了 Spring Boot 生产就绪的所有功能。启用功能的最简单方法是将依赖项添加到<code>spring-boot-starter-actuator</code>‘Starter’。</p>
<p>Actuator定义</p>
<p>致动器是一个制造业术语，指用于移动或控制某物的机械装置。执行器可以从一个微小的变化产生大量的运动。</p>
<p>要将 Actuator 添加到基于 Maven 的项目中，请添加以下“ Starter”依赖项：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>对于 Gradle，使用以下声明：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile(<span class="string">&quot;org.springframework.boot:spring-boot-starter-actuator&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Endpoints"><a href="#Endpoints" class="headerlink" title="Endpoints"></a>Endpoints</h1><p>Actuator 端点使您可以监视应用程序并与之交互。 Spring Boot 包含许多内置端点，可让您添加自己的端点。例如，<code>health</code>端点提供基本的应用程序运行状况信息。</p>
<p>每个端点可以是<a href="#启用端点">启用或禁用</a>。这控制了是否创建了端点以及它的 bean 在应用程序上下文中是否存在。要远程访问，端点也必须是<a href="#暴露端点">通过 JMX 或 HTTP 公开</a>。大多数应用程序选择 HTTP，其中终结点的 ID 和前缀<code>/actuator</code>Map 到 URL。例如，默认情况下，<code>health</code>端点 Map 到<code>/actuator/health</code>。</p>
<p>可以使用以下与技术无关的端点：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>ID</th>
<th>Description</th>
<th>默认启用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>auditevents</code></td>
<td>公开当前应用程序的审核事件信息。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>beans</code></td>
<td>显示应用程序中所有 Spring Bean 的完整列表。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>caches</code></td>
<td>公开可用的缓存。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>conditions</code></td>
<td>显示在配置和自动配置类上评估的条件以及它们匹配或不匹配的原因。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>configprops</code></td>
<td>显示所有<code>@ConfigurationProperties</code>的整理列表。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>env</code></td>
<td>从 Spring 的<code>ConfigurableEnvironment</code>公开属性。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>flyway</code></td>
<td>显示已应用的所有 Flyway 数据库迁移。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>health</code></td>
<td>显示应用程序运行状况信息。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>httptrace</code></td>
<td>显示 HTTP 跟踪信息(默认情况下，最近 100 个 HTTP 请求-响应交换)。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>info</code></td>
<td>显示任意应用程序信息。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>integrationgraph</code></td>
<td>显示 Spring Integration 图。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>loggers</code></td>
<td>显示和修改应用程序中 Logger 的配置。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>liquibase</code></td>
<td>显示已应用的所有 Liquibase 数据库迁移。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>metrics</code></td>
<td>显示当前应用程序的“Metrics”信息。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>mappings</code></td>
<td>显示所有<code>@RequestMapping</code>路径的整理列表。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>scheduledtasks</code></td>
<td>显示应用程序中的计划任务。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>sessions</code></td>
<td>允许从 Spring Session 支持的会话存储中检索和删除用户会话。使用 Spring Session 对反应式 Web 应用程序的支持时不可用。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>shutdown</code></td>
<td>使应用程序正常关闭。</td>
<td>No</td>
</tr>
<tr>
<td><code>threaddump</code></td>
<td>执行线程转储。</td>
<td>Yes</td>
</tr>
</tbody>
</table>
</div>
<p>如果您的应用程序是 Web 应用程序(Spring MVC，Spring WebFlux 或 Jersey)，则可以使用以下附加端点：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>ID</th>
<th>Description</th>
<th>默认启用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>heapdump</code></td>
<td>返回一个<code>hprof</code>堆转储文件。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>jolokia</code></td>
<td>通过 HTTP 公开 JMX bean(当 Jolokia 在 Classpath 上时，不适用于 WebFlux)。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>logfile</code></td>
<td>返回日志文件的内容(如果已设置<code>logging.file</code>或<code>logging.path</code>属性)。支持使用 HTTP <code>Range</code>Headers 来检索部分日志文件的内容。</td>
<td>Yes</td>
</tr>
<tr>
<td><code>prometheus</code></td>
<td>以 Prometheus 服务器可以抓取的格式公开 Metrics。</td>
<td>Yes</td>
</tr>
</tbody>
</table>
</div>
<p>要了解有关 Actuator 端点及其请求和响应格式的更多信息，请参阅单独的 API 文档(<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/actuator-api//html">HTML</a>或<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/actuator-api//pdf/spring-boot-actuator-web-api.pdf">PDF</a>)。</p>
<h2 id="启用端点"><a href="#启用端点" class="headerlink" title="启用端点"></a>启用端点</h2><p>默认情况下，除<code>shutdown</code>之外的所有端点均处于启用状态。要配置端点的启用，请使用其<code>management.endpoint.&lt;id&gt;.enabled</code>属性。以下示例启用<code>shutdown</code>端点：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.endpoint.shutdown.enabled</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>
<p>如果您宁愿选择启用端点启用而不是选择退出，请将<code>management.endpoints.enabled-by-default</code>属性设置为<code>false</code>并使用单个端点<code>enabled</code>属性选择重新加入。以下示例启用<code>info</code>端点并禁用所有其他端点：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.endpoints.enabled-by-default</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">management.endpoint.info.enabled</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note</p>
<p>禁用的端点将从应用程序上下文中完全删除。如果您只想更改端点公开的技术，请改用<a href="#暴露端点">包含和排除属性</a>。</p>
</blockquote>
<h2 id="暴露端点"><a href="#暴露端点" class="headerlink" title="暴露端点"></a>暴露端点</h2><p>由于端点可能包含敏感信息，因此应谨慎考虑何时公开它们。下表显示了内置端点的默认暴露：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>ID</th>
<th>JMX</th>
<th>Web</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>auditevents</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>beans</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>caches</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>conditions</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>configprops</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>env</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>flyway</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>health</code></td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td><code>heapdump</code></td>
<td>N/A</td>
<td>No</td>
</tr>
<tr>
<td><code>httptrace</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>info</code></td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td><code>integrationgraph</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>jolokia</code></td>
<td>N/A</td>
<td>No</td>
</tr>
<tr>
<td><code>logfile</code></td>
<td>N/A</td>
<td>No</td>
</tr>
<tr>
<td><code>loggers</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>liquibase</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>metrics</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>mappings</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>prometheus</code></td>
<td>N/A</td>
<td>No</td>
</tr>
<tr>
<td><code>scheduledtasks</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>sessions</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>shutdown</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>threaddump</code></td>
<td>Yes</td>
<td>No</td>
</tr>
</tbody>
</table>
</div>
<p>要更改公开哪些端点，请使用以下特定于技术的<code>include</code>和<code>exclude</code>属性：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Property</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>management.endpoints.jmx.exposure.exclude</code></td>
<td></td>
</tr>
<tr>
<td><code>management.endpoints.jmx.exposure.include</code></td>
<td><code>*</code></td>
</tr>
<tr>
<td><code>management.endpoints.web.exposure.exclude</code></td>
<td></td>
</tr>
<tr>
<td><code>management.endpoints.web.exposure.include</code></td>
<td><code>info, health</code></td>
</tr>
</tbody>
</table>
</div>
<p><code>include</code>属性列出了公开的端点的 ID。 <code>exclude</code>属性列出了不应公开的端点的 ID。 <code>exclude</code>属性优先于<code>include</code>属性。 <code>include</code>和<code>exclude</code>属性都可以使用端点 ID 列表进行配置。</p>
<p>例如，要停止通过 JMX 公开所有端点，而仅公开<code>health</code>和<code>info</code>端点，请使用以下属性：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.endpoints.jmx.exposure.include</span>=<span class="string">health,info</span></span><br></pre></td></tr></table></figure>
<p><code>*</code>可用于选择所有端点。例如，要通过 HTTP 公开除<code>env</code>和<code>beans</code>端点之外的所有内容，请使用以下属性：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.endpoints.web.exposure.include</span>=<span class="string">*</span></span><br><span class="line"><span class="meta">management.endpoints.web.exposure.exclude</span>=<span class="string">env,beans</span></span><br></pre></td></tr></table></figure>
<p>Note</p>
<p><code>*</code>在 YAML 中具有特殊含义，因此，如果要包括(或排除)所有端点，请确保添加引号，如以下示例所示：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line"><span class="attr">endpoints:</span></span><br><span class="line"><span class="attr">web:</span></span><br><span class="line"><span class="attr">exposure:</span></span><br><span class="line"><span class="attr">include:</span> <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note</p>
<p>如果您的申请公开公开，我们强烈建议您也<a href="#保护HTTP端点">保护您的端点</a>。</p>
<p>Tip</p>
<p>如果要针对暴露端点的时间实施自己的策略，则可以注册<code>EndpointFilter</code> bean。</p>
</blockquote>
<h2 id="保护HTTP端点"><a href="#保护HTTP端点" class="headerlink" title="保护HTTP端点"></a>保护HTTP端点</h2><p>您应该像对待其他任何敏感 URL 一样，小心保护 HTTP 端点的安全。如果存在 Spring Security，则默认情况下使用 Spring Security 的内容协商策略保护端点的安全。例如，如果您希望为 HTTP 端点配置自定义安全性，只允许具有特定角色的用户访问它们，Spring Boot 提供了一些方便的<code>RequestMatcher</code>对象，可以将它们与 Spring Security 结合使用。</p>
<p>典型的 Spring Security 配置可能类似于以下示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ActuatorSecurity</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http.requestMatcher(EndpointRequest.toAnyEndpoint()).authorizeRequests()</span><br><span class="line">                .anyRequest().hasRole(<span class="string">&quot;ENDPOINT_ADMIN&quot;</span>)</span><br><span class="line">                .and()</span><br><span class="line">            .httpBasic();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>前面的示例使用<code>EndpointRequest.toAnyEndpoint()</code>将请求匹配到任何端点，然后确保所有角色都具有<code>ENDPOINT_ADMIN</code>角色。 <code>EndpointRequest</code>上还有其他几种匹配器方法。有关详细信息，请参见 API 文档(<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/actuator-api//html">HTML</a>或<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/actuator-api//pdf/spring-boot-actuator-web-api.pdf">PDF</a>)。</p>
<p>如果将应用程序部署在防火墙后面，则可能希望可以在不进行身份验证的情况下访问所有 Actuator 端点。您可以通过更改<code>management.endpoints.web.exposure.include</code>属性来做到这一点，如下所示：</p>
<p><strong>application.properties.</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.endpoints.web.exposure.include</span>=<span class="string">*</span></span><br></pre></td></tr></table></figure>
<p>此外，如果存在 Spring Security，则需要添加自定义安全配置，该配置允许未经身份验证的端点访问，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ActuatorSecurity</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http.requestMatcher(EndpointRequest.toAnyEndpoint()).authorizeRequests()</span><br><span class="line">            .anyRequest().permitAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="配置端点"><a href="#配置端点" class="headerlink" title="配置端点"></a>配置端点</h2><p>端点自动缓存对不带任何参数的读取操作的响应。要配置端点缓存响应的时间，请使用其<code>cache.time-to-live</code>属性。以下示例将<code>beans</code>终结点的缓存的生存时间设置为 10 秒：</p>
<p><strong>application.properties.</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.endpoint.beans.cache.time-to-live</span>=<span class="string">10s</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note</p>
<p>前缀<code>management.endpoint.&lt;name&gt;</code>用于唯一标识正在配置的端点。</p>
<p>Note</p>
<p>发出经过身份验证的 HTTP 请求时，<code>Principal</code>被视为端点的 Importing，因此将不缓存响应。</p>
</blockquote>
<h2 id="用于ActuatorWeb端点的超媒体"><a href="#用于ActuatorWeb端点的超媒体" class="headerlink" title="用于ActuatorWeb端点的超媒体"></a>用于ActuatorWeb端点的超媒体</h2><p>添加了“发现页面”以及指向所有端点的链接。默认情况下，“发现页面”在<code>/actuator</code>上可用。</p>
<p>配置自定义 Management 上下文路径后，“发现页面”会自动从<code>/actuator</code>移到 Management 上下文的根目录。例如，如果 Management 上下文路径为<code>/management</code>，则可从<code>/management</code>访问发现页面。当 Management 上下文路径设置为<code>/</code>时，将禁用发现页面，以防止与其他 Map 发生冲突的可能性。</p>
<h2 id="CORS支持"><a href="#CORS支持" class="headerlink" title="CORS支持"></a>CORS支持</h2><p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">跨域资源共享</a>(CORS)是<a target="_blank" rel="noopener" href="https://www.w3.org/TR/cors/">W3C specification</a>，它使您可以灵活地指定授权哪种类型的跨域请求。如果使用 Spring MVC 或 Spring WebFlux，则可以将 Actuator 的 Web 端点配置为支持此类方案。</p>
<p>默认情况下，CORS 支持是禁用的，只有在设置<code>management.endpoints.web.cors.allowed-origins</code>属性后才启用。以下配置允许来自<code>example.com</code>域的<code>GET</code>和<code>POST</code>调用：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.endpoints.web.cors.allowed-origins</span>=<span class="string">http://example.com</span></span><br><span class="line"><span class="meta">management.endpoints.web.cors.allowed-methods</span>=<span class="string">GET,POST</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Tip</p>
<p>有关选项的完整列表，请参见<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/endpoint/web/CorsEndpointProperties.java">CorsEndpointProperties</a>。</p>
</blockquote>
<h2 id="实现自定义端点"><a href="#实现自定义端点" class="headerlink" title="实现自定义端点"></a>实现自定义端点</h2><p>如果添加带有<code>@Endpoint</code>Comments 的<code>@Bean</code>，则带有<code>@ReadOperation</code>，<code>@WriteOperation</code>或<code>@DeleteOperation</code>Comments 的任何方法都将通过 JMX 以及 Web 应用程序中的 HTTP 自动公开。可以使用 Jersey，Spring MVC 或 Spring WebFlux 通过 HTTP 公开端点。</p>
<p>您还可以使用<code>@JmxEndpoint</code>或<code>@WebEndpoint</code>编写技术特定的端点。这些端点仅限于其各自的技术。例如，<code>@WebEndpoint</code>仅通过 HTTP 而不是 JMX 公开。</p>
<p>您可以使用<code>@EndpointWebExtension</code>和<code>@EndpointJmxExtension</code>编写技术特定的扩展。这些 Comments 使您可以提供特定于技术的操作来扩展现有端点。</p>
<p>最后，如果您需要访问特定于 Web 框架的功能，则可以实现 Servlet 或 Spring <code>@Controller</code>和<code>@RestController</code>端点，但代价是它们无法通过 JMX 或使用其他 Web 框架使用。</p>
<h3 id="接收输入"><a href="#接收输入" class="headerlink" title="接收输入"></a>接收输入</h3><p>端点上的操作通过其参数接收 Importing。通过网络公开时，这些参数的值取自 URL 的查询参数和 JSON 请求正文。通过 JMX 公开时，参数将 Map 到 MBean 操作的参数。默认情况下，参数是必需的。可以通过使用<code>@org.springframework.lang.Nullable</code>对其进行 Comments 来使它们成为可选的。</p>
<p>JSON 请求正文中的每个根属性都可以 Map 到端点的参数。考虑以下 JSON 请求正文：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;counter&quot;</span>: <span class="number">42</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这可用于调用采用<code>String name</code>和<code>int counter</code>参数的写操作。</p>
<blockquote>
<p>Tip</p>
<p>由于端点与技术无关，因此只能在方法签名中指定简单类型。特别是，不支持使用定义<code>name</code>和<code>counter</code>属性的自定义类型声明单个参数。</p>
<p>Note</p>
<p>为了将 ImportingMap 到操作方法的参数，实现端点的 Java 代码应使用<code>-parameters</code>编译，而实现端点的 Kotlin 代码应使用<code>-java-parameters</code>编译。如果您使用的是 Spring Boot 的 Gradle 插件，或者您使用的是 Maven 和<code>spring-boot-starter-parent</code>，那么这将自动发生。</p>
</blockquote>
<h4 id="Importing类型转换"><a href="#Importing类型转换" class="headerlink" title="Importing类型转换"></a>Importing类型转换</h4><p>如有必要，传递给端点操作方法的参数会自动转换为所需的类型。在调用操作方法之前，使用<code>ApplicationConversionService</code>实例将通过 JMX 或 HTTP 请求接收的 Importing 转换为所需的类型。</p>
<h3 id="自定义Web端点"><a href="#自定义Web端点" class="headerlink" title="自定义Web端点"></a>自定义Web端点</h3><p>使用 Jersey，Spring MVC 或 Spring WebFlux 通过 HTTP 自动公开<code>@Endpoint</code>，<code>@WebEndpoint</code>或<code>@EndpointWebExtension</code>上的操作。</p>
<h4 id="Web端点请求预测"><a href="#Web端点请求预测" class="headerlink" title="Web端点请求预测"></a>Web端点请求预测</h4><p>对于在暴露于 Web 的端点上的每个操作，都会自动生成一个请求谓词。</p>
<h4 id="Path"><a href="#Path" class="headerlink" title="Path"></a>Path</h4><p>谓词的路径由终结点的 ID 和暴露于 Web 的终结点的基本路径确定。默认基本路径为<code>/actuator</code>。例如，ID 为<code>sessions</code>的端点将使用<code>/actuator/sessions</code>作为其在谓词中的路径。</p>
<p>通过使用<code>@Selector</code>Comments 操作方法的一个或多个参数，可以进一步自定义路径。将这样的参数作为路径变量添加到路径谓词。当端点操作被调用时，变量的值被传递到操作方法中。</p>
<h4 id="HTTP方法"><a href="#HTTP方法" class="headerlink" title="HTTP方法"></a>HTTP方法</h4><p>谓词的 HTTP 方法由操作类型决定，如下表所示：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Operation</th>
<th>HTTP method</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@ReadOperation</code></td>
<td><code>GET</code></td>
</tr>
<tr>
<td><code>@WriteOperation</code></td>
<td><code>POST</code></td>
</tr>
<tr>
<td><code>@DeleteOperation</code></td>
<td><code>DELETE</code></td>
</tr>
</tbody>
</table>
</div>
<h4 id="Consumes"><a href="#Consumes" class="headerlink" title="Consumes"></a>Consumes</h4><p>对于使用请求正文的<code>@WriteOperation</code>(HTTP <code>POST</code>)，谓词的消耗子句为<code>application/vnd.spring-boot.actuator.v2+json, application/json</code>。对于所有其他操作，消耗子句为空。</p>
<h4 id="Produces"><a href="#Produces" class="headerlink" title="Produces"></a>Produces</h4><p>谓词的 Produces 子句可以由<code>@DeleteOperation</code>，<code>@ReadOperation</code>和<code>@WriteOperation</code>注解的<code>produces</code>属性确定。该属性是可选的。如果未使用，则会自动确定 produces 子句。</p>
<p>如果操作方法返回<code>void</code>或<code>Void</code>，则 produces 子句为空。如果操作方法返回<code>org.springframework.core.io.Resource</code>，则 Produces 子句为<code>application/octet-stream</code>。对于所有其他操作，produces 子句为<code>application/vnd.spring-boot.actuator.v2+json, application/json</code>。</p>
<h4 id="Web端点响应状态"><a href="#Web端点响应状态" class="headerlink" title="Web端点响应状态"></a>Web端点响应状态</h4><p>端点操作的默认响应状态取决于操作类型(读，写或删除)以及该操作返回的内容(如果有)。</p>
<p><code>@ReadOperation</code>返回一个值，响应状态将为 200(确定)。如果未返回值，则响应状态将为 404(未找到)。</p>
<p>如果<code>@WriteOperation</code>或<code>@DeleteOperation</code>返回值，则响应状态将为 200(确定)。如果未返回值，则响应状态将为 204(无内容)。</p>
<p>如果在没有必需参数或无法将参数转换为必需类型的参数的情况下调用操作，则不会调用该操作方法，并且响应状态将为 400(错误请求)。</p>
<h4 id="Web端点范围请求"><a href="#Web端点范围请求" class="headerlink" title="Web端点范围请求"></a>Web端点范围请求</h4><p>HTTP 范围请求可用于请求 HTTP 资源的一部分。使用 Spring MVC 或 Spring Web Flux 时，返回<code>org.springframework.core.io.Resource</code>的操作自动支持范围请求。</p>
<blockquote>
<p>Note</p>
<p>使用 Jersey 时不支持范围请求。</p>
</blockquote>
<h4 id="Web端点安全"><a href="#Web端点安全" class="headerlink" title="Web端点安全"></a>Web端点安全</h4><p>Web 终结点或特定于 Web 的终结点扩展上的操作可以接收当前的<code>java.security.Principal</code>或<code>org.springframework.boot.actuate.endpoint.SecurityContext</code>作为方法参数。前者通常与<code>@Nullable</code>结合使用，以为经过身份验证和未经身份验证的用户提供不同的行为。后者通常用于使用其<code>isUserInRole(String)</code>方法执行授权检查。</p>
<h3 id="Servlet端点"><a href="#Servlet端点" class="headerlink" title="Servlet端点"></a>Servlet端点</h3><p>通过实现带有<code>@ServletEndpoint</code>Comments 的类(也可以实现<code>Supplier&lt;EndpointServlet&gt;</code>)，可以将<code>Servlet</code>公开为端点。 Servlet 端点提供了与 Servlet 容器的更深层集成，但以可移植性为代价。它们旨在用于将现有的<code>Servlet</code>公开为端点。对于新端点，应尽可能使用<code>@Endpoint</code>和<code>@WebEndpoint</code>注解。</p>
<h3 id="控制器端点"><a href="#控制器端点" class="headerlink" title="控制器端点"></a>控制器端点</h3><p><code>@ControllerEndpoint</code>和<code>@RestControllerEndpoint</code>可用于实现仅由 Spring MVC 或 Spring WebFlux 公开的端点。使用 Spring MVC 和 Spring WebFlux 的标准 Comments(例如<code>@RequestMapping</code>和<code>@GetMapping</code>)Map 方法，并将端点的 ID 用作路径的前缀。控制器端点提供了与 Spring Web 框架的更深层集成，但以可移植性为代价。尽可能使用<code>@Endpoint</code>和<code>@WebEndpoint</code>注解。</p>
<h2 id="健康信息"><a href="#健康信息" class="headerlink" title="健康信息"></a>健康信息</h2><p>您可以使用运行状况信息来检查正在运行的应用程序的状态。监视软件通常使用它在生产系统出现故障时向某人发出警报。 <code>health</code>端点公开的信息取决于<code>management.endpoint.health.show-details</code>属性，该属性可以配置以下值之一：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>never</code></td>
<td>详细信息永远不会显示。</td>
</tr>
<tr>
<td><code>when-authorized</code></td>
<td>详细信息仅显示给授权用户。可以使用<code>management.endpoint.health.roles</code>配置授权角色。</td>
</tr>
<tr>
<td><code>always</code></td>
<td>向所有用户显示详细信息。</td>
</tr>
</tbody>
</table>
</div>
<p>默认值为<code>never</code>。当用户担任一个或多个端点的角色时，该用户被视为已授权。如果端点没有配置的角色(默认值)，则所有通过身份验证的用户均被视为已授权。可以使用<code>management.endpoint.health.roles</code>属性配置角色。</p>
<blockquote>
<p>Note</p>
<p>如果您已保护应用程序安全并希望使用<code>always</code>，则安全配置必须允许经过身份验证的用户和未经身份验证的用户都可以访问运行状况端点。</p>
</blockquote>
<p>运行状况信息是从<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthIndicatorRegistry.java">HealthIndicatorRegistry</a>的内容中收集的(默认情况下，<code>ApplicationContext</code>中定义的所有<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthIndicator.java">HealthIndicator</a>实例。Spring Boot 包含许多自动配置的<code>HealthIndicators</code>，您也可以编写自己的实例。默认情况下，最终的系统状态由<code>HealthAggregator</code>根据状态的有序列表对每个<code>HealthIndicator</code>的状态进行排序。排序后的列表中的第一个状态用作整体运行状况。如果没有<code>HealthIndicator</code>返回<code>HealthAggregator</code>已知的状态，则使用<code>UNKNOWN</code>状态。</p>
<blockquote>
<p>Tip</p>
<p><code>HealthIndicatorRegistry</code>可用于在运行时注册和注销运行状况指示器。</p>
</blockquote>
<h3 id="自动配置的健康HealthIndicators"><a href="#自动配置的健康HealthIndicators" class="headerlink" title="自动配置的健康HealthIndicators"></a>自动配置的健康HealthIndicators</h3><p>适当时，Spring Boot 会自动配置以下<code>HealthIndicators</code>：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/cassandra/CassandraHealthIndicator.java">CassandraHealthIndicator</a></td>
<td>检查 Cassandra 数据库是否已启动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/couchbase/CouchbaseHealthIndicator.java">CouchbaseHealthIndicator</a></td>
<td>检查 Couchbase 群集是否已启动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/system/DiskSpaceHealthIndicator.java">DiskSpaceHealthIndicator</a></td>
<td>检查磁盘空间不足。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/jdbc/DataSourceHealthIndicator.java">DataSourceHealthIndicator</a></td>
<td>检查是否可以构建到<code>DataSource</code>的连接。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/elasticsearch/ElasticsearchHealthIndicator.java">ElasticsearchHealthIndicator</a></td>
<td>检查 Elasticsearch 集群是否已启动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/influx/InfluxDbHealthIndicator.java">InfluxDbHealthIndicator</a></td>
<td>检查 InfluxDB 服务器是否已启动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/jms/JmsHealthIndicator.java">JmsHealthIndicator</a></td>
<td>检查 JMS 代理是否启动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/mail/MailHealthIndicator.java">MailHealthIndicator</a></td>
<td>检查邮件服务器是否已启动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/mongo/MongoHealthIndicator.java">MongoHealthIndicator</a></td>
<td>检查 Mongo 数据库是否已启动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/neo4j/Neo4jHealthIndicator.java">Neo4jHealthIndicator</a></td>
<td>检查 Neo4j 服务器是否已启动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/amqp/RabbitHealthIndicator.java">RabbitHealthIndicator</a></td>
<td>检查 Rabbit 服务器是否已启动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/redis/RedisHealthIndicator.java">RedisHealthIndicator</a></td>
<td>检查 Redis 服务器是否启动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/solr/SolrHealthIndicator.java">SolrHealthIndicator</a></td>
<td>检查 Solr 服务器是否已启动。</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p>Tip</p>
<p>您可以通过设置<code>management.health.defaults.enabled</code>属性来全部禁用它们。</p>
</blockquote>
<h3 id="编写自定义健康HealthIndicators"><a href="#编写自定义健康HealthIndicators" class="headerlink" title="编写自定义健康HealthIndicators"></a>编写自定义健康HealthIndicators</h3><p>要提供自定义健康信息，您可以注册实现<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthIndicator.java">HealthIndicator</a>接口的 Spring bean。您需要提供<code>health()</code>方法的实现并返回<code>Health</code>响应。 <code>Health</code>响应应包含状态，并且可以选择包含要显示的其他详细信息。以下代码显示了示例<code>HealthIndicator</code>实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.actuate.health.Health;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.actuate.health.HealthIndicator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyHealthIndicator</span> <span class="keyword">implements</span> <span class="title">HealthIndicator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Health <span class="title">health</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> errorCode = check(); <span class="comment">// perform some specific health check</span></span><br><span class="line">        <span class="keyword">if</span> (errorCode != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Health.down().withDetail(<span class="string">&quot;Error Code&quot;</span>, errorCode).build();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Health.up().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Note</p>
<p>给定<code>HealthIndicator</code>的标识符是不带<code>HealthIndicator</code>后缀的 bean 的名称(如果存在)。在前面的示例中，健康信息在名为<code>my</code>的条目中可用。</p>
<p>除了 Spring Boot 的 sched 义<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/Status.java">Status</a>类型之外，<code>Health</code>还可以返回表示新系统状态的自定义<code>Status</code>。在这种情况下，还需要提供<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthAggregator.java">HealthAggregator</a>接口的自定义实现，或者必须使用<code>management.health.status.order</code>配置属性来配置默认实现。</p>
<p>例如，假设在您的<code>HealthIndicator</code>实现中使用了新的<code>Status</code>代码<code>FATAL</code>。要配置严重性 Sequences，请将以下属性添加到您的应用程序属性中：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.health.status.order</span>=<span class="string">FATAL, DOWN, OUT_OF_SERVICE, UNKNOWN, UP</span></span><br></pre></td></tr></table></figure>
<p>响应中的 HTTP 状态代码反映了总体健康状态(例如<code>UP</code>Map 为 200，而<code>OUT_OF_SERVICE</code>和<code>DOWN</code>Map 为 503)。如果通过 HTTP 访问运行状况终结点，则可能还需要注册自定义状态 Map。例如，以下属性将<code>FATAL</code>Map 到 503(服务不可用)：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.health.status.http-mapping.FATAL</span>=<span class="string">503</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Tip</p>
<p>如果需要更多控制，则可以定义自己的<code>HealthStatusHttpMapper</code> bean。</p>
</blockquote>
<p>下表显示了内置状态的默认状态 Map：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Status</th>
<th>Mapping</th>
</tr>
</thead>
<tbody>
<tr>
<td>DOWN</td>
<td>SERVICE_UNAVAILABLE (503)</td>
</tr>
<tr>
<td>OUT_OF_SERVICE</td>
<td>SERVICE_UNAVAILABLE (503)</td>
</tr>
<tr>
<td>UP</td>
<td>默认情况下没有 Map，因此 http 状态为 200</td>
</tr>
<tr>
<td>UNKNOWN</td>
<td>默认情况下没有 Map，因此 http 状态为 200</td>
</tr>
</tbody>
</table>
</div>
<h3 id="Reactive健康指示器"><a href="#Reactive健康指示器" class="headerlink" title="Reactive健康指示器"></a>Reactive健康指示器</h3><p>对于响应式应用程序，例如使用 Spring WebFlux 的应用程序，<code>ReactiveHealthIndicator</code>提供了非阻塞 Contract 以获取应用程序的运行状况。与传统<code>HealthIndicator</code>相似，健康信息是从<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/ReactiveHealthIndicatorRegistry.java">ReactiveHealthIndicatorRegistry</a>的内容中收集的(默认情况下，在<code>ApplicationContext</code>中定义的所有<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthIndicator.java">HealthIndicator</a>和<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/ReactiveHealthIndicator.java">ReactiveHealthIndicator</a>实例。常规<code>HealthIndicator</code>不会根据反应式 API 进行检查，都是在弹性调度程序上执行的。</p>
<blockquote>
<p>Tip</p>
<p>在响应式应用程序中，<code>ReactiveHealthIndicatorRegistry</code>可用于在运行时注册和注销运行状况指示器。</p>
</blockquote>
<p>要从反应式 API 提供自定义健康信息，您可以注册实现<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/ReactiveHealthIndicator.java">ReactiveHealthIndicator</a>接口的 Spring bean。以下代码显示了一个示例<code>ReactiveHealthIndicator</code>实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyReactiveHealthIndicator</span> <span class="keyword">implements</span> <span class="title">ReactiveHealthIndicator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;Health&gt; <span class="title">health</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> doHealthCheck() <span class="comment">//perform some specific health check that returns a Mono&lt;Health&gt;</span></span><br><span class="line">            .onErrorResume(ex -&gt; Mono.just(<span class="keyword">new</span> Health.Builder().down(ex).build())));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Tip</p>
<p>要自动处理错误，请考虑从<code>AbstractReactiveHealthIndicator</code>扩展。</p>
</blockquote>
<h3 id="自动配置的ReactiveHealthIndicators"><a href="#自动配置的ReactiveHealthIndicators" class="headerlink" title="自动配置的ReactiveHealthIndicators"></a>自动配置的ReactiveHealthIndicators</h3><p>适当时，Spring Boot 会自动配置以下<code>ReactiveHealthIndicators</code>：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/cassandra/CassandraReactiveHealthIndicator.java">CassandraReactiveHealthIndicator</a></td>
<td>检查 Cassandra 数据库是否已启动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/couchbase/CouchbaseReactiveHealthIndicator.java">CouchbaseReactiveHealthIndicator</a></td>
<td>检查 Couchbase 群集是否已启动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/mongo/MongoReactiveHealthIndicator.java">MongoReactiveHealthIndicator</a></td>
<td>检查 Mongo 数据库是否已启动。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/redis/RedisReactiveHealthIndicator.java">RedisReactiveHealthIndicator</a></td>
<td>检查 Redis 服务器是否启动。</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p>Tip</p>
<p>如有必要，可用无功指示器代替常规指示器。另外，任何未明确处理的<code>HealthIndicator</code>都会自动包装。</p>
</blockquote>
<h3 id="健康组"><a href="#健康组" class="headerlink" title="健康组"></a>健康组</h3><p>有时，将运行状况指标组织到可用于不同目的的组中是有用的。</p>
<p>若要创建运行状况指示符组，可以使用management.end .health.group。<name>属性，并指定要包含或排除的运行状况指示器id列表。例如，要创建一个只包含数据库指示器的组，您可以定义以下内容:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.endpoint.health.group.custom.include</span>=<span class="string">db</span></span><br></pre></td></tr></table></figure>
<p>你可以点击<a target="_blank" rel="noopener" href="http://localhost:8080/actuator/health/custom">localhost:8080/actuator/health/custom</a>查看结果。</p>
<p>默认情况下，组将继承与系统运行状况相同的StatusAggregator和HttpCodeStatusMapper设置，但是，也可以按组定义这些设置。如果需要，也可以覆盖显示细节和角色属性:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.endpoint.health.group.custom.show-details</span>=<span class="string">when-authorized</span></span><br><span class="line"><span class="meta">management.endpoint.health.group.custom.roles</span>=<span class="string">admin</span></span><br><span class="line"><span class="meta">management.endpoint.health.group.custom.status.order</span>=<span class="string">fatal,up</span></span><br><span class="line"><span class="meta">management.endpoint.health.group.custom.status.http-mapping.fatal</span>=<span class="string">500</span></span><br><span class="line"><span class="meta">management.endpoint.health.group.custom.status.http-mapping.out-of-service</span>=<span class="string">500</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果需要注册自定义StatusAggregator或HttpCodeStatusMapper bean以便与组一起使用，则可以使用@Qualifier(“groupname”)。</p>
</blockquote>
<h2 id="Kubernetes探头"><a href="#Kubernetes探头" class="headerlink" title="Kubernetes探头"></a>Kubernetes探头</h2><h2 id="应用信息"><a href="#应用信息" class="headerlink" title="应用信息"></a>应用信息</h2><p>应用程序信息公开了从<code>ApplicationContext</code>中定义的所有<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/InfoContributor.java">InfoContributor</a> bean 中收集的各种信息。 Spring Boot 包含许多自动配置的<code>InfoContributor</code> bean，您可以编写自己的。</p>
<h3 id="自动配置的信息贡献者"><a href="#自动配置的信息贡献者" class="headerlink" title="自动配置的信息贡献者"></a>自动配置的信息贡献者</h3><p>适当时，Spring Boot 会自动配置以下<code>InfoContributor</code> bean：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/EnvironmentInfoContributor.java">EnvironmentInfoContributor</a></td>
<td>在<code>info</code>键下公开<code>Environment</code>中的任何键。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/GitInfoContributor.java">GitInfoContributor</a></td>
<td>如果<code>git.properties</code>文件可用，则公开 git 信息。</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/BuildInfoContributor.java">BuildInfoContributor</a></td>
<td>如果<code>META-INF/build-info.properties</code>文件可用，则公开构建信息。</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p>Tip</p>
<p>通过设置<code>management.info.defaults.enabled</code>属性，可以全部禁用它们。</p>
</blockquote>
<h3 id="自定义应用程序信息"><a href="#自定义应用程序信息" class="headerlink" title="自定义应用程序信息"></a>自定义应用程序信息</h3><p>您可以通过设置<code>info.*</code> Spring 属性来自定义<code>info</code>终结点公开的数据。 <code>info</code>键下的所有<code>Environment</code>属性将自动显示。例如，您可以将以下设置添加到<code>application.properties</code>文件中：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">info.app.encoding</span>=<span class="string">UTF-8</span></span><br><span class="line"><span class="meta">info.app.java.source</span>=<span class="string">1.8</span></span><br><span class="line"><span class="meta">info.app.java.target</span>=<span class="string">1.8</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Tip</p>
<p>除了对这些值进行硬编码，您还可以<a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-使用方法指南/#在构建时自动扩展属性">在构建时扩展信息属性</a>。</p>
</blockquote>
<p>假设您使用 Maven，则可以按如下所示重写前面的示例：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">info.app.encoding[emailprotected]@</span></span><br><span class="line"><span class="attr">info.app.java.source[emailprotected]@</span></span><br><span class="line"><span class="attr">info.app.java.target[emailprotected]@</span></span><br></pre></td></tr></table></figure>
<h3 id="Git提交信息"><a href="#Git提交信息" class="headerlink" title="Git提交信息"></a>Git提交信息</h3><p><code>info</code>端点的另一个有用功能是，它可以在项目构建时发布有关<code>git</code>源代码存储库状态的信息。如果<code>GitProperties</code> bean 可用，则公开<code>git.branch</code>，<code>git.commit.id</code>和<code>git.commit.time</code>属性。</p>
<p>Tip</p>
<p>如果<code>git.properties</code>文件在 Classpath 的根目录中可用，则会自动配置<code>GitProperties</code> bean。有关更多详细信息，请参见“ <a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-使用方法指南/#生成Git信息">生成 git 信息</a>”。</p>
<p>如果要显示完整的 git 信息(即<code>git.properties</code>的完整内容)，请使用<code>management.info.git.mode</code>属性，如下所示：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.info.git.mode</span>=<span class="string">full</span></span><br></pre></td></tr></table></figure>
<h3 id="生成信息"><a href="#生成信息" class="headerlink" title="生成信息"></a>生成信息</h3><p>如果有<code>BuildProperties</code> bean，则<code>info</code>端点也可以发布有关构建的信息。如果<code>META-INF/build-info.properties</code>文件在 Classpath 中可用，则会发生这种情况。</p>
<blockquote>
<p>Tip</p>
<p>Maven 和 Gradle 插件都可以生成该文件。有关更多详细信息，请参见“ <a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-使用方法指南/#生成内部版本信息">生成构建信息</a>”。</p>
</blockquote>
<h3 id="编写自定义信息提供者"><a href="#编写自定义信息提供者" class="headerlink" title="编写自定义信息提供者"></a>编写自定义信息提供者</h3><p>要提供自定义应用程序信息，您可以注册实现<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/InfoContributor.java">InfoContributor</a>接口的 Spring bean。</p>
<p>下面的示例使用单个值贡献一个<code>example</code>条目：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.actuate.info.Info;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.actuate.info.InfoContributor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleInfoContributor</span> <span class="keyword">implements</span> <span class="title">InfoContributor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contribute</span><span class="params">(Info.Builder builder)</span> </span>&#123;</span><br><span class="line">        builder.withDetail(<span class="string">&quot;example&quot;</span>,</span><br><span class="line">                Collections.singletonMap(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果到达<code>info</code>端点，则应该看到包含以下附加条目的响应：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;example&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;key&quot;</span> : <span class="string">&quot;value&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="通过HTTP进行监视和管理"><a href="#通过HTTP进行监视和管理" class="headerlink" title="通过HTTP进行监视和管理"></a>通过HTTP进行监视和管理</h1><p>如果您正在开发 Web 应用程序，则 Spring Boot Actuator 会自动配置所有启用的端点以通过 HTTP 公开。默认约定是使用端点的<code>id</code>和前缀<code>/actuator</code>作为 URL 路径。例如，<code>health</code>被公开为<code>/actuator/health</code>。提示：Spring MVC，Spring WebFlux 和 Jersey 本身支持 Actuator。</p>
<h2 id="自定义Management端点路径"><a href="#自定义Management端点路径" class="headerlink" title="自定义Management端点路径"></a>自定义Management端点路径</h2><p>有时，自定义 Management 端点的前缀很有用。例如，您的应用程序可能已经将<code>/actuator</code>用于其他用途。您可以使用<code>management.endpoints.web.base-path</code>属性来更改 Management 端点的前缀，如以下示例所示：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.endpoints.web.base-path</span>=<span class="string">/manage</span></span><br></pre></td></tr></table></figure>
<p>前面的<code>application.properties</code>示例将端点从<code>/actuator/&#123;id&#125;</code>更改为<code>/manage/&#123;id&#125;</code>(例如<code>/manage/info</code>)。</p>
<blockquote>
<p>Note</p>
<p>除非 Management 端口已配置为<a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-SpringBoot-Actuator可用于生产的功能/#自定义Management服务器端口">通过使用其他 HTTP 端口公开端点</a>，否则<code>management.endpoints.web.base-path</code>是相对于<code>server.servlet.context-path</code>的。如果配置了<code>management.server.port</code>，则<code>management.endpoints.web.base-path</code>相对于<code>management.server.servlet.context-path</code>。</p>
</blockquote>
<p>如果要将端点 Map 到其他路径，可以使用<code>management.endpoints.web.path-mapping</code>属性。</p>
<p>以下示例将<code>/actuator/health</code>重新 Map 到<code>/healthcheck</code>：</p>
<p><strong>application.properties.</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.endpoints.web.base-path</span>=<span class="string">/</span></span><br><span class="line"><span class="meta">management.endpoints.web.path-mapping.health</span>=<span class="string">healthcheck</span></span><br></pre></td></tr></table></figure>
<h2 id="自定义Management服务器端口"><a href="#自定义Management服务器端口" class="headerlink" title="自定义Management服务器端口"></a>自定义Management服务器端口</h2><p>对于基于云的部署，使用默认的 HTTP 端口公开 Management 端点是明智的选择。但是，如果您的应用程序在自己的数据中心内运行，则您可能更喜欢使用其他 HTTP 端口公开端点。</p>
<p>您可以设置<code>management.server.port</code>属性来更改 HTTP 端口，如以下示例所示：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.server.port</span>=<span class="string">8081</span></span><br></pre></td></tr></table></figure>
<h2 id="配置特定于Management的SSL"><a href="#配置特定于Management的SSL" class="headerlink" title="配置特定于Management的SSL"></a>配置特定于Management的SSL</h2><p>当配置为使用自定义端口时，还可以通过使用各种<code>management.server.ssl.*</code>属性将 Management 服务器配置为其自己的 SSL。例如，这样做可以使 Management 服务器在主应用程序使用 HTTPS 时通过 HTTP 可用，如以下属性设置所示：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8443</span></span><br><span class="line"><span class="meta">server.ssl.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">server.ssl.key-store</span>=<span class="string">classpath:store.jks</span></span><br><span class="line"><span class="meta">server.ssl.key-password</span>=<span class="string">secret</span></span><br><span class="line"><span class="meta">management.server.port</span>=<span class="string">8080</span></span><br><span class="line"><span class="meta">management.server.ssl.enabled</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure>
<p>另外，主服务器和 Management 服务器都可以使用 SSL，但具有不同的密钥库，如下所示：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8443</span></span><br><span class="line"><span class="meta">server.ssl.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">server.ssl.key-store</span>=<span class="string">classpath:main.jks</span></span><br><span class="line"><span class="meta">server.ssl.key-password</span>=<span class="string">secret</span></span><br><span class="line"><span class="meta">management.server.port</span>=<span class="string">8080</span></span><br><span class="line"><span class="meta">management.server.ssl.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">management.server.ssl.key-store</span>=<span class="string">classpath:management.jks</span></span><br><span class="line"><span class="meta">management.server.ssl.key-password</span>=<span class="string">secret</span></span><br></pre></td></tr></table></figure>
<h2 id="自定义Management服务器地址"><a href="#自定义Management服务器地址" class="headerlink" title="自定义Management服务器地址"></a>自定义Management服务器地址</h2><p>您可以通过设置<code>management.server.address</code>属性来自定义 Management 端点可用的地址。如果您只想侦听内部或面向操作的网络，或者只侦听来自<code>localhost</code>的连接，则这样做很有用。</p>
<p>Note</p>
<p>仅当端口与主服务器端口不同时，您才能在其他地址上侦听。</p>
<p>以下示例<code>application.properties</code>不允许远程 Management 连接：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.server.port</span>=<span class="string">8081</span></span><br><span class="line"><span class="meta">management.server.address</span>=<span class="string">127.0.0.1</span></span><br></pre></td></tr></table></figure>
<h2 id="禁用HTTP端点"><a href="#禁用HTTP端点" class="headerlink" title="禁用HTTP端点"></a>禁用HTTP端点</h2><p>如果您不想通过 HTTP 公开端点，则可以将 Management 端口设置为<code>-1</code>，如以下示例所示：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.server.port</span>=<span class="string">-1</span></span><br></pre></td></tr></table></figure>
<p>也可以使用<code>management.endpoints.web.exposure.exclude</code>属性来实现，如以下示例所示：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.endpoints.web.exposure.exclude</span>=<span class="string">*</span></span><br></pre></td></tr></table></figure>
<h1 id="通过JMX进行监视和管理"><a href="#通过JMX进行监视和管理" class="headerlink" title="通过JMX进行监视和管理"></a>通过JMX进行监视和管理</h1><p>Java Management 扩展(JMX)提供了监视和 Management 应用程序的标准机制。默认情况下，Spring Boot 在<code>org.springframework.boot</code>域下将 Management 端点公开为 JMX MBean。</p>
<h2 id="自定义MBean名称"><a href="#自定义MBean名称" class="headerlink" title="自定义MBean名称"></a>自定义MBean名称</h2><p>MBean 的名称通常是从端点的<code>id</code>生成的。例如，<code>health</code>端点公开为<code>org.springframework.boot:type=Endpoint,name=Health</code>。</p>
<p>如果您的应用程序包含多个 Spring <code>ApplicationContext</code>，则您可能会发现名称冲突。要解决此问题，可以将<code>spring.jmx.unique-names</code>属性设置为<code>true</code>，以便 MBean 名称始终是唯一的。</p>
<p>您还可以自定义暴露端点的 JMX 域。以下设置显示了在<code>application.properties</code>中执行此操作的示例：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.jmx.unique-names</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">management.endpoints.jmx.domain</span>=<span class="string">com.example.myapp</span></span><br></pre></td></tr></table></figure>
<h2 id="禁用JMX端点"><a href="#禁用JMX端点" class="headerlink" title="禁用JMX端点"></a>禁用JMX端点</h2><p>如果不想通过 JMX 公开终结点，可以将<code>management.endpoints.jmx.exposure.exclude</code>属性设置为<code>*</code>，如以下示例所示：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.endpoints.jmx.exposure.exclude</span>=<span class="string">*</span></span><br></pre></td></tr></table></figure>
<h2 id="通过HTTP将Jolokia用于JMX"><a href="#通过HTTP将Jolokia用于JMX" class="headerlink" title="通过HTTP将Jolokia用于JMX"></a>通过HTTP将Jolokia用于JMX</h2><p>Jolokia 是一个 JMX-HTTP bridge，它提供了一种访问 JMX Bean 的替代方法。要使用 Jolokia，请包括对<code>org.jolokia:jolokia-core</code>的依赖。例如，使用 Maven，您将添加以下依赖项：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jolokia<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jolokia-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后，可以通过向<code>management.endpoints.web.exposure.include</code>属性添加<code>jolokia</code>或<code>*</code>来暴露 Jolokia 端点。然后，可以通过在 Management HTTP 服务器上使用<code>/actuator/jolokia</code>来访问它。</p>
<h3 id="自定义Jolokia"><a href="#自定义Jolokia" class="headerlink" title="自定义Jolokia"></a>自定义Jolokia</h3><p>Jolokia 具有许多设置，这些设置通常是通过设置 servlet 参数进行配置的。通过 Spring Boot，您可以使用<code>application.properties</code>文件。为此，请在参数前面加上<code>management.endpoint.jolokia.config.</code>，如以下示例所示：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.endpoint.jolokia.config.debug</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>
<h3 id="禁用Jolokia"><a href="#禁用Jolokia" class="headerlink" title="禁用Jolokia"></a>禁用Jolokia</h3><p>如果您使用 Jolokia 但不希望 Spring Boot 对其进行配置，则将<code>management.endpoint.jolokia.enabled</code>属性设置为<code>false</code>，如下所示：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.endpoint.jolokia.enabled</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure>
<h1 id="Loggers"><a href="#Loggers" class="headerlink" title="Loggers"></a>Loggers</h1><p>Spring Boot Actuator 可以在运行时查看和配置应用程序的日志级别。您可以查看整个列表，也可以查看单个 Logger 的配置，该配置由显式配置的记录级别以及由记录框架赋予它的有效记录级别组成。这些级别可以是以下之一：</p>
<ul>
<li><code>TRACE</code></li>
<li><code>DEBUG</code></li>
<li><code>INFO</code></li>
<li><code>WARN</code></li>
<li><code>ERROR</code></li>
<li><code>FATAL</code></li>
<li><code>OFF</code></li>
<li><code>null</code></li>
</ul>
<p><code>null</code>表示没有显式配置。</p>
<h2 id="配置Logger"><a href="#配置Logger" class="headerlink" title="配置Logger"></a>配置Logger</h2><p>要配置给定的 Logger，请为资源的 URI <code>POST</code>部分实体，如以下示例所示：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;configuredLevel&quot;</span>: <span class="string">&quot;DEBUG&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Tip</p>
<p>要“重置”Logger 的特定级别(并使用默认配置)，可以将值<code>null</code>作为<code>configuredLevel</code>传递。</p>
</blockquote>
<h1 id="Metrics"><a href="#Metrics" class="headerlink" title="Metrics"></a>Metrics</h1><p>Spring Boot Actuator 为<a target="_blank" rel="noopener" href="https://micrometer.io/">Micrometer</a>提供依赖关系 Management 和自动配置，<a target="_blank" rel="noopener" href="https://micrometer.io/">Micrometer</a>是一种应用程序 Metrics 外观，支持众多监视系统，包括：</p>
<ul>
<li><a href="#AppOptics">AppOptics</a></li>
<li><a href="#Atlas">Atlas</a></li>
<li><a href="#Datadog">Datadog</a></li>
<li><a href="#Dynatrace">Dynatrace</a></li>
<li><a href="#Elastic">Elastic</a></li>
<li><a href="#Ganglia">Ganglia</a></li>
<li><a href="#Graphite">Graphite</a></li>
<li><a href="#Humio">Humio</a></li>
<li><a href="#Influx">Influx</a></li>
<li><a href="#JMX">JMX</a></li>
<li><a href="#KairosDB">KairosDB</a></li>
<li><a href="#NewRelic">New Relic</a></li>
<li><a href="#Prometheus">Prometheus</a></li>
<li><a href="#SignalFx">SignalFx</a></li>
<li><a href="#Simple(in-memory">Simple (in-memory)</a>)</li>
<li><a href="#StatsD">StatsD</a></li>
<li><a href="#Wavefront">Wavefront</a></li>
</ul>
<blockquote>
<p>Tip</p>
<p>要了解有关 Micrometer 功能的更多信息，请参阅其<a target="_blank" rel="noopener" href="https://micrometer.io/docs">reference documentation</a>，尤其是<a target="_blank" rel="noopener" href="https://micrometer.io/docs/concepts">concepts section</a>。</p>
</blockquote>
<h2 id="使用Starter"><a href="#使用Starter" class="headerlink" title="使用Starter"></a>使用Starter</h2><p>Spring Boot 自动配置组合<code>MeterRegistry</code>，并为其在 Classpath 上找到的每个受支持的实现向组合添加注册表。在运行时 Classpath 中具有<code>micrometer-registry-&#123;system&#125;</code>的依赖关系足以让 Spring Boot 配置注册表。</p>
<p>大多数注册表具有共同的 Feature。例如，即使 Micrometer 注册表实现位于 Classpath 中，您也可以禁用特定的注册表。例如，要禁用 Datadog：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.metrics.export.datadog.enabled</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure>
<p>Spring Boot 还会将任何自动配置的注册表添加到<code>Metrics</code>类的全局静态复合注册表中，除非您明确告知不要：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.use-global-registry=false</span><br></pre></td></tr></table></figure>
<p>您可以注册任意数量的<code>MeterRegistryCustomizer</code> bean 来进一步配置注册表，例如在向注册表注册任何计量器之前应用通用标签：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function">MeterRegistryCustomizer&lt;MeterRegistry&gt; <span class="title">metricsCommonTags</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> registry -&gt; registry.config().commonTags(<span class="string">&quot;region&quot;</span>, <span class="string">&quot;us-east-1&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>您可以通过更具体地了解通用类型，将自定义应用于特定的注册表实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function">MeterRegistryCustomizer&lt;GraphiteMeterRegistry&gt; <span class="title">graphiteMetricsNamingConvention</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> registry -&gt; registry.config().namingConvention(MY_CUSTOM_CONVENTION);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>完成该设置后，您可以在组件中注入<code>MeterRegistry</code>并注册 Metrics：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Counter counter;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SampleBean</span><span class="params">(MeterRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.counter = registry.counter(<span class="string">&quot;received.messages&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.counter.increment();</span><br><span class="line">        <span class="comment">// handle message implementation</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Spring Boot 也是<a href="#支持Metrics">配置内置仪器</a>(即<code>MeterBinder</code>实现)，您可以通过配置或专用 Comments 标记进行控制。</p>
<h2 id="支持的监视系统"><a href="#支持的监视系统" class="headerlink" title="支持的监视系统"></a>支持的监视系统</h2><h3 id="AppOptics"><a href="#AppOptics" class="headerlink" title="AppOptics"></a>AppOptics</h3><p>默认情况下，AppOptics 注册表会定期将 Metrics 推送到<a target="_blank" rel="noopener" href="https://api.appoptics.com/v1/measurements">api.appoptics.com/v1/measurements</a>。要将 Metrics 导出到 SaaS <a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/appoptics">AppOptics</a>，必须提供您的 API 令牌：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.metrics.export.appoptics.api-token</span>=<span class="string">YOUR_TOKEN</span></span><br></pre></td></tr></table></figure>
<h3 id="Atlas"><a href="#Atlas" class="headerlink" title="Atlas"></a>Atlas</h3><p>默认情况下，度量标准导出到在本地计算机上运行的<a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/atlas">Atlas</a>。可以使用以下方式提供要使用的<a target="_blank" rel="noopener" href="https://github.com/Netflix/atlas">Atlas server</a>的位置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.metrics.export.atlas.uri</span>=<span class="string">http://atlas.example.com:7101/api/v1/publish</span></span><br></pre></td></tr></table></figure>
<h3 id="Datadog"><a href="#Datadog" class="headerlink" title="Datadog"></a>Datadog</h3><p>Datadog 注册表会定期将 Metrics 推送到<a target="_blank" rel="noopener" href="https://www.datadoghq.com/">datadoghq</a>。要将 Metrics 导出到<a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/datadog">Datadog</a>，必须提供您的 API 密钥：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.metrics.export.datadog.api-key</span>=<span class="string">YOUR_KEY</span></span><br></pre></td></tr></table></figure>
<p>您还可以更改将度量标准发送到 Datadog 的时间间隔：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.metrics.export.datadog.step</span>=<span class="string">30s</span></span><br></pre></td></tr></table></figure>
<h3 id="Dynatrace"><a href="#Dynatrace" class="headerlink" title="Dynatrace"></a>Dynatrace</h3><p>Dynatrace 注册表会定期将 Metrics 推送到配置的 URI。要将 Metrics 导出到<a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/dynatrace">Dynatrace</a>，必须提供您的 API 令牌，设备 ID 和 URI：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.metrics.export.dynatrace.api-token</span>=<span class="string">YOUR_TOKEN</span></span><br><span class="line"><span class="meta">management.metrics.export.dynatrace.device-id</span>=<span class="string">YOUR_DEVICE_ID</span></span><br><span class="line"><span class="meta">management.metrics.export.dynatrace.uri</span>=<span class="string">YOUR_URI</span></span><br></pre></td></tr></table></figure>
<p>您还可以更改将度量标准发送到 Dynatrace 的时间间隔：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.metrics.export.dynatrace.step</span>=<span class="string">30s</span></span><br></pre></td></tr></table></figure>
<h3 id="Elastic"><a href="#Elastic" class="headerlink" title="Elastic"></a>Elastic</h3><p>默认情况下，度量标准导出到在本地计算机上运行的<a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/elastic">Elastic</a>。可以使用以下属性提供要使用的 Elastic 服务器的位置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.metrics.export.elastic.host</span>=<span class="string">http://elastic.example.com:8086</span></span><br></pre></td></tr></table></figure>
<h3 id="Ganglia"><a href="#Ganglia" class="headerlink" title="Ganglia"></a>Ganglia</h3><p>默认情况下，度量标准导出到在本地计算机上运行的<a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/ganglia">Ganglia</a>。可以使用以下方式提供要使用的<a target="_blank" rel="noopener" href="http://ganglia.sourceforge.net/">Ganglia server</a>主机和端口：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.metrics.export.ganglia.host</span>=<span class="string">ganglia.example.com</span></span><br><span class="line"><span class="meta">management.metrics.export.ganglia.port</span>=<span class="string">9649</span></span><br></pre></td></tr></table></figure>
<h3 id="Graphite"><a href="#Graphite" class="headerlink" title="Graphite"></a>Graphite</h3><p>默认情况下，度量标准导出到在本地计算机上运行的<a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/graphite">Graphite</a>。可以使用以下方式提供要使用的<a target="_blank" rel="noopener" href="https://graphiteapp.org/">Graphite server</a>主机和端口：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.metrics.export.graphite.host</span>=<span class="string">graphite.example.com</span></span><br><span class="line"><span class="meta">management.metrics.export.graphite.port</span>=<span class="string">9004</span></span><br></pre></td></tr></table></figure>
<p>千分尺提供默认值<code>HierarchicalNameMapper</code>，该默认值<code>HierarchicalNameMapper</code>决定尺寸表 ID <a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/graphite#_hierarchical_name_mapping">Map 到平面层次结构名称</a>的方式。</p>
<blockquote>
<p>Tip</p>
<p>要控制此行为，请定义您的<code>GraphiteMeterRegistry</code>并提供您自己的<code>HierarchicalNameMapper</code>。除非您定义自己的，否则将提供自动配置的<code>GraphiteConfig</code>和<code>Clock</code> bean：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> GraphiteMeterRegistry <span class="title">graphiteMeterRegistry</span><span class="params">(GraphiteConfig config, Clock clock)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> GraphiteMeterRegistry(config, clock, MY_HIERARCHICAL_MAPPER);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Humio"><a href="#Humio" class="headerlink" title="Humio"></a>Humio</h3><p>默认情况下，Humio 注册表会定期将 Metrics 推送到<a target="_blank" rel="noopener" href="https://cloud.humio.com/">cloud.humio.com</a>。要将 Metrics 导出到 SaaS <a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/humio">Humio</a>，必须提供您的 API 令牌：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.metrics.export.humio.api-token</span>=<span class="string">YOUR_TOKEN</span></span><br></pre></td></tr></table></figure>
<p>您还应该配置一个或多个标记以标识将度量标准推送到的数据源：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.metrics.export.humio.tags.alpha</span>=<span class="string">a</span></span><br><span class="line"><span class="meta">management.metrics.export.humio.tags.bravo</span>=<span class="string">b</span></span><br></pre></td></tr></table></figure>
<h3 id="Influx"><a href="#Influx" class="headerlink" title="Influx"></a>Influx</h3><p>默认情况下，度量标准导出到在本地计算机上运行的<a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/influx">Influx</a>。可以使用以下方式提供要使用的<a target="_blank" rel="noopener" href="https://www.influxdata.com/">Influx server</a>的位置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.metrics.export.influx.uri=http://influx.example.com:8086</span><br></pre></td></tr></table></figure>
<h3 id="JMX"><a href="#JMX" class="headerlink" title="JMX"></a>JMX</h3><p>千分尺提供到<a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/jmx">JMX</a>的层次结构 Map，主要是作为一种便宜且可移植的方式在本地查看 Metrics。默认情况下，Metrics 会导出到<code>metrics</code> JMX 域。可以使用以下方式提供要使用的域：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.metrics.export.jmx.domain</span>=<span class="string">com.example.app.metrics</span></span><br></pre></td></tr></table></figure>
<p>千分尺提供默认值<code>HierarchicalNameMapper</code>，该默认值<code>HierarchicalNameMapper</code>决定尺寸表 ID <a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/jmx#_hierarchical_name_mapping">Map 到平面层次结构名称</a>的方式。</p>
<blockquote>
<p>Tip</p>
<p>要控制此行为，请定义您的<code>JmxMeterRegistry</code>并提供您自己的<code>HierarchicalNameMapper</code>。除非您定义自己的，否则将提供自动配置的<code>JmxConfig</code>和<code>Clock</code> bean：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> JmxMeterRegistry <span class="title">jmxMeterRegistry</span><span class="params">(JmxConfig config, Clock clock)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> JmxMeterRegistry(config, clock, MY_HIERARCHICAL_MAPPER);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="KairosDB"><a href="#KairosDB" class="headerlink" title="KairosDB"></a>KairosDB</h3><p>默认情况下，度量标准导出到在本地计算机上运行的<a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/kairos">KairosDB</a>。可以使用以下方式提供要使用的<a target="_blank" rel="noopener" href="https://kairosdb.github.io/">KairosDB server</a>的位置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.metrics.export.kairos.uri</span>=<span class="string">http://kairosdb.example.com:8080/api/v1/datapoints</span></span><br></pre></td></tr></table></figure>
<h3 id="NewRelic"><a href="#NewRelic" class="headerlink" title="NewRelic"></a>NewRelic</h3><p>新的 Relic 注册表会定期将 Metrics 推送到<a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/new-relic">New Relic</a>。要将 Metrics 导出到<a target="_blank" rel="noopener" href="https://newrelic.com/">New Relic</a>，必须提供您的 API 密钥和帐户 ID：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.metrics.export.newrelic.api-key</span>=<span class="string">YOUR_KEY</span></span><br><span class="line"><span class="meta">management.metrics.export.newrelic.account-id</span>=<span class="string">YOUR_ACCOUNT_ID</span></span><br></pre></td></tr></table></figure>
<p>您还可以更改将度量标准发送到 New Relic 的时间间隔：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.metrics.export.newrelic.step</span>=<span class="string">30s</span></span><br></pre></td></tr></table></figure>
<h3 id="Prometheus"><a href="#Prometheus" class="headerlink" title="Prometheus"></a>Prometheus</h3><p><a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/prometheus">Prometheus</a>希望抓取或轮询单个应用程序实例以获取 Metrics。 Spring Boot 在<code>/actuator/prometheus</code>处提供了一个 Actuator 端点，以渲染具有适当格式的<a target="_blank" rel="noopener" href="https://prometheus.io/">Prometheus scrape</a>。</p>
<blockquote>
<p>Tip</p>
<p>该端点默认情况下不可用，必须公开，有关更多详细信息，请参见<a href="#暴露端点">exposing endpoints</a>。</p>
</blockquote>
<p>这是将<code>scrape_config</code>添加到<code>prometheus.yml</code>的示例：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;spring&#x27;</span></span><br><span class="line">    <span class="attr">metrics_path:</span> <span class="string">&#x27;/actuator/prometheus&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;HOST:PORT&#x27;</span>]</span><br></pre></td></tr></table></figure>
<h3 id="SignalFx"><a href="#SignalFx" class="headerlink" title="SignalFx"></a>SignalFx</h3><p>SignalFx 注册表会定期将 Metrics 推送到<a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/signalfx">SignalFx</a>。要将 Metrics 导出到<a target="_blank" rel="noopener" href="https://signalfx.com/">SignalFx</a>，必须提供您的访问令牌：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.metrics.export.signalfx.access-token</span>=<span class="string">YOUR_ACCESS_TOKEN</span></span><br></pre></td></tr></table></figure>
<p>您还可以更改将度量标准发送到 SignalFx 的时间间隔：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.metrics.export.signalfx.step</span>=<span class="string">30s</span></span><br></pre></td></tr></table></figure>
<h3 id="Simple-in-memory"><a href="#Simple-in-memory" class="headerlink" title="Simple(in-memory)"></a>Simple(in-memory)</h3><p>千分尺附带一个简单的内存后端，如果未配置其他注册表，该后端将自动用作后备。这使您可以查看<a href="#Metrics端点">metrics endpoint</a>中收集了哪些 Metrics。</p>
<p>使用任何其他可用后端时，内存后端都会自行禁用。您还可以显式禁用它：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.metrics.export.simple.enabled</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure>
<h3 id="StatsD"><a href="#StatsD" class="headerlink" title="StatsD"></a>StatsD</h3><p>StatsD 注册表急切地通过 UDP 将度量标准推送到 StatsD 代理。默认情况下，Metrics 会导出到本地计算机上运行的<a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/statsd">StatsD</a>代理。可以使用以下方式提供要使用的 StatsD 代理主机和端口：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.metrics.export.statsd.host</span>=<span class="string">statsd.example.com</span></span><br><span class="line"><span class="meta">management.metrics.export.statsd.port</span>=<span class="string">9125</span></span><br></pre></td></tr></table></figure>
<p>您还可以更改要使用的 StatsD 线路协议(默认为 Datadog)：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.metrics.export.statsd.flavor</span>=<span class="string">etsy</span></span><br></pre></td></tr></table></figure>
<h3 id="Wavefront"><a href="#Wavefront" class="headerlink" title="Wavefront"></a>Wavefront</h3><p>Wavefront 注册表会定期将 Metrics 推送到<a target="_blank" rel="noopener" href="http://micrometer.io/docs/registry/wavefront">Wavefront</a>。如果您直接将 Metrics 导出到<a target="_blank" rel="noopener" href="https://www.wavefront.com/">Wavefront</a>，则必须提供您的 API 令牌：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.metrics.export.wavefront.api-token</span>=<span class="string">YOUR_API_TOKEN</span></span><br></pre></td></tr></table></figure>
<p>或者，您可以使用在您的环境中设置的 Wavefront 辅助工具或内部代理，将 Metrics 数据转发到 Wavefront API 主机：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.metrics.export.wavefront.uri</span>=<span class="string">proxy://localhost:2878</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Tip</p>
<p>如果将 Metrics 发布到 Wavefront 代理(如<a target="_blank" rel="noopener" href="https://docs.wavefront.com/proxies_installing.html">the documentation</a>中所述)，则主机必须为<code>proxy://HOST:PORT</code>格式。</p>
<p>您还可以更改将度量标准发送到 Wavefront 的时间间隔：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.metrics.export.wavefront.step</span>=<span class="string">30s</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="支持Metrics"><a href="#支持Metrics" class="headerlink" title="支持Metrics"></a>支持Metrics</h2><p>如果适用，Spring Boot 将注册以下核心 Metrics：</p>
<ul>
<li>JVM Metrics，报告以下方面的利用率：</li>
<li>各种内存和缓冲池<ul>
<li>与垃圾收集有关的统计数据</li>
<li>Threads utilization</li>
<li>加载/卸载的类数</li>
</ul>
</li>
<li>CPU metrics</li>
<li>文件 DescriptorsMetrics</li>
<li>KafkaConsumerMetrics</li>
<li>Log4j2 Metrics：记录每个级别记录到 Log4j2 的事件数</li>
<li>Logback Metrics：记录每个级别记录到 Logback 的事件数</li>
<li>正常运行时间 Metrics：报告正常运行时间的量度和代表应用程序绝对启动时间的固定量度</li>
<li>Tomcat metrics</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-integration/docs/current/reference/html/system-management-chapter.html#micrometer-integration">Spring Integration</a> metrics</li>
</ul>
<h3 id="SpringMVCMetrics"><a href="#SpringMVCMetrics" class="headerlink" title="SpringMVCMetrics"></a>SpringMVCMetrics</h3><p>通过自动配置，可以检测由 Spring MVC 处理的请求。当<code>management.metrics.web.server.auto-time-requests</code>为<code>true</code>时，将对所有请求进行检测。或者，当设置为<code>false</code>时，可以通过将<code>@Timed</code>添加到请求处理方法来启用检测：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Timed</span> (<span class="number">1</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/api/people&quot;)</span></span><br><span class="line">    <span class="meta">@Timed(extraTags = &#123; &quot;region&quot;, &quot;us-east-1&quot; &#125;)</span> (<span class="number">2</span>)</span><br><span class="line">    <span class="meta">@Timed(value = &quot;all.people&quot;, longTask = true)</span> (<span class="number">3</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Person&gt; <span class="title">listPeople</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>(1)</strong> 控制器类，用于对控制器中的每个请求处理程序启用计时。</li>
<li><strong>(2)</strong> 一种启用单个端点的方法。如果您将它放在类中，则不必这样做，但是可以用于进一步为此特定端点自定义计时器。</li>
<li><strong>(3)</strong> 具有<code>longTask = true</code>的方法为该方法启用长任务计时器。长任务计时器需要一个单独的度量标准名称，并且可以与短任务计时器堆叠在一起。</li>
</ul>
<p>默认情况下，使用名称<code>http.server.requests</code>生成度量。可以通过设置<code>management.metrics.web.server.requests-metric-name</code>属性来自定义名称。</p>
<p>默认情况下，与 Spring MVC 相关的 Metrics 带有以下信息标记：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Tag</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>exception</code></td>
<td>处理请求时引发的任何异常的简单类名。</td>
</tr>
<tr>
<td><code>method</code></td>
<td>请求的方法(例如<code>GET</code>或<code>POST</code>)</td>
</tr>
<tr>
<td><code>outcome</code></td>
<td>请求的结果基于响应的状态码。 1xx 是<code>INFORMATIONAL</code>，2xx 是<code>SUCCESS</code>，3xx 是<code>REDIRECTION</code>，4xx <code>CLIENT_ERROR</code>，5xx 是<code>SERVER_ERROR</code></td>
</tr>
<tr>
<td><code>status</code></td>
<td>响应的 HTTP 状态代码(例如<code>200</code>或<code>500</code>)</td>
</tr>
<tr>
<td><code>uri</code></td>
<td>变量替换之前的请求 URI 模板(如果可能)(例如<code>/api/person/&#123;id&#125;</code>)</td>
</tr>
</tbody>
</table>
</div>
<p>要自定义标签，请提供实现<code>WebMvcTagsProvider</code>的<code>@Bean</code>。</p>
<h3 id="SpringWebFluxMetrics"><a href="#SpringWebFluxMetrics" class="headerlink" title="SpringWebFluxMetrics"></a>SpringWebFluxMetrics</h3><p>通过自动配置，可以检测 WebFlux 控制器和功能处理程序处理的所有请求。</p>
<p>默认情况下，使用名称<code>http.server.requests</code>生成度量。您可以通过设置<code>management.metrics.web.server.requests-metric-name</code>属性来自定义名称。</p>
<p>默认情况下，与 WebFlux 相关的度量标准标记有以下信息：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Tag</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>exception</code></td>
<td>处理请求时引发的任何异常的简单类名。</td>
</tr>
<tr>
<td><code>method</code></td>
<td>请求的方法(例如<code>GET</code>或<code>POST</code>)</td>
</tr>
<tr>
<td><code>outcome</code></td>
<td>请求的结果基于响应的状态码。 1xx 是<code>INFORMATIONAL</code>，2xx 是<code>SUCCESS</code>，3xx 是<code>REDIRECTION</code>，4xx <code>CLIENT_ERROR</code>，5xx 是<code>SERVER_ERROR</code></td>
</tr>
<tr>
<td><code>status</code></td>
<td>响应的 HTTP 状态代码(例如<code>200</code>或<code>500</code>)</td>
</tr>
<tr>
<td><code>uri</code></td>
<td>变量替换之前的请求 URI 模板(如果可能)(例如<code>/api/person/&#123;id&#125;</code>)</td>
</tr>
</tbody>
</table>
</div>
<p>要自定义标签，请提供实现<code>WebFluxTagsProvider</code>的<code>@Bean</code>。</p>
<h3 id="Jersey服务器Metrics"><a href="#Jersey服务器Metrics" class="headerlink" title="Jersey服务器Metrics"></a>Jersey服务器Metrics</h3><p>通过自动配置，可以检测由 Jersey JAX-RS 实现处理的请求。当<code>management.metrics.web.server.auto-time-requests</code>为<code>true</code>时，将对所有请求进行检测。或者，当设置为<code>false</code>时，可以通过将<code>@Timed</code>添加到请求处理方法来启用检测：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Path(&quot;/api/people&quot;)</span></span><br><span class="line"><span class="meta">@Timed</span> (<span class="number">1</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Endpoint</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GET</span></span><br><span class="line">    <span class="meta">@Timed(extraTags = &#123; &quot;region&quot;, &quot;us-east-1&quot; &#125;)</span> (<span class="number">2</span>)</span><br><span class="line">    <span class="meta">@Timed(value = &quot;all.people&quot;, longTask = true)</span> (<span class="number">3</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Person&gt; <span class="title">listPeople</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>(1)</strong> 在资源类上，以对资源中的每个请求处理程序启用计时。</li>
<li><strong>(2)</strong> 关于启用单个端点的方法。如果您将它放在类中，则不必这样做，但是可以用于进一步为此特定端点自定义计时器。</li>
<li><strong>(3)</strong> 在具有<code>longTask = true</code>的方法上为该方法启用长任务计时器。长任务计时器需要一个单独的度量标准名称，并且可以与短任务计时器堆叠在一起。</li>
</ul>
<p>默认情况下，使用名称<code>http.server.requests</code>生成度量。可以通过设置<code>management.metrics.web.server.requests-metric-name</code>属性来自定义名称。</p>
<p>默认情况下，Jersey 服务器 Metrics 带有以下信息：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Tag</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>exception</code></td>
<td>处理请求时引发的任何异常的简单类名。</td>
</tr>
<tr>
<td><code>method</code></td>
<td>请求的方法(例如<code>GET</code>或<code>POST</code>)</td>
</tr>
<tr>
<td><code>outcome</code></td>
<td>请求的结果基于响应的状态码。 1xx 是<code>INFORMATIONAL</code>，2xx 是<code>SUCCESS</code>，3xx 是<code>REDIRECTION</code>，4xx <code>CLIENT_ERROR</code>，5xx 是<code>SERVER_ERROR</code></td>
</tr>
<tr>
<td><code>status</code></td>
<td>响应的 HTTP 状态代码(例如<code>200</code>或<code>500</code>)</td>
</tr>
<tr>
<td><code>uri</code></td>
<td>变量替换之前的请求 URI 模板(如果可能)(例如<code>/api/person/&#123;id&#125;</code>)</td>
</tr>
</tbody>
</table>
</div>
<p>要自定义标签，请提供实现<code>JerseyTagsProvider</code>的<code>@Bean</code>。</p>
<h3 id="HTTPClient端Metrics"><a href="#HTTPClient端Metrics" class="headerlink" title="HTTPClient端Metrics"></a>HTTPClient端Metrics</h3><p>Spring Boot Actuator Management<code>RestTemplate</code>和<code>WebClient</code>的工具。为此，您必须注入自动配置的构建器并使用它来创建实例：</p>
<ul>
<li><code>RestTemplateBuilder</code> <code>RestTemplate</code></li>
<li><code>WebClient.Builder</code> <code>WebClient</code></li>
</ul>
<p>也可以手动应用负责此工具的定制程序，即<code>MetricsRestTemplateCustomizer</code>和<code>MetricsWebClientCustomizer</code>。</p>
<p>默认情况下，使用名称<code>http.client.requests</code>生成度量。可以通过设置<code>management.metrics.web.client.requests-metric-name</code>属性来自定义名称。</p>
<p>默认情况下，由检测的 Client 端生成的度量标准标记有以下信息：</p>
<ul>
<li><code>method</code>，即请求的方法(例如<code>GET</code>或<code>POST</code>)。</li>
<li><code>uri</code>，变量替换之前的请求 URI 模板(如果可能的话，例如<code>/api/person/&#123;id&#125;</code>)。</li>
<li><code>status</code>，即响应的 HTTP 状态代码(例如<code>200</code>或<code>500</code>)。</li>
<li><code>clientName</code>，即 URI 的主机部分。</li>
</ul>
<p>要自定义标签，并根据您选择的 Client 端，可以提供实现<code>RestTemplateExchangeTagsProvider</code>或<code>WebClientExchangeTagsProvider</code>的<code>@Bean</code>。 <code>RestTemplateExchangeTags</code>和<code>WebClientExchangeTags</code>中有便捷的静态函数。</p>
<h3 id="缓存Metrics"><a href="#缓存Metrics" class="headerlink" title="缓存Metrics"></a>缓存Metrics</h3><p>通过自动配置，可以在启动时使用前缀<code>cache</code>的度量来检测所有可用的<code>Cache</code>。高速缓存检测针对一组基本 Metrics 进行了标准化。还提供其他特定于缓存的 Metrics。</p>
<p>支持以下缓存库：</p>
<ul>
<li>Caffeine</li>
<li>EhCache 2</li>
<li>Hazelcast</li>
<li>任何兼容的 JCache(JSR-107)实现</li>
</ul>
<p>用高速缓存的名称和从 Bean 名称派生的<code>CacheManager</code>的名称来标记度量标准。</p>
<p>Note</p>
<p>只有启动时可用的缓存才绑定到注册表。对于在启动阶段后即时或以编程方式创建的缓存，需要显式注册。提供<code>CacheMetricsRegistrar</code> bean 可以简化该过程。</p>
<h3 id="数据源Metrics"><a href="#数据源Metrics" class="headerlink" title="数据源Metrics"></a>数据源Metrics</h3><p>通过自动配置，可以使用名为<code>jdbc</code>的度量标准检测所有可用的<code>DataSource</code>对象。数据源检测产生的量规表示池中当前 Active，最大允许和最小允许的连接。这些仪表中的每个都有一个以<code>jdbc</code>为前缀的名称。</p>
<p>度量标准还标有根据 Bean 名称计算出的<code>DataSource</code>的名称。</p>
<p>Tip</p>
<p>默认情况下，Spring Boot 为所有支持的数据源提供元数据。如果不支持立即使用您喜欢的数据源，则可以添加其他<code>DataSourcePoolMetadataProvider</code> bean。有关示例，请参见<code>DataSourcePoolMetadataProvidersConfiguration</code>。</p>
<p>此外，特定于 Hikari 的 Metrics 以<code>hikaricp</code>前缀公开。每个度量标准都由池的名称标记(可以使用<code>spring.datasource.name</code>进行控制)。</p>
<h3 id="HibernateMetrics"><a href="#HibernateMetrics" class="headerlink" title="HibernateMetrics"></a>HibernateMetrics</h3><p>通过自动配置，可以检测所有可用名为<code>hibernate</code>的 Metrics 启用了统计信息的 Hibernate <code>EntityManagerFactory</code>实例。</p>
<p>度量标准还标有从 Bean 名称派生的<code>EntityManagerFactory</code>的名称。</p>
<p>要启用统计信息，必须将标准 JPA 属性<code>hibernate.generate_statistics</code>设置为<code>true</code>。您可以在自动配置的<code>EntityManagerFactory</code>上启用它，如以下示例所示：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.jpa.properties.hibernate.generate_statistics</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>
<h3 id="RabbitMQ指标"><a href="#RabbitMQ指标" class="headerlink" title="RabbitMQ指标"></a>RabbitMQ指标</h3><p>自动配置将启用所有名为<code>rabbitmq</code>的度量的可用 RabbitMQ 连接工厂的检测。</p>
<h2 id="注册自定义Metrics"><a href="#注册自定义Metrics" class="headerlink" title="注册自定义Metrics"></a>注册自定义Metrics</h2><p>要注册自定义 Metrics，请在组件中注入<code>MeterRegistry</code>，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dictionary</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;String&gt; words = <span class="keyword">new</span> CopyOnWriteArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    Dictionary(MeterRegistry registry) &#123;</span><br><span class="line">        registry.gaugeCollectionSize(<span class="string">&quot;dictionary.size&quot;</span>, Tags.empty(), <span class="keyword">this</span>.words);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// …</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果发现您在组件或应用程序中反复测试了一套 Metrics，则可以将此套件封装在<code>MeterBinder</code>实现中。默认情况下，所有<code>MeterBinder</code> bean 的度量将自动绑定到 Spring Management 的<code>MeterRegistry</code>。</p>
<h2 id="自定义单个Metrics"><a href="#自定义单个Metrics" class="headerlink" title="自定义单个Metrics"></a>自定义单个Metrics</h2><p>如果您需要对特定的<code>Meter</code>实例应用自定义设置，则可以使用<code>io.micrometer.core.instrument.config.MeterFilter</code>界面。默认情况下，所有<code>MeterFilter</code> bean 将自动应用于千分尺<code>MeterRegistry.Config</code>。</p>
<p>例如，如果要将所有以<code>com.example</code>开头的仪表 ID 的<code>mytag.region</code>标签重命名为<code>mytag.area</code>，则可以执行以下操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> MeterFilter <span class="title">renameRegionTagMeterFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> MeterFilter.renameTag(<span class="string">&quot;com.example&quot;</span>, <span class="string">&quot;mytag.region&quot;</span>, <span class="string">&quot;mytag.area&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="常用标签"><a href="#常用标签" class="headerlink" title="常用标签"></a>常用标签</h3><p>通用标签通常用于在操作环境(如主机，实例，区域，堆栈等)上进行维度深入分析。通用标签适用于所有仪表，可以按以下示例所示进行配置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.metrics.tags.region</span>=<span class="string">us-east-1</span></span><br><span class="line"><span class="meta">management.metrics.tags.stack</span>=<span class="string">prod</span></span><br></pre></td></tr></table></figure>
<p>上面的示例将<code>region</code>和<code>stack</code>标签添加到所有仪表，其值分别为<code>us-east-1</code>和<code>prod</code>。</p>
<blockquote>
<p>Note</p>
<p>如果使用 Graphite，则常用标签的 Sequences 很重要。由于使用这种方法不能保证通用标签的 Sequences，因此建议 Graphite 用户定义自定义<code>MeterFilter</code>。</p>
</blockquote>
<h3 id="每米属性"><a href="#每米属性" class="headerlink" title="每米属性"></a>每米属性</h3><p>除了<code>MeterFilter</code> bean 外，还可以使用属性在每米基础上应用有限的一组自定义设置。每表定制适用于以给定名称开头的所有所有表 ID。例如，以下将禁用所有 ID 以<code>example.remote</code>开头的仪表</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.metrics.enable.example.remote</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure>
<p>以下属性允许按米自定义：</p>
<p><strong>表 57.1. 每米自定义</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>management.metrics.enable</code></td>
<td>是否拒绝仪表发出任何 Metrics。</td>
</tr>
<tr>
<td><code>management.metrics.distribution.percentiles-histogram</code></td>
<td>是否发布适合计算可凝集(跨维度)百分位数逼近的直方图。</td>
</tr>
<tr>
<td><code>management.metrics.distribution.minimum-expected-value</code> , <code>management.metrics.distribution.maximum-expected-value</code></td>
<td>通过限制期望值的范围来发布较少的直方图桶。</td>
</tr>
<tr>
<td><code>management.metrics.distribution.percentiles</code></td>
<td>发布在应用程序中计算的百分位值</td>
</tr>
<tr>
<td><code>management.metrics.distribution.sla</code></td>
<td>发布包含您的 SLA 定义的存储区的累积直方图。</td>
</tr>
</tbody>
</table>
</div>
<p>有关<code>percentiles-histogram</code>，<code>percentiles</code>和<code>sla</code>后面的概念的更多详细信息，请参阅千分尺文档的<a target="_blank" rel="noopener" href="https://micrometer.io/docs/concepts#_histograms_and_percentiles">“直方图和百分位数”部分</a>。</p>
<h2 id="Metrics端点"><a href="#Metrics端点" class="headerlink" title="Metrics端点"></a>Metrics端点</h2><p>Spring Boot 提供了一个<code>metrics</code>端点，可用于诊断检查应用程序收集的 Metrics。该端点默认情况下不可用，必须公开，有关更多详细信息，请参见<a href="#暴露端点">exposing endpoints</a>。</p>
<p>导航到<code>/actuator/metrics</code>将显示可用仪表名称的列表。您可以通过提供特定名称作为 selectors 来深入查看有关特定仪表的信息，例如<code>/actuator/metrics/jvm.memory.max</code>。</p>
<blockquote>
<p>Tip</p>
<p>您在此处使用的名称应与代码中使用的名称相匹配，而不是已针对其出厂的监视系统进行了命名约定标准化后的名称。换句话说，如果<code>jvm.memory.max</code>由于其蛇形命名约定而在 Prometheus 中显示为<code>jvm_memory_max</code>，则在<code>metrics</code>端点中检查电表时，仍应使用<code>jvm.memory.max</code>作为 selectors。</p>
</blockquote>
<p>您还可以在网址末尾添加任意数量的<code>tag=KEY:VALUE</code>查询参数，以在维度上更深入地了解电表，例如<code>/actuator/metrics/jvm.memory.max?tag=area:nonheap</code>。</p>
<blockquote>
<p>Tip</p>
<p>报告的测量值是与仪表名称和已应用的所有标签相匹配的所有仪表的统计信息的<em>和</em>。因此，在上面的示例中，返回的“值”统计量是堆的“代码缓存”，“压缩类空间”和“元空间”区域的最大内存占用量的总和。如果您只想查看“ Metaspace”的最大大小，则可以添加一个额外的<code>tag=id:Metaspace</code>，即<code>/actuator/metrics/jvm.memory.max?tag=area:nonheap&amp;tag=id:Metaspace</code>。</p>
</blockquote>
<h1 id="Auditing"><a href="#Auditing" class="headerlink" title="Auditing"></a>Auditing</h1><p>一旦运行了 Spring Security，Spring Boot Actuator 将具有一个灵活的审核框架，该框架可以发布事件(默认情况下，“身份验证成功”，“失败”和“访问被拒绝”异常)。此功能对于基于身份验证失败的报告和实施锁定策略非常有用。要自定义已发布的安全事件，可以提供自己的<code>AbstractAuthenticationAuditListener</code>和<code>AbstractAuthorizationAuditListener</code>实现。</p>
<p>您也可以将审核服务用于自己的业务事件。为此，可以将现有的<code>AuditEventRepository</code>注入到您自己的组件中，然后直接使用它，或者通过 Spring <code>ApplicationEventPublisher</code>发布<code>AuditApplicationEvent</code>(通过实现<code>ApplicationEventPublisherAware</code>)。</p>
<h1 id="HTTP跟踪"><a href="#HTTP跟踪" class="headerlink" title="HTTP跟踪"></a>HTTP跟踪</h1><p>将为所有 HTTP 请求自动启用跟踪。您可以查看<code>httptrace</code>端点，并获取有关最近 100 次请求-响应交换的基本信息。</p>
<h2 id="自定义HTTP跟踪"><a href="#自定义HTTP跟踪" class="headerlink" title="自定义HTTP跟踪"></a>自定义HTTP跟踪</h2><p>要自定义每个跟踪中包含的项目，请使用<code>management.trace.http.include</code>配置属性。要进行高级自定义，请考虑注册自己的<code>HttpExchangeTracer</code>实现。</p>
<p>默认情况下，使用<code>InMemoryHttpTraceRepository</code>来存储最近 100 次请求-响应交换的跟踪。如果需要扩展容量，则可以定义自己的<code>InMemoryHttpTraceRepository</code> bean 实例。您还可以创建自己的替代<code>HttpTraceRepository</code>实现。</p>
<h1 id="进程监视"><a href="#进程监视" class="headerlink" title="进程监视"></a>进程监视</h1><p>在<code>spring-boot</code>模块中，您可以找到两个类来创建通常对过程监视有用的文件：</p>
<ul>
<li><code>ApplicationPidFileWriter</code>创建一个包含应用程序 PID 的文件(默认情况下，在应用程序目录中，文件名为<code>application.pid</code>)。</li>
<li><code>WebServerPortFileWriter</code>创建一个(或多个)文件，其中包含正在运行的 Web 服务器的端口(默认情况下，在应用程序目录中，文件名为<code>application.port</code>)。</li>
</ul>
<p>默认情况下，不会激活这些编写器，但是您可以启用：</p>
<ul>
<li><a href="#扩展配置">通过扩展配置</a></li>
<li><a target="_blank" rel="noopener" href="https://www.docs4dev.com/docs/zh/spring-boot/2.1.1.RELEASE/reference/production-ready-process-monitoring.html#production-ready-process-monitoring-programmatically">第 60.2 节“以编程方式”</a></li>
</ul>
<h2 id="扩展配置"><a href="#扩展配置" class="headerlink" title="扩展配置"></a>扩展配置</h2><p>在<code>META-INF/spring.factories</code>文件中，可以激活写入 PID 文件的侦听器，如以下示例所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.context.ApplicationListener=\</span><br><span class="line">org.springframework.boot.context.ApplicationPidFileWriter,\</span><br><span class="line">org.springframework.boot.web.context.WebServerPortFileWriter</span><br></pre></td></tr></table></figure>
<h2 id="编程配置"><a href="#编程配置" class="headerlink" title="编程配置"></a>编程配置</h2><p>您还可以通过调用<code>SpringApplication.addListeners(…)</code>方法并传递适当的<code>Writer</code>对象来激活侦听器。此方法还允许您自定义<code>Writer</code>构造函数中的文件名和路径。</p>
<h1 id="云计算支持"><a href="#云计算支持" class="headerlink" title="云计算支持"></a>云计算支持</h1><p>Spring Boot 的 Actuator 模块包括额外的支持，当您将其部署到兼容的 Cloud Foundry 实例时就会激活。 <code>/cloudfoundryapplication</code>路径提供了通往所有<code>@Endpoint</code> bean 的备用安全路由。</p>
<p>扩展支持使 Cloud Foundry Management UI(例如可用于查看已部署的应用程序的 Web 应用程序)增加了 Spring Boot Actuator 信息。例如，应用程序状态页面可能包含完整的运行状况信息，而不是典型的“正在运行”或“已停止”状态。</p>
<p>Note</p>
<p>普通用户无法直接访问<code>/cloudfoundryapplication</code>路径。为了使用端点，必须将有效的 UAA 令牌与请求一起传递。</p>
<h2 id="禁用扩展的CloudFoundryActuator支持"><a href="#禁用扩展的CloudFoundryActuator支持" class="headerlink" title="禁用扩展的CloudFoundryActuator支持"></a>禁用扩展的CloudFoundryActuator支持</h2><p>如果要完全禁用<code>/cloudfoundryapplication</code>端点，则可以将以下设置添加到<code>application.properties</code>文件中：</p>
<p><strong>application.properties.</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.cloudfoundry.enabled</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure>
<h2 id="云计算自签名证书"><a href="#云计算自签名证书" class="headerlink" title="云计算自签名证书"></a>云计算自签名证书</h2><p>默认情况下，对<code>/cloudfoundryapplication</code>个端点的安全性验证会对各种 Cloud Foundry 服务进行 SSL 调用。如果您的 Cloud Foundry UAA 或 Cloud Controller 服务使用自签名证书，则需要设置以下属性：</p>
<p><strong>application.properties.</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.cloudfoundry.skip-ssl-validation</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>
<h2 id="自定义上下文路径"><a href="#自定义上下文路径" class="headerlink" title="自定义上下文路径"></a>自定义上下文路径</h2><p>如果服务器的上下文路径已配置为<code>/</code>以外的其他值，则 Cloud Foundry 端点在应用程序的根目录将不可用。例如，如果<code>server.servlet.context-path=/app</code>，Cloud Foundry 端点将在<code>/app/cloudfoundryapplication/*</code>可用。</p>
<p>如果您希望 Cloud Foundry 端点始终在<code>/cloudfoundryapplication/*</code>可用，而与服务器的上下文路径无关，则需要在应用程序中进行显式配置。配置将根据所使用的 Web 服务器而有所不同。对于 Tomcat，可以添加以下配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> TomcatServletWebServerFactory <span class="title">servletWebServerFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> TomcatServletWebServerFactory() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">prepareContext</span><span class="params">(Host host,</span></span></span><br><span class="line"><span class="function"><span class="params">                ServletContextInitializer[] initializers)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>.prepareContext(host, initializers);</span><br><span class="line">            StandardContext child = <span class="keyword">new</span> StandardContext();</span><br><span class="line">            child.addLifecycleListener(<span class="keyword">new</span> Tomcat.FixContextListener());</span><br><span class="line">            child.setPath(<span class="string">&quot;/cloudfoundryapplication&quot;</span>);</span><br><span class="line">            ServletContainerInitializer initializer = getServletContextInitializer(</span><br><span class="line">                    getContextPath());</span><br><span class="line">            child.addServletContainerInitializer(initializer, Collections.emptySet());</span><br><span class="line">            child.setCrossContext(<span class="keyword">true</span>);</span><br><span class="line">            host.addChild(child);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> ServletContainerInitializer <span class="title">getServletContextInitializer</span><span class="params">(String contextPath)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (c, context) -&gt; &#123;</span><br><span class="line">        Servlet servlet = <span class="keyword">new</span> GenericServlet() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest req, ServletResponse res)</span></span></span><br><span class="line"><span class="function">                    <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">                ServletContext context = req.getServletContext()</span><br><span class="line">                        .getContext(contextPath);</span><br><span class="line">                context.getRequestDispatcher(<span class="string">&quot;/cloudfoundryapplication&quot;</span>).forward(req,</span><br><span class="line">                        res);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line">        context.addServlet(<span class="string">&quot;cloudfoundry&quot;</span>, servlet).addMapping(<span class="string">&quot;/*&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="接下来要读什么"><a href="#接下来要读什么" class="headerlink" title="接下来要读什么"></a>接下来要读什么</h1><p>如果要探索本章中讨论的一些概念，可以看看 Actuator<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples">sample applications</a>。您可能还想阅读有关<a target="_blank" rel="noopener" href="http://graphite.wikidot.com/">Graphite</a>之类的图形工具的信息。</p>
<p>否则，您可以 continue 阅读<a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-部署SpringBoot应用程序/">‘deployment options’</a>或 continue 阅读有关 Spring Boot <em> <a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-构建工具插件/">构建工具插件</a></em>的一些深入信息。</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/SpringBoot/" rel="tag"># SpringBoot</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/08/31/SpringBoot%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91-SpringBoot%E5%8A%9F%E8%83%BD/" rel="prev" title="SpringBoot官方文档翻译-SpringBoot功能">
      <i class="fa fa-chevron-left"></i> SpringBoot官方文档翻译-SpringBoot功能
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/08/31/SpringBoot%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91-%E9%83%A8%E7%BD%B2SpringBoot%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/" rel="next" title="SpringBoot官方文档翻译-部署SpringBoot应用程序">
      SpringBoot官方文档翻译-部署SpringBoot应用程序 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%AF%E7%94%A8%E7%94%9F%E4%BA%A7%E5%B0%B1%E7%BB%AA%E5%8A%9F%E8%83%BD"><span class="nav-number">1.</span> <span class="nav-text">启用生产就绪功能</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Endpoints"><span class="nav-number">2.</span> <span class="nav-text">Endpoints</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%AF%E7%94%A8%E7%AB%AF%E7%82%B9"><span class="nav-number">2.1.</span> <span class="nav-text">启用端点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9A%B4%E9%9C%B2%E7%AB%AF%E7%82%B9"><span class="nav-number">2.2.</span> <span class="nav-text">暴露端点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%9D%E6%8A%A4HTTP%E7%AB%AF%E7%82%B9"><span class="nav-number">2.3.</span> <span class="nav-text">保护HTTP端点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%AB%AF%E7%82%B9"><span class="nav-number">2.4.</span> <span class="nav-text">配置端点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8%E4%BA%8EActuatorWeb%E7%AB%AF%E7%82%B9%E7%9A%84%E8%B6%85%E5%AA%92%E4%BD%93"><span class="nav-number">2.5.</span> <span class="nav-text">用于ActuatorWeb端点的超媒体</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CORS%E6%94%AF%E6%8C%81"><span class="nav-number">2.6.</span> <span class="nav-text">CORS支持</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E7%AB%AF%E7%82%B9"><span class="nav-number">2.7.</span> <span class="nav-text">实现自定义端点</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A5%E6%94%B6%E8%BE%93%E5%85%A5"><span class="nav-number">2.7.1.</span> <span class="nav-text">接收输入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Importing%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="nav-number">2.7.1.1.</span> <span class="nav-text">Importing类型转换</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89Web%E7%AB%AF%E7%82%B9"><span class="nav-number">2.7.2.</span> <span class="nav-text">自定义Web端点</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Web%E7%AB%AF%E7%82%B9%E8%AF%B7%E6%B1%82%E9%A2%84%E6%B5%8B"><span class="nav-number">2.7.2.1.</span> <span class="nav-text">Web端点请求预测</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Path"><span class="nav-number">2.7.2.2.</span> <span class="nav-text">Path</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HTTP%E6%96%B9%E6%B3%95"><span class="nav-number">2.7.2.3.</span> <span class="nav-text">HTTP方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Consumes"><span class="nav-number">2.7.2.4.</span> <span class="nav-text">Consumes</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Produces"><span class="nav-number">2.7.2.5.</span> <span class="nav-text">Produces</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Web%E7%AB%AF%E7%82%B9%E5%93%8D%E5%BA%94%E7%8A%B6%E6%80%81"><span class="nav-number">2.7.2.6.</span> <span class="nav-text">Web端点响应状态</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Web%E7%AB%AF%E7%82%B9%E8%8C%83%E5%9B%B4%E8%AF%B7%E6%B1%82"><span class="nav-number">2.7.2.7.</span> <span class="nav-text">Web端点范围请求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Web%E7%AB%AF%E7%82%B9%E5%AE%89%E5%85%A8"><span class="nav-number">2.7.2.8.</span> <span class="nav-text">Web端点安全</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Servlet%E7%AB%AF%E7%82%B9"><span class="nav-number">2.7.3.</span> <span class="nav-text">Servlet端点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A7%E5%88%B6%E5%99%A8%E7%AB%AF%E7%82%B9"><span class="nav-number">2.7.4.</span> <span class="nav-text">控制器端点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%81%A5%E5%BA%B7%E4%BF%A1%E6%81%AF"><span class="nav-number">2.8.</span> <span class="nav-text">健康信息</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E7%9A%84%E5%81%A5%E5%BA%B7HealthIndicators"><span class="nav-number">2.8.1.</span> <span class="nav-text">自动配置的健康HealthIndicators</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E8%87%AA%E5%AE%9A%E4%B9%89%E5%81%A5%E5%BA%B7HealthIndicators"><span class="nav-number">2.8.2.</span> <span class="nav-text">编写自定义健康HealthIndicators</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reactive%E5%81%A5%E5%BA%B7%E6%8C%87%E7%A4%BA%E5%99%A8"><span class="nav-number">2.8.3.</span> <span class="nav-text">Reactive健康指示器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E7%9A%84ReactiveHealthIndicators"><span class="nav-number">2.8.4.</span> <span class="nav-text">自动配置的ReactiveHealthIndicators</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%81%A5%E5%BA%B7%E7%BB%84"><span class="nav-number">2.8.5.</span> <span class="nav-text">健康组</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kubernetes%E6%8E%A2%E5%A4%B4"><span class="nav-number">2.9.</span> <span class="nav-text">Kubernetes探头</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E4%BF%A1%E6%81%AF"><span class="nav-number">2.10.</span> <span class="nav-text">应用信息</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E7%9A%84%E4%BF%A1%E6%81%AF%E8%B4%A1%E7%8C%AE%E8%80%85"><span class="nav-number">2.10.1.</span> <span class="nav-text">自动配置的信息贡献者</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E4%BF%A1%E6%81%AF"><span class="nav-number">2.10.2.</span> <span class="nav-text">自定义应用程序信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Git%E6%8F%90%E4%BA%A4%E4%BF%A1%E6%81%AF"><span class="nav-number">2.10.3.</span> <span class="nav-text">Git提交信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E4%BF%A1%E6%81%AF"><span class="nav-number">2.10.4.</span> <span class="nav-text">生成信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BF%A1%E6%81%AF%E6%8F%90%E4%BE%9B%E8%80%85"><span class="nav-number">2.10.5.</span> <span class="nav-text">编写自定义信息提供者</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%80%9A%E8%BF%87HTTP%E8%BF%9B%E8%A1%8C%E7%9B%91%E8%A7%86%E5%92%8C%E7%AE%A1%E7%90%86"><span class="nav-number">3.</span> <span class="nav-text">通过HTTP进行监视和管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89Management%E7%AB%AF%E7%82%B9%E8%B7%AF%E5%BE%84"><span class="nav-number">3.1.</span> <span class="nav-text">自定义Management端点路径</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89Management%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E5%8F%A3"><span class="nav-number">3.2.</span> <span class="nav-text">自定义Management服务器端口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%89%B9%E5%AE%9A%E4%BA%8EManagement%E7%9A%84SSL"><span class="nav-number">3.3.</span> <span class="nav-text">配置特定于Management的SSL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89Management%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9C%B0%E5%9D%80"><span class="nav-number">3.4.</span> <span class="nav-text">自定义Management服务器地址</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A6%81%E7%94%A8HTTP%E7%AB%AF%E7%82%B9"><span class="nav-number">3.5.</span> <span class="nav-text">禁用HTTP端点</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%80%9A%E8%BF%87JMX%E8%BF%9B%E8%A1%8C%E7%9B%91%E8%A7%86%E5%92%8C%E7%AE%A1%E7%90%86"><span class="nav-number">4.</span> <span class="nav-text">通过JMX进行监视和管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89MBean%E5%90%8D%E7%A7%B0"><span class="nav-number">4.1.</span> <span class="nav-text">自定义MBean名称</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A6%81%E7%94%A8JMX%E7%AB%AF%E7%82%B9"><span class="nav-number">4.2.</span> <span class="nav-text">禁用JMX端点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%9A%E8%BF%87HTTP%E5%B0%86Jolokia%E7%94%A8%E4%BA%8EJMX"><span class="nav-number">4.3.</span> <span class="nav-text">通过HTTP将Jolokia用于JMX</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89Jolokia"><span class="nav-number">4.3.1.</span> <span class="nav-text">自定义Jolokia</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A6%81%E7%94%A8Jolokia"><span class="nav-number">4.3.2.</span> <span class="nav-text">禁用Jolokia</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Loggers"><span class="nav-number">5.</span> <span class="nav-text">Loggers</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AELogger"><span class="nav-number">5.1.</span> <span class="nav-text">配置Logger</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Metrics"><span class="nav-number">6.</span> <span class="nav-text">Metrics</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Starter"><span class="nav-number">6.1.</span> <span class="nav-text">使用Starter</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%94%AF%E6%8C%81%E7%9A%84%E7%9B%91%E8%A7%86%E7%B3%BB%E7%BB%9F"><span class="nav-number">6.2.</span> <span class="nav-text">支持的监视系统</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#AppOptics"><span class="nav-number">6.2.1.</span> <span class="nav-text">AppOptics</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Atlas"><span class="nav-number">6.2.2.</span> <span class="nav-text">Atlas</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Datadog"><span class="nav-number">6.2.3.</span> <span class="nav-text">Datadog</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dynatrace"><span class="nav-number">6.2.4.</span> <span class="nav-text">Dynatrace</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Elastic"><span class="nav-number">6.2.5.</span> <span class="nav-text">Elastic</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ganglia"><span class="nav-number">6.2.6.</span> <span class="nav-text">Ganglia</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Graphite"><span class="nav-number">6.2.7.</span> <span class="nav-text">Graphite</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Humio"><span class="nav-number">6.2.8.</span> <span class="nav-text">Humio</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Influx"><span class="nav-number">6.2.9.</span> <span class="nav-text">Influx</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JMX"><span class="nav-number">6.2.10.</span> <span class="nav-text">JMX</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#KairosDB"><span class="nav-number">6.2.11.</span> <span class="nav-text">KairosDB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#NewRelic"><span class="nav-number">6.2.12.</span> <span class="nav-text">NewRelic</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Prometheus"><span class="nav-number">6.2.13.</span> <span class="nav-text">Prometheus</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SignalFx"><span class="nav-number">6.2.14.</span> <span class="nav-text">SignalFx</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Simple-in-memory"><span class="nav-number">6.2.15.</span> <span class="nav-text">Simple(in-memory)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#StatsD"><span class="nav-number">6.2.16.</span> <span class="nav-text">StatsD</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Wavefront"><span class="nav-number">6.2.17.</span> <span class="nav-text">Wavefront</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%94%AF%E6%8C%81Metrics"><span class="nav-number">6.3.</span> <span class="nav-text">支持Metrics</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SpringMVCMetrics"><span class="nav-number">6.3.1.</span> <span class="nav-text">SpringMVCMetrics</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SpringWebFluxMetrics"><span class="nav-number">6.3.2.</span> <span class="nav-text">SpringWebFluxMetrics</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Jersey%E6%9C%8D%E5%8A%A1%E5%99%A8Metrics"><span class="nav-number">6.3.3.</span> <span class="nav-text">Jersey服务器Metrics</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTPClient%E7%AB%AFMetrics"><span class="nav-number">6.3.4.</span> <span class="nav-text">HTTPClient端Metrics</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%93%E5%AD%98Metrics"><span class="nav-number">6.3.5.</span> <span class="nav-text">缓存Metrics</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%BA%90Metrics"><span class="nav-number">6.3.6.</span> <span class="nav-text">数据源Metrics</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HibernateMetrics"><span class="nav-number">6.3.7.</span> <span class="nav-text">HibernateMetrics</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RabbitMQ%E6%8C%87%E6%A0%87"><span class="nav-number">6.3.8.</span> <span class="nav-text">RabbitMQ指标</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B3%A8%E5%86%8C%E8%87%AA%E5%AE%9A%E4%B9%89Metrics"><span class="nav-number">6.4.</span> <span class="nav-text">注册自定义Metrics</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8D%95%E4%B8%AAMetrics"><span class="nav-number">6.5.</span> <span class="nav-text">自定义单个Metrics</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E6%A0%87%E7%AD%BE"><span class="nav-number">6.5.1.</span> <span class="nav-text">常用标签</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AF%8F%E7%B1%B3%E5%B1%9E%E6%80%A7"><span class="nav-number">6.5.2.</span> <span class="nav-text">每米属性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Metrics%E7%AB%AF%E7%82%B9"><span class="nav-number">6.6.</span> <span class="nav-text">Metrics端点</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Auditing"><span class="nav-number">7.</span> <span class="nav-text">Auditing</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#HTTP%E8%B7%9F%E8%B8%AA"><span class="nav-number">8.</span> <span class="nav-text">HTTP跟踪</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89HTTP%E8%B7%9F%E8%B8%AA"><span class="nav-number">8.1.</span> <span class="nav-text">自定义HTTP跟踪</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BF%9B%E7%A8%8B%E7%9B%91%E8%A7%86"><span class="nav-number">9.</span> <span class="nav-text">进程监视</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%E9%85%8D%E7%BD%AE"><span class="nav-number">9.1.</span> <span class="nav-text">扩展配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%96%E7%A8%8B%E9%85%8D%E7%BD%AE"><span class="nav-number">9.2.</span> <span class="nav-text">编程配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%91%E8%AE%A1%E7%AE%97%E6%94%AF%E6%8C%81"><span class="nav-number">10.</span> <span class="nav-text">云计算支持</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A6%81%E7%94%A8%E6%89%A9%E5%B1%95%E7%9A%84CloudFoundryActuator%E6%94%AF%E6%8C%81"><span class="nav-number">10.1.</span> <span class="nav-text">禁用扩展的CloudFoundryActuator支持</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%91%E8%AE%A1%E7%AE%97%E8%87%AA%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6"><span class="nav-number">10.2.</span> <span class="nav-text">云计算自签名证书</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%8A%E4%B8%8B%E6%96%87%E8%B7%AF%E5%BE%84"><span class="nav-number">10.3.</span> <span class="nav-text">自定义上下文路径</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8E%A5%E4%B8%8B%E6%9D%A5%E8%A6%81%E8%AF%BB%E4%BB%80%E4%B9%88"><span class="nav-number">11.</span> <span class="nav-text">接下来要读什么</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Route-nice"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Route-nice</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">29</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/route-nice" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;route-nice" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:route.lvy.roman@gmail.com" title="E-Mail → mailto:route.lvy.roman@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Route-nice</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://route-nice.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "http://yoursite.com/2020/08/31/SpringBoot%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91-SpringBoot-Actuator%E5%8F%AF%E7%94%A8%E4%BA%8E%E7%94%9F%E4%BA%A7%E7%9A%84%E5%8A%9F%E8%83%BD/";
    this.page.identifier = "2020/08/31/SpringBoot官方文档翻译-SpringBoot-Actuator可用于生产的功能/";
    this.page.title = "SpringBoot官方文档翻译-SpringBoot-Actuator可用于生产的功能";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://route-nice.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

</body>
</html>
