<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="本节提供了一些在使用 Spring Boot 时经常出现的常见“我该怎么做……”问题的答案。它的覆盖范围不是很详尽，但是确实覆盖了很多。 如果您有一个我们不在此讨论的特定问题，则您可能想查看stackoverflow.com，看看是否有人已经提供了答案。这也是一个提出新问题的好地方(请使用spring-boot标签)。 我们也很乐意扩展此部分。如果您想添加“操作方法”，请给我们发送pull req">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringBoot官方文档翻译-使用方法指南">
<meta property="og:url" content="http://yoursite.com/2020/08/31/SpringBoot%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91-%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E6%8C%87%E5%8D%97/index.html">
<meta property="og:site_name" content="Route-nice">
<meta property="og:description" content="本节提供了一些在使用 Spring Boot 时经常出现的常见“我该怎么做……”问题的答案。它的覆盖范围不是很详尽，但是确实覆盖了很多。 如果您有一个我们不在此讨论的特定问题，则您可能想查看stackoverflow.com，看看是否有人已经提供了答案。这也是一个提出新问题的好地方(请使用spring-boot标签)。 我们也很乐意扩展此部分。如果您想添加“操作方法”，请给我们发送pull req">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-08-31T03:43:37.000Z">
<meta property="article:modified_time" content="2020-09-18T03:25:30.276Z">
<meta property="article:author" content="Route-nice">
<meta property="article:tag" content="SpringBoot">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2020/08/31/SpringBoot%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91-%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E6%8C%87%E5%8D%97/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>SpringBoot官方文档翻译-使用方法指南 | Route-nice</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?8b3aabf954a120e5a2920d31f3600013";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Route-nice</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/31/SpringBoot%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91-%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Route-nice">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Route-nice">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          SpringBoot官方文档翻译-使用方法指南
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-08-31 11:43:37" itemprop="dateCreated datePublished" datetime="2020-08-31T11:43:37+08:00">2020-08-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-18 11:25:30" itemprop="dateModified" datetime="2020-09-18T11:25:30+08:00">2020-09-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SpringIO/" itemprop="url" rel="index"><span itemprop="name">SpringIO</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2020/08/31/SpringBoot%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91-%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E6%8C%87%E5%8D%97/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/08/31/SpringBoot官方文档翻译-使用方法指南/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>本节提供了一些在使用 Spring Boot 时经常出现的常见“我该怎么做……”问题的答案。它的覆盖范围不是很详尽，但是确实覆盖了很多。</p>
<p>如果您有一个我们不在此讨论的特定问题，则您可能想查看<a target="_blank" rel="noopener" href="https://stackoverflow.com/tags/spring-boot">stackoverflow.com</a>，看看是否有人已经提供了答案。这也是一个提出新问题的好地方(请使用<code>spring-boot</code>标签)。</p>
<p>我们也很乐意扩展此部分。如果您想添加“操作方法”，请给我们发送<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE">pull request</a>。</p>
<a id="more"></a>
<h1 id="SpringBoot应用程序"><a href="#SpringBoot应用程序" class="headerlink" title="SpringBoot应用程序"></a>SpringBoot应用程序</h1><p>本部分包括与 Spring Boot 应用程序直接相关的主题。</p>
<h2 id="创建自己的FailureAnalyzer"><a href="#创建自己的FailureAnalyzer" class="headerlink" title="创建自己的FailureAnalyzer"></a>创建自己的FailureAnalyzer</h2><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/diagnostics/FailureAnalyzer.html">FailureAnalyzer</a>是一种很好的拦截启动时异常并将其转换为人类可读的消息的方法，并封装在<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/diagnostics/FailureAnalysis.html">FailureAnalysis</a>中。 Spring Boot 为与应用程序上下文相关的异常，JSR-303 验证等提供了此类分析器。您也可以创建自己的。</p>
<p><code>AbstractFailureAnalyzer</code>是<code>FailureAnalyzer</code>的便捷扩展，它检查要处理的异常中是否存在指定的异常类型。您可以对此进行扩展，以便您的实现只有在实际存在异常时才有机会处理该异常。如果由于某种原因无法处理该异常，请返回<code>null</code>，以使另一个实现有机会处理该异常。</p>
<p><code>FailureAnalyzer</code>实现必须在<code>META-INF/spring.factories</code>中注册。以下示例注册<code>ProjectConstraintViolationFailureAnalyzer</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.boot.diagnostics.FailureAnalyzer=\</span><br><span class="line">com.example.ProjectConstraintViolationFailureAnalyzer</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note</p>
<p>如果您需要访问<code>BeanFactory</code>或<code>Environment</code>，则您的<code>FailureAnalyzer</code>可以分别简单地实现<code>BeanFactoryAware</code>或<code>EnvironmentAware</code>。</p>
</blockquote>
<h2 id="自动配置故障排除"><a href="#自动配置故障排除" class="headerlink" title="自动配置故障排除"></a>自动配置故障排除</h2><p>Spring Boot 自动配置会尽力“做正确的事”，但是有时候事情会失败，而且很难说出原因。</p>
<p>Spring Boot <code>ApplicationContext</code>中有一个非常有用的<code>ConditionEvaluationReport</code>。如果启用<code>DEBUG</code>日志记录输出，则可以看到它。如果您使用<code>spring-boot-actuator</code>(请参见<a href="#Actuator">Actuator 章节</a>，则还有一个<code>conditions</code>端点以 JSON 渲染报告。使用该端点来调试应用程序，并在运行时查看 Spring Boot 添加了哪些功能(哪些尚未添加)。</p>
<p>通过查看源代码和 Javadoc，可以回答更多问题。阅读代码时，请记住以下经验法则：</p>
<ul>
<li>查找名为<code>*AutoConfiguration</code>的类，并阅读其源代码。请特别注意<code>@Conditional*</code>注解，以了解它们启用了哪些功能以及何时启用。将<code>--debug</code>添加到命令行或系统属性<code>-Ddebug</code>，以在控制台上获取在您的应用中做出的所有自动配置决策的日志。在正在运行的 Actuator 应用程序中，查看<code>conditions</code>端点(<code>/actuator/conditions</code>或等效的 JMX)以获取相同的信息。</li>
<li>查找<code>@ConfigurationProperties</code>的类(例如<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/ServerProperties.java">ServerProperties</a>)，然后从中读取可用的外部配置选项。 <code>@ConfigurationProperties</code>注解具有<code>name</code>属性，该属性充当外部属性的前缀。因此，<code>ServerProperties</code>具有<code>prefix=&quot;server&quot;</code>，并且其配置属性是<code>server.port</code>，<code>server.address</code>等。在正在运行的 Actuator 应用程序中，查看<code>configprops</code>端点。</li>
<li>寻找在<code>Binder</code>上使用<code>bind</code>方法以轻松地将配置值从<code>Environment</code>中拉出的用法。它通常与前缀一起使用。</li>
<li>查找直接绑定到<code>Environment</code>的<code>@Value</code>Comments。</li>
<li>寻找<code>@ConditionalOnExpression</code>Comments，这些 Comments 可根据 SpEL 表达式打开和关闭功能，这些 Comments 通常使用从<code>Environment</code>解析的占位符进行评估。</li>
</ul>
<h2 id="在启动环境或ApplicationContext之前对其进行自定义"><a href="#在启动环境或ApplicationContext之前对其进行自定义" class="headerlink" title="在启动环境或ApplicationContext之前对其进行自定义"></a>在启动环境或ApplicationContext之前对其进行自定义</h2><p><code>SpringApplication</code>具有<code>ApplicationListeners</code>和<code>ApplicationContextInitializers</code>，用于将自定义项应用于上下文或环境。 Spring Boot 从<code>META-INF/spring.factories</code>内部加载了许多此类自定义内容供内部使用。注册其他自定义项的方法有多种：</p>
<ul>
<li>在运行每个应用程序之前，通过在<code>SpringApplication</code>上调用<code>addListeners</code>和<code>addInitializers</code>方法，以编程方式进行操作。</li>
<li>通过设置<code>context.initializer.classes</code>或<code>context.listener.classes</code>属性，以声明方式针对每个应用程序。</li>
<li>声明性地，对于所有应用程序，通过添加一个<code>META-INF/spring.factories</code>并将一个 jar 文件打包为应用程序全部用作库。</li>
</ul>
<p><code>SpringApplication</code>向侦听器发送一些特殊的<code>ApplicationEvents</code>(某些情况甚至在创建上下文之前)，然后为<code>ApplicationContext</code>发布的事件注册侦听器。有关完整列表，请参见“ Spring Boot 功能”部分中的“ <a target="_blank" rel="noopener" href="http://localhost:4000/2020/08/31/SpringBoot官方文档翻译-SpringBoot功能/#应用程序事件和侦听器">第 23.5 节“应用程序事件和侦听器”</a>”。</p>
<p>也可以在使用<code>EnvironmentPostProcessor</code>刷新应用程序上下文之前自定义<code>Environment</code>。每个实现都应在<code>META-INF/spring.factories</code>中注册，如以下示例所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.boot.env.EnvironmentPostProcessor=com.example.YourEnvironmentPostProcessor</span><br></pre></td></tr></table></figure>
<p>该实现可以加载任意文件并将其添加到<code>Environment</code>。例如，以下示例从 Classpath 加载 YAML 配置文件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EnvironmentPostProcessorExample</span> <span class="keyword">implements</span> <span class="title">EnvironmentPostProcessor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> YamlPropertySourceLoader loader = <span class="keyword">new</span> YamlPropertySourceLoader();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postProcessEnvironment</span><span class="params">(ConfigurableEnvironment environment,</span></span></span><br><span class="line"><span class="function"><span class="params">            SpringApplication application)</span> </span>&#123;</span><br><span class="line">        Resource path = <span class="keyword">new</span> ClassPathResource(<span class="string">&quot;com/example/myapp/config.yml&quot;</span>);</span><br><span class="line">        PropertySource&lt;?&gt; propertySource = loadYaml(path);</span><br><span class="line">        environment.getPropertySources().addLast(propertySource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> PropertySource&lt;?&gt; loadYaml(Resource path) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!path.exists()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Resource &quot;</span> + path + <span class="string">&quot; does not exist&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.loader.load(<span class="string">&quot;custom-resource&quot;</span>, path).get(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(</span><br><span class="line">                    <span class="string">&quot;Failed to load yaml configuration from &quot;</span> + path, ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Tip</p>
<p><code>Environment</code>已经准备好了 Spring Boot 默认加载的所有常用属性源。因此，可以从环境中获取文件的位置。前面的示例将<code>custom-resource</code>属性源添加到列表的末尾，以便在其他任何常见位置定义的键都具有优先权。定制实现可以定义另一个 Sequences。</p>
<p>Warning</p>
<p>虽然在<code>@SpringBootApplication</code>上使用<code>@PropertySource</code>似乎是在<code>Environment</code>中加载自定义资源的便捷方法，但我们不建议您这样做，因为 Spring Boot 在刷新<code>ApplicationContext</code>之前会准备<code>Environment</code>。用<code>@PropertySource</code>定义的任何键加载得太晚，以至于对自动配置没有任何影响。</p>
</blockquote>
<h2 id="构建ApplicationContext层次结构-添加父上下文或根上下文"><a href="#构建ApplicationContext层次结构-添加父上下文或根上下文" class="headerlink" title="构建ApplicationContext层次结构(添加父上下文或根上下文)"></a>构建ApplicationContext层次结构(添加父上下文或根上下文)</h2><p>您可以使用<code>ApplicationBuilder</code>类创建父/子<code>ApplicationContext</code>层次结构。有关更多信息，请参见“ Spring Boot 功能”部分中的“ <a target="_blank" rel="noopener" href="http://localhost:4000/2020/08/31/SpringBoot官方文档翻译-SpringBoot功能/#FluentBuilderAPI">第 23.4 节“ Fluent Builder API”</a>”。</p>
<h2 id="创建非Web应用程序"><a href="#创建非Web应用程序" class="headerlink" title="创建非Web应用程序"></a>创建非Web应用程序</h2><p>并非所有的 Spring 应用程序都必须是 Web 应用程序(或 Web 服务)。如果要用<code>main</code>方法执行一些代码，又要引导 Spring 应用程序来设置要使用的基础架构，则可以使用 Spring Boot 的<code>SpringApplication</code>功能。 <code>SpringApplication</code>更改其<code>ApplicationContext</code>类，具体取决于它是否认为需要 Web 应用程序。您可以做的第一件事是将与服务器相关的依存关系(例如 Servlet API)从 Classpath 中移开。如果您不能执行此操作(例如，从同一代码库运行两个应用程序)，则可以在<code>SpringApplication</code>实例上显式调用<code>setWebApplicationType(WebApplicationType.NONE)</code>或设置<code>applicationContextClass</code>属性(通过 Java API 或带有外部属性)。您可以将要作为业务逻辑运行的应用程序代码实现为<code>CommandLineRunner</code>，并可以将其作为<code>@Bean</code>定义放到上下文中。</p>
<h1 id="属性和配置"><a href="#属性和配置" class="headerlink" title="属性和配置"></a>属性和配置</h1><p>本节包括有关设置和读取属性和配置设置以及它们与 Spring Boot 应用程序的交互的主题。</p>
<h2 id="在构建时自动扩展属性"><a href="#在构建时自动扩展属性" class="headerlink" title="在构建时自动扩展属性"></a>在构建时自动扩展属性</h2><p>您可以使用现有的构建配置自动扩展它们，而不是对项目的构建配置中也指定的某些属性进行硬编码。在 Maven 和 Gradle 中都是可能的。</p>
<h3 id="使用Maven自动扩展属性"><a href="#使用Maven自动扩展属性" class="headerlink" title="使用Maven自动扩展属性"></a>使用Maven自动扩展属性</h3><p>您可以使用资源过滤从 Maven 项目自动扩展属性。如果使用<code>spring-boot-starter-parent</code>，则可以使用<code>@[email protected]</code>占位符来引用 Maven 的“项目属性”，如以下示例所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app.encoding[emailprotected]@</span><br><span class="line">app.java.version[emailprotected]@</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note</p>
<p>这样只会过滤生产配置(换句话说，不会对<code>src/test/resources</code>进行过滤)。</p>
<p>Tip</p>
<p>如果启用<code>addResources</code>标志，则<code>spring-boot:run</code>目标可以将<code>src/main/resources</code>直接添加到 Classpath 中(用于热重载)。这样做避免了资源过滤和此功能。相反，您可以使用<code>exec:java</code>目标或自定义插件的配置。有关更多详细信息，请参见<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/maven-plugin/usage.html">插件使用情况页面</a>。</p>
</blockquote>
<p>如果您不使用 Starter Parent，则需要在<code>pom.xml</code>的<code>&lt;build/&gt;</code>元素内包括以下元素：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>您还需要在<code>&lt;plugins/&gt;</code>内包括以下元素：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-resources-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">delimiters</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">delimiter</span>&gt;</span>@<span class="tag">&lt;/<span class="name">delimiter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">delimiters</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">useDefaultDelimiters</span>&gt;</span>false<span class="tag">&lt;/<span class="name">useDefaultDelimiters</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note</p>
<p>如果您在配置中使用标准的 Spring 占位符(例如<code>$&#123;placeholder&#125;</code>)，则<code>useDefaultDelimiters</code>属性非常重要。如果该属性未设置为<code>false</code>，则可以通过构建扩展它们。</p>
</blockquote>
<h3 id="使用Gradle自动扩展属性"><a href="#使用Gradle自动扩展属性" class="headerlink" title="使用Gradle自动扩展属性"></a>使用Gradle自动扩展属性</h3><p>您可以通过配置 Java 插件的<code>processResources</code>任务来自动扩展 Gradle 项目中的属性，如以下示例所示：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">processResources &#123;</span><br><span class="line">    expand(project.properties)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后，您可以使用占位符来引用 Gradle 项目的属性，如以下示例所示：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">app.name</span>=<span class="string">$&#123;name&#125;</span></span><br><span class="line"><span class="meta">app.description</span>=<span class="string">$&#123;description&#125;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note</p>
<p>Gradle 的<code>expand</code>方法使用 Groovy 的<code>SimpleTemplateEngine</code>，它可以转换<code>$&#123;..&#125;</code>令牌。 <code>$&#123;..&#125;</code>样式与 Spring 自己的属性占位符机制冲突。要将 Spring 属性占位符与自动扩展一起使用，请按以下方式对 Spring 属性占位符进行转义：<code>\$&#123;..&#125;</code>。</p>
</blockquote>
<h2 id="外部化SpringApplication的配置"><a href="#外部化SpringApplication的配置" class="headerlink" title="外部化SpringApplication的配置"></a>外部化SpringApplication的配置</h2><p><code>SpringApplication</code>具有 bean 属性(主要是 setter)，因此在创建应用程序时可以使用其 Java API 修改其行为。或者，您可以通过在<code>spring.main.*</code>中设置属性来外部化配置。例如，在<code>application.properties</code>中，您可能具有以下设置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.main.web-application-type=none</span><br><span class="line">spring.main.banner-mode=off</span><br></pre></td></tr></table></figure>
<p>然后，Spring Boot 标语不会在启动时打印，并且应用程序也不会启动嵌入式 Web 服务器。</p>
<p>外部配置中定义的属性会覆盖用 Java API 指定的值，但用于创建<code>ApplicationContext</code>的源除外。考虑以下应用程序：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> SpringApplicationBuilder()</span><br><span class="line">    .bannerMode(Banner.Mode.OFF)</span><br><span class="line">    .sources(demo.MyApp.class)</span><br><span class="line">    .run(args);</span><br></pre></td></tr></table></figure>
<p>现在考虑以下配置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.main.sources</span>=<span class="string">com.acme.Config,com.acme.ExtraConfig</span></span><br><span class="line"><span class="meta">spring.main.banner-mode</span>=<span class="string">console</span></span><br></pre></td></tr></table></figure>
<p>实际的应用程序<em> now </em>显示标语(被配置覆盖)并为<code>ApplicationContext</code>使用三个源(按以下 Sequences)：<code>demo.MyApp</code>，<code>com.acme.Config</code>和<code>com.acme.ExtraConfig</code>。</p>
<h2 id="更改应用程序外部属性的位置"><a href="#更改应用程序外部属性的位置" class="headerlink" title="更改应用程序外部属性的位置"></a>更改应用程序外部属性的位置</h2><p>默认情况下，来自不同来源的属性将以定义的 Sequences 添加到 Spring <code>Environment</code>(有关确切 Sequences，请参见“ Spring Boot 功能”部分的“ <a target="_blank" rel="noopener" href="http://localhost:4000/2020/08/31/SpringBoot官方文档翻译-SpringBoot功能/#外部化配置">第 24 章，外部化配置</a>。</p>
<p>增强和修改此 Sequences 的一种好方法是向应用程序源添加<code>@PropertySource</code>注解。检查传递给<code>SpringApplication</code>静态便捷方法的类和使用<code>setSources()</code>添加的类，以查看它们是否具有<code>@PropertySources</code>。如果确实如此，则将这些属性尽早添加到<code>Environment</code>以便在<code>ApplicationContext</code>生命周期的所有阶段中使用。以这种方式添加的属性的优先级低于使用默认位置(例如<code>application.properties</code>)，系统属性，环境变量或命令行添加的属性。</p>
<p>您还可以提供以下系统属性(或环境变量)来更改行为：</p>
<ul>
<li><code>spring.config.name</code>(<code>SPRING_CONFIG_NAME</code>)：默认为<code>application</code>作为文件名的根。</li>
<li><code>spring.config.location</code>(<code>SPRING_CONFIG_LOCATION</code>)：要加载的文件(例如 Classpath 资源或 URL)。为此文档设置了一个单独的<code>Environment</code>属性源，可以通过系统属性，环境变量或命令行来覆盖它。</li>
</ul>
<p>无论您在环境中设置什么，Spring Boot 总是如上所述加载<code>application.properties</code>。默认情况下，如果使用 YAML，则 extensions 为’.yml’的文件也将添加到列表中。</p>
<p>Spring Boot 记录在<code>DEBUG</code>级别加载的配置文件以及在<code>TRACE</code>级别未找到的候选文件。</p>
<p>有关更多详细信息，请参见<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/context/config/ConfigFileApplicationListener.java">ConfigFileApplicationListener</a>。</p>
<h2 id="使用“简短”命令行参数"><a href="#使用“简短”命令行参数" class="headerlink" title="使用“简短”命令行参数"></a>使用“简短”命令行参数</h2><p>有些人喜欢使用<code>--port=9000</code>而不是<code>--server.port=9000</code>在命令行上设置配置属性。您可以通过使用<code>application.properties</code>中的占位符来启用此行为，如以下示例所示：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">$&#123;port:8080&#125;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Tip</p>
<p>如果您从<code>spring-boot-starter-parent</code> POM 继承，则<code>maven-resources-plugins</code>的默认过滤器令牌已从<code>$&#123;*&#125;</code>更改为<code>@</code>(即<code>@[email protected]</code>而不是<code>$&#123;maven.token&#125;</code>)，以防止与 Spring 样式的占位符冲突。如果直接为<code>application.properties</code>启用了 Maven 过滤，则可能还需要更改默认过滤器令牌以使用<a target="_blank" rel="noopener" href="https://maven.apache.org/plugins/maven-resources-plugin/resources-mojo.html#delimiters">other delimiters</a>。</p>
<p>Note</p>
<p>在这种特定情况下，端口绑定可在 PaaS 环境(例如 Heroku 或 Cloud Foundry)中工作。在这两个平台中，<code>PORT</code>环境变量是自动设置的，并且 Spring 可以绑定到<code>Environment</code>属性的大写同义词。</p>
</blockquote>
<h2 id="对外部属性使用YAML"><a href="#对外部属性使用YAML" class="headerlink" title="对外部属性使用YAML"></a>对外部属性使用YAML</h2><p>YAML 是 JSON 的超集，因此是一种方便的语法，用于以分层格式存储外部属性，如以下示例所示：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cruncher</span></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">driverClassName:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost/test</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">9000</span></span><br></pre></td></tr></table></figure>
<p>创建一个名为<code>application.yml</code>的文件，并将其放在 Classpath 的根目录中。然后将<code>snakeyaml</code>添加到您的依赖项中(Maven 坐标<code>org.yaml:snakeyaml</code>，如果使用<code>spring-boot-starter</code>则已经包含在内)。将 YAML 文件解析为 Java <code>Map&lt;String,Object&gt;</code>(类似于 JSON 对象)，然后 Spring Boot 展宽 Map，使其深一层，并具有句点分隔的键，这与许多人习惯使用 Java 的<code>Properties</code>文件一样。</p>
<p>前面的示例 YAML 对应于以下<code>application.properties</code>文件：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.application.name</span>=<span class="string">cruncher</span></span><br><span class="line"><span class="meta">spring.datasource.driverClassName</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost/test</span></span><br><span class="line"><span class="meta">server.port</span>=<span class="string">9000</span></span><br></pre></td></tr></table></figure>
<p>有关 YAML 的更多信息，请参见“ Spring Boot 功能”部分中的“ <a target="_blank" rel="noopener" href="http://localhost:4000/2020/08/31/SpringBoot官方文档翻译-SpringBoot功能/#使用YAML代替属性">第 24.7 节“使用 YAML 代替属性”</a>”。</p>
<h2 id="设置ActiveSpring轮廓"><a href="#设置ActiveSpring轮廓" class="headerlink" title="设置ActiveSpring轮廓"></a>设置ActiveSpring轮廓</h2><p>Spring <code>Environment</code>为此提供了一个 API，但是您通常可以设置 System 属性(<code>spring.profiles.active</code>)或 OS 环境变量(<code>SPRING_PROFILES_ACTIVE</code>)。另外，您可以使用<code>-D</code>参数启动应用程序(请记住将其放在主类或 jar 存档之前)，如下所示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar -Dspring.profiles.active=production demo-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>
<p>在 Spring Boot 中，您还可以在<code>application.properties</code>中设置 Active 配置文件，如以下示例所示：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.profiles.active</span>=<span class="string">production</span></span><br></pre></td></tr></table></figure>
<p>用这种方法设置的值将由“系统”属性或环境变量设置代替，而不是由<code>SpringApplicationBuilder.profiles()</code>方法代替。因此，后一种 Java API 可用于扩充配置文件，而无需更改默认值。</p>
<p>有关更多信息，请参见“ Spring Boot 功能”部分中的“ <a target="_blank" rel="noopener" href="http://localhost:4000/2020/08/31/SpringBoot官方文档翻译-SpringBoot功能/#Profiles">第 25 章，Profile</a>”。</p>
<h2 id="根据环境更改配置"><a href="#根据环境更改配置" class="headerlink" title="根据环境更改配置"></a>根据环境更改配置</h2><p>YAML 文件实际上是由<code>---</code>行分隔的文档序列，每个文档都分别解析为展平图。</p>
<p>如果 YAML 文档包含<code>spring.profiles</code>键，则配置文件值(以逗号分隔的配置文件列表)将被送入 Spring <code>Environment.acceptsProfiles()</code>方法。如果这些配置文件中的任何一个处于 Active 状态，则该文档将包含在最终合并中(否则，则不包含在此文档中)，如以下示例所示：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">9000</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">profiles:</span> <span class="string">development</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">9001</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">profiles:</span> <span class="string">production</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>在前面的示例中，默认端口为 9000.但是，如果名为“ development”的 Spring 概要文件处于 Active 状态，则该端口为 9001.如果“ production”为 Active，则该端口为 0.</p>
<blockquote>
<p>Note</p>
<p>YAML 文档按照它们遇到的 Sequences 进行合并。以后的值将覆盖以前的值。</p>
<p>要对属性文件执行相同的操作，可以使用<code>application-$&#123;profile&#125;.properties</code>指定特定于配置文件的值。</p>
</blockquote>
<h2 id="发现外部属性的内置选项"><a href="#发现外部属性的内置选项" class="headerlink" title="发现外部属性的内置选项"></a>发现外部属性的内置选项</h2><p>Spring Boot 在运行时将<code>application.properties</code>(或<code>.yml</code>文件和其他位置)的外部属性绑定到应用程序中。在一个位置上没有(而且从技术上来说不是)所有受支持属性的详尽列表，因为贡献可能来自 Classpath 上的其他 jar 文件。</p>
<p>具有 Actuator 功能的正在运行的应用程序具有<code>configprops</code>端点，该端点显示了通过<code>@ConfigurationProperties</code>可用的所有绑定属性和可绑定属性。</p>
<p>附录包括一个<a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-附录/#常见的应用程序属性">application.properties</a>示例，其中列出了 Spring Boot 支持的最常见属性。Authority 列表来自于在源代码中搜索<code>@ConfigurationProperties</code>和<code>@Value</code>注解以及偶尔使用<code>Binder</code>。有关加载属性的确切 Sequences 的更多信息，请参见“ <a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-SpringBoot功能/#外部化配置">第 24 章，外部化配置</a>”。</p>
<h1 id="嵌入式Web服务器"><a href="#嵌入式Web服务器" class="headerlink" title="嵌入式Web服务器"></a>嵌入式Web服务器</h1><p>每个 Spring Boot Web 应用程序都包含一个嵌入式 Web 服务器。此功能引发了许多操作问题，包括如何更改嵌入式服务器以及如何配置嵌入式服务器。本节回答这些问题。</p>
<h2 id="使用其他Web服务器"><a href="#使用其他Web服务器" class="headerlink" title="使用其他Web服务器"></a>使用其他Web服务器</h2><p>许多 Spring Boot 启动器都包含默认的嵌入式容器。</p>
<ul>
<li>对于 Servlet 堆栈应用程序，<code>spring-boot-starter-web</code>通过包含<code>spring-boot-starter-tomcat</code>来包含 Tomcat，但是您可以使用<code>spring-boot-starter-jetty</code>或<code>spring-boot-starter-undertow</code>来代替。</li>
<li>对于反应堆应用程序，<code>spring-boot-starter-webflux</code>通过包含<code>spring-boot-starter-reactor-netty</code>来包含 Reactor Netty，但是您可以改用<code>spring-boot-starter-tomcat</code>，<code>spring-boot-starter-jetty</code>或<code>spring-boot-starter-undertow</code>。</li>
</ul>
<p>切换到其他 HTTP 服务器时，除了包括所需的依赖关系之外，还需要排除默认的依赖关系。 Spring Boot 为 HTTP 服务器提供了单独的启动器，以帮助简化此过程。</p>
<p>以下 Maven 示例显示了如何排除 Tomcat 并包括 Jetty for Spring MVC：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-api.version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">servlet-api.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Exclude the Tomcat dependency --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Use Jetty instead --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note</p>
<p>Servlet API 的版本已被覆盖，因为与 Tomcat 9 和 Undertow 2.0 不同，Jetty 9.4 不支持 Servlet 4.0.</p>
</blockquote>
<p>以下 Gradle 示例显示了如何排除 Netty 并为 Spring WebFlux 包括 Undertow：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">configurations &#123;</span><br><span class="line">    <span class="comment">// exclude Reactor Netty</span></span><br><span class="line">    compile.exclude <span class="attr">module:</span> <span class="string">&#x27;spring-boot-starter-reactor-netty&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile <span class="string">&#x27;org.springframework.boot:spring-boot-starter-webflux&#x27;</span></span><br><span class="line">    <span class="comment">// Use Undertow instead</span></span><br><span class="line">    compile <span class="string">&#x27;org.springframework.boot:spring-boot-starter-undertow&#x27;</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note</p>
<p>必须使用<code>spring-boot-starter-reactor-netty</code>才能使用<code>WebClient</code>类，因此即使需要包含其他 HTTP 服务器，也可能需要保持对 Netty 的依赖。</p>
</blockquote>
<h2 id="禁用Web服务器"><a href="#禁用Web服务器" class="headerlink" title="禁用Web服务器"></a>禁用Web服务器</h2><p>如果您的 Classpath 包含启动 Web 服务器所需的位，则 Spring Boot 将自动启动它。要禁用此行为，请在<code>application.properties</code>中配置<code>WebApplicationType</code>，如以下示例所示：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.main.web-application-type</span>=<span class="string">none</span></span><br></pre></td></tr></table></figure>
<h2 id="更改HTTP端口"><a href="#更改HTTP端口" class="headerlink" title="更改HTTP端口"></a>更改HTTP端口</h2><p>在独立应用程序中，主 HTTP 端口默认为<code>8080</code>，但可以设置为<code>server.port</code>(例如，在<code>application.properties</code>中或作为系统属性)。得益于<code>Environment</code>值的轻松绑定，您还可以使用<code>SERVER_PORT</code>(例如，作为 OS 环境变量)。</p>
<p>要完全关闭 HTTP 端点但仍创建<code>WebApplicationContext</code>，请使用<code>server.port=-1</code>。 (这样做有时对测试很有用.)</p>
<p>有关更多详细信息，请参阅“ Spring Boot 功能”部分中的“ <a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-SpringBoot功能/#自定义嵌入式Servlet容器">第 28.4.4 节“自定义嵌入式 Servlet 容器”</a>”或<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/ServerProperties.java">ServerProperties</a>源代码。</p>
<h2 id="使用随机未分配的HTTP端口"><a href="#使用随机未分配的HTTP端口" class="headerlink" title="使用随机未分配的HTTP端口"></a>使用随机未分配的HTTP端口</h2><p>要扫描可用端口(使用 os 本机来防止冲突)，请使用<code>server.port=0</code>。</p>
<h2 id="在运行时发现HTTP端口"><a href="#在运行时发现HTTP端口" class="headerlink" title="在运行时发现HTTP端口"></a>在运行时发现HTTP端口</h2><p>您可以从日志输出或<code>ServletWebServerApplicationContext</code>通过其<code>WebServer</code>访问服务器正在运行的端口。最好的方法是确保它已初始化，是添加类型为<code>ApplicationListener&lt;ServletWebServerInitializedEvent&gt;</code>的<code>@Bean</code>，并在事件发布时将其从事件中拉出。</p>
<p>使用<code>@SpringBootTest(webEnvironment=WebEnvironment.RANDOM_PORT)</code>的测试还可以通过使用<code>@LocalServerPort</code>注解将实际端口注入字段中，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(webEnvironment=WebEnvironment.RANDOM_PORT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebIntegrationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ServletWebServerApplicationContext server;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@LocalServerPort</span></span><br><span class="line">    <span class="keyword">int</span> port;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note</p>
<p><code>@LocalServerPort</code>是<code>@Value(&quot;$&#123;local.server.port&#125;&quot;)</code>的元 Comments。不要尝试在常规应用程序中注入端口。如我们所见，仅在初始化容器之后才设置该值。与测试相反，应早处理应用程序代码回调(在值实际可用之前)。</p>
</blockquote>
<h2 id="启用HTTP响应压缩"><a href="#启用HTTP响应压缩" class="headerlink" title="启用HTTP响应压缩"></a>启用HTTP响应压缩</h2><p>Jetty，Tomcat 和 Undertow 支持 HTTP 响应压缩。可以在<code>application.properties</code>中启用它，如下所示：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.compression.enabled</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>
<p>默认情况下，响应的长度必须至少为 2048 个字节才能执行压缩。您可以通过设置<code>server.compression.min-response-size</code>属性来配置此行为。</p>
<p>默认情况下，仅当响应的 Content Type 为以下之一时，它们才被压缩：</p>
<ul>
<li><code>text/html</code></li>
<li><code>text/xml</code></li>
<li><code>text/plain</code></li>
<li><code>text/css</code></li>
<li><code>text/javascript</code></li>
<li><code>application/javascript</code></li>
<li><code>application/json</code></li>
<li><code>application/xml</code></li>
</ul>
<p>您可以通过设置<code>server.compression.mime-types</code>属性来配置此行为。</p>
<h2 id="配置SSL"><a href="#配置SSL" class="headerlink" title="配置SSL"></a>配置SSL</h2><p>可以通过设置各种<code>server.ssl.*</code>属性(通常在<code>application.properties</code>或<code>application.yml</code>中)来声明性地配置 SSL。以下示例显示了在<code>application.properties</code>中设置 SSL 属性：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8443</span></span><br><span class="line"><span class="meta">server.ssl.key-store</span>=<span class="string">classpath:keystore.jks</span></span><br><span class="line"><span class="meta">server.ssl.key-store-password</span>=<span class="string">secret</span></span><br><span class="line"><span class="meta">server.ssl.key-password</span>=<span class="string">another-secret</span></span><br></pre></td></tr></table></figure>
<p>有关所有受支持属性的详细信息，请参见<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/web/server/Ssl.java">Ssl</a>。</p>
<p>使用前面示例中的配置意味着应用程序不再在端口 8080 上支持纯 HTTP 连接器。SpringBoot 不支持通过<code>application.properties</code>配置 HTTP 连接器和 HTTPS 连接器。如果要同时拥有两者，则需要以编程方式配置它们之一。我们建议使用<code>application.properties</code>来配置 HTTPS，因为 HTTP 连接器在两者中以编程方式进行配置比较容易。有关示例，请参见<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples/spring-boot-sample-tomcat-multi-connectors">spring-boot-sample-tomcat-multi-connectors</a>示例项目。</p>
<h2 id="配置HTTP-2"><a href="#配置HTTP-2" class="headerlink" title="配置HTTP/2"></a>配置HTTP/2</h2><p>您可以使用<code>server.http2.enabled</code>配置属性在 Spring Boot 应用程序中启用 HTTP/2 支持。这种支持取决于所选的 Web 服务器和应用程序环境，因为 JDK8 不立即支持该协议。</p>
<blockquote>
<p>Note</p>
<p>Spring Boot 不支持<code>h2c</code>，即 HTTP/2 协议的明文版本。因此，您必须<a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-使用方法指南/#配置SSL">首先配置 SSL</a>。</p>
</blockquote>
<h3 id="具有Undertow的HTTP-2"><a href="#具有Undertow的HTTP-2" class="headerlink" title="具有Undertow的HTTP/2"></a>具有Undertow的HTTP/2</h3><p>从 Undertow 1.4.0 开始，在 JDK8 上无需任何其他要求即可支持 HTTP/2.</p>
<h3 id="使用Jetty的HTTP-2"><a href="#使用Jetty的HTTP-2" class="headerlink" title="使用Jetty的HTTP/2"></a>使用Jetty的HTTP/2</h3><p>从 Jetty 9.4.8 开始，<a target="_blank" rel="noopener" href="https://www.conscrypt.org/">Conscrypt library</a>还支持 HTTP/2.要启用该支持，您的应用程序需要具有两个附加依赖项：<code>org.eclipse.jetty:jetty-alpn-conscrypt-server</code>和<code>org.eclipse.jetty.http2:http2-server</code>。</p>
<h3 id="带有Tomcat的HTTP-2"><a href="#带有Tomcat的HTTP-2" class="headerlink" title="带有Tomcat的HTTP/2"></a>带有Tomcat的HTTP/2</h3><p>默认情况下，Spring Boot 随 Tomcat 9.0.x 一起提供，当使用 JDK 9 或更高版本时，Tomcat 9.0.x 支持 HTTP/2.另外，如果<code>libtcnative</code>库及其依赖项已安装在主机 os 上，则可以在 JDK 8 上使用 HTTP/2.</p>
<p>如果没有，则必须使库文件夹可用于 JVM 库路径。您可以使用 JVM 参数(例如<code>-Djava.library.path=/usr/local/opt/tomcat-native/lib</code>)来执行此操作。有关更多信息，请参见<a target="_blank" rel="noopener" href="https://tomcat.apache.org/tomcat-9.0-doc/apr.html">Tomcat 官方文档</a>。</p>
<p>在没有该本机支持的情况下，在 JDK 8 上启动 Tomcat 9.0.x 会记录以下错误：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR 8787 --- [           main] o.a.coyote.http11.Http11NioProtocol      : The upgrade handler [org.apache.coyote.http2.Http2Protocol] <span class="keyword">for</span> [h2] only supports upgrade via ALPN but has been configured <span class="keyword">for</span> the [<span class="string">&quot;https-jsse-nio-8443&quot;</span>] connector that does not support ALPN.</span><br></pre></td></tr></table></figure>
<p>此错误不是致命错误，并且该应用程序仍以 HTTP/1.1 SSL 支持开头。</p>
<h3 id="具有ReactorNetty的HTTP-2"><a href="#具有ReactorNetty的HTTP-2" class="headerlink" title="具有ReactorNetty的HTTP/2"></a>具有ReactorNetty的HTTP/2</h3><p><code>spring-boot-webflux-starter</code>默认使用 Reactor Netty 作为服务器。使用 JDK 9 或更高版本的 JDK 支持，可以将 Reactor Netty 配置为 HTTP/2.对于 JDK 8 环境或最佳运行时性能，此服务器还支持带有本机库的 HTTP/2.为此，您的应用程序需要具有其他依赖项。</p>
<p>Spring Boot Management<code>io.netty:netty-tcnative-boringssl-static</code>“超级 jar”的版本，其中包含所有平台的本机库。开发人员可以选择使用分类器仅导入所需的依赖项(请参见<a target="_blank" rel="noopener" href="http://netty.io/wiki/forked-tomcat-native.html">Netty 官方文档</a>)。</p>
<h2 id="配置Web服务器"><a href="#配置Web服务器" class="headerlink" title="配置Web服务器"></a>配置Web服务器</h2><p>通常，您应该首先考虑使用许多可用的配置密钥之一，并通过在<code>application.properties</code>(或<code>application.yml</code>或环境等，请参见“ <a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-使用方法指南/#发现外部属性的内置选项">第 77.8 节“发现外部属性的内置选项”</a>”)中添加新条目来自定义 Web 服务器。 <code>server.*</code>命名空间在这里非常有用，它包括<code>server.tomcat.*</code>，<code>server.jetty.*</code>等名称空间，用于特定于服务器的功能。请参阅<a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-附录/">附录 A，通用应用程序属性</a>的列表。</p>
<p>前面的部分已经介绍了许多常见的用例，例如压缩，SSL 或 HTTP/2.但是，如果您的用例不存在配置密钥，则应查看<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/web/server/WebServerFactoryCustomizer.html">WebServerFactoryCustomizer</a>。您可以声明一个这样的组件并访问与您选择的服务器相关的工厂：您应该为所选服务器(Tomcat，Jetty，Reactor Netty，Undertow)和所选 Web 堆栈(Servlet 或 Reactive)选择变体。</p>
<p>以下示例适用于具有<code>spring-boot-starter-web</code>(Servlet 堆栈)的 Tomcat：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTomcatWebServerCustomizer</span></span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">WebServerFactoryCustomizer</span>&lt;<span class="title">TomcatServletWebServerFactory</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(TomcatServletWebServerFactory factory)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// customize the factory here</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此外，Spring Boot 还提供：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Server</th>
<th>Servlet stack</th>
<th>Reactive stack</th>
</tr>
</thead>
<tbody>
<tr>
<td>Tomcat</td>
<td><code>TomcatServletWebServerFactory</code></td>
<td><code>TomcatReactiveWebServerFactory</code></td>
</tr>
<tr>
<td>Jetty</td>
<td><code>JettyServletWebServerFactory</code></td>
<td><code>JettyReactiveWebServerFactory</code></td>
</tr>
<tr>
<td>Undertow</td>
<td><code>UndertowServletWebServerFactory</code></td>
<td><code>UndertowReactiveWebServerFactory</code></td>
</tr>
<tr>
<td>Reactor</td>
<td>N/A</td>
<td><code>NettyReactiveWebServerFactory</code></td>
</tr>
</tbody>
</table>
</div>
<p>获得<code>WebServerFactory</code>的访问权限后，通常可以向其添加定制程序以配置特定的部分，例如连接器，服务器资源或服务器本身-全部使用服务器特定的 API。</p>
<p>作为最后的选择，您还可以声明自己的<code>WebServerFactory</code>组件，它将覆盖 Spring Boot 提供的组件。在这种情况下，您不能再依赖<code>server</code>名称空间中的配置属性。</p>
<h2 id="将Servlet，过滤器或侦听器添加到应用程序"><a href="#将Servlet，过滤器或侦听器添加到应用程序" class="headerlink" title="将Servlet，过滤器或侦听器添加到应用程序"></a>将Servlet，过滤器或侦听器添加到应用程序</h2><p>在 Servlet 堆栈应用程序中，即使用<code>spring-boot-starter-web</code>，有两种方法可以将<code>Servlet</code>，<code>Filter</code>，<code>ServletContextListener</code>和 Servlet API 支持的其他侦听器添加到您的应用程序中：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-使用方法指南/#使用SpringBean添加Servlet，过滤器或侦听器">第 78.10.1 节“使用 Spring Bean 添加 Servlet，过滤器或侦听器”</a></li>
<li><a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-使用方法指南/#使用Classpath扫描添加Servlet，过滤器和侦听器">第 78.10.2 节“使用 Classpath 扫描添加 Servlet，过滤器和侦听器”</a></li>
</ul>
<h3 id="使用SpringBean添加Servlet，过滤器或侦听器"><a href="#使用SpringBean添加Servlet，过滤器或侦听器" class="headerlink" title="使用SpringBean添加Servlet，过滤器或侦听器"></a>使用SpringBean添加Servlet，过滤器或侦听器</h3><p>要使用 Spring bean 添加<code>Servlet</code>，<code>Filter</code>或 Servlet <code>*Listener</code>，您必须为其提供<code>@Bean</code>定义。当您要注入配置或依赖项时，这样做非常有用。但是，您必须非常小心，以免引起过多其他 bean 的急切初始化，因为必须在应用程序生命周期的早期就将它们安装在容器中。 (例如，让它们依赖于您的<code>DataSource</code>或 JPA 配置不是一个好主意.)您可以通过在首次使用 Bean 时(而不是在初始化时)延迟初始化 Bean 来解决这些限制。</p>
<p>对于<code>Filters</code>和<code>Servlets</code>，您还可以通过添加<code>FilterRegistrationBean</code>或<code>ServletRegistrationBean</code>来代替基础组件或在基础组件之外添加 Map 和 init 参数。</p>
<blockquote>
<p>Note</p>
<p>如果在过滤器注册上未指定<code>dispatcherType</code>，则使用<code>REQUEST</code>。这与 Servlet 规范的默认调度程序类型一致。</p>
</blockquote>
<p>像其他任何 Spring bean 一样，您可以定义 Servlet 过滤器 bean 的 Sequences。请确保选中“ <a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-SpringBoot功能/#将Servlet,过滤器和侦听器注册为SpringBean">名为“将 Servlet，过滤器和侦听器注册为 Spring Bean”的部分</a>”部分。</p>
<h4 id="禁用Servlet或过滤器的注册"><a href="#禁用Servlet或过滤器的注册" class="headerlink" title="禁用Servlet或过滤器的注册"></a>禁用Servlet或过滤器的注册</h4><p>作为<a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-使用方法指南/#使用SpringBean添加Servlet，过滤器或侦听器">described earlier</a>，任何<code>Servlet</code>或<code>Filter</code> bean 都会自动注册到 servlet 容器中。要禁用特定<code>Filter</code>或<code>Servlet</code> bean 的注册，请为其创建注册 bean 并将其标记为已禁用，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">registration</span><span class="params">(MyFilter filter)</span> </span>&#123;</span><br><span class="line">    FilterRegistrationBean registration = <span class="keyword">new</span> FilterRegistrationBean(filter);</span><br><span class="line">    registration.setEnabled(<span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">return</span> registration;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用Classpath扫描添加Servlet，过滤器和侦听器"><a href="#使用Classpath扫描添加Servlet，过滤器和侦听器" class="headerlink" title="使用Classpath扫描添加Servlet，过滤器和侦听器"></a>使用Classpath扫描添加Servlet，过滤器和侦听器</h3><p>通过使用<code>@ServletComponentScan</code>Comments<code>@Configuration</code>类并指定包含要注册的组件的包，可以自动将<code>@WebServlet</code>，<code>@WebFilter</code>和<code>@WebListener</code>Comments 的类注册到嵌入式 servlet 容器中。默认情况下，<code>@ServletComponentScan</code>从带 Comments 的类的包中扫描。</p>
<h2 id="配置访问日志"><a href="#配置访问日志" class="headerlink" title="配置访问日志"></a>配置访问日志</h2><p>可以通过它们各自的名称空间为 Tomcat，Undertow 和 Jetty 配置访问日志。</p>
<p>例如，以下设置使用<a target="_blank" rel="noopener" href="https://tomcat.apache.org/tomcat-8.5-doc/config/valve.html#Access_Logging">custom pattern</a>记录对 Tomcat 的访问。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.tomcat.basedir</span>=<span class="string">my-tomcat</span></span><br><span class="line"><span class="meta">server.tomcat.accesslog.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">server.tomcat.accesslog.pattern</span>=<span class="string">%t %a &quot;%r&quot; %s (%D ms)</span></span><br></pre></td></tr></table></figure>
<p>Note</p>
<p>日志的默认位置是相对于 Tomcat 基本目录的<code>logs</code>目录。默认情况下，<code>logs</code>目录是一个临时目录，因此您可能需要修复 Tomcat 的基本目录或对日志使用绝对路径。在前面的示例中，相对于应用程序的工作目录，日志位于<code>my-tomcat/logs</code>中。</p>
<p>可以用类似的方式配置 Undertow 的访问日志，如以下示例所示：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.undertow.accesslog.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">server.undertow.accesslog.pattern</span>=<span class="string">%t %a &quot;%r&quot; %s (%D ms)</span></span><br></pre></td></tr></table></figure>
<p>日志存储在相对于应用程序工作目录的<code>logs</code>目录中。您可以通过设置<code>server.undertow.accesslog.directory</code>属性来自定义此位置。</p>
<p>最后，Jetty 的访问日志也可以配置如下：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.jetty.accesslog.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">server.jetty.accesslog.filename</span>=<span class="string">/var/log/jetty-access.log</span></span><br></pre></td></tr></table></figure>
<p>默认情况下，日志重定向到<code>System.err</code>。有关更多详细信息，请参见<a target="_blank" rel="noopener" href="https://www.eclipse.org/jetty/documentation/9.4.x/configuring-jetty-request-logs.html">Jetty 文件</a>。</p>
<h2 id="在前端代理服务器后面运行"><a href="#在前端代理服务器后面运行" class="headerlink" title="在前端代理服务器后面运行"></a>在前端代理服务器后面运行</h2><p>您的应用程序可能需要发送<code>302</code>重定向或使用绝对链接将内容渲染回自身。当在代理后面运行时，调用者需要链接到代理，而不要链接到托管您的应用的计算机的物理地址。通常，此类情况是通过与代理之间的 Contract 来处理的，该代理添加了 Headers，以告诉后端如何构造与自身的链接。</p>
<p>如果代理添加了常规的<code>X-Forwarded-For</code>和<code>X-Forwarded-Proto</code>Headers(大多数代理服务器都这样做)，则在<code>application.properties</code>中将<code>server.use-forward-headers</code>设置为<code>true</code>的情况下，应正确渲染绝对链接。</p>
<blockquote>
<p>Note</p>
<p>如果您的应用程序在 Cloud Foundry 或 Heroku 中运行，则<code>server.use-forward-headers</code>属性默认为<code>true</code>。在所有其他情况下，它默认为<code>false</code>。</p>
</blockquote>
<h3 id="自定义Tomcat的代理配置"><a href="#自定义Tomcat的代理配置" class="headerlink" title="自定义Tomcat的代理配置"></a>自定义Tomcat的代理配置</h3><p>如果使用 Tomcat，则可以另外配置用于携带“转发的”信息的 Headers 名称，如以下示例所示：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.tomcat.remote-ip-header</span>=<span class="string">x-your-remote-ip-header</span></span><br><span class="line"><span class="meta">server.tomcat.protocol-header</span>=<span class="string">x-your-protocol-header</span></span><br></pre></td></tr></table></figure>
<p>Tomcat 还配置有默认正则表达式，该正则表达式与要信任的内部代理匹配。默认情况下，<code>10/8</code>，<code>192.168/16</code>，<code>169.254/16</code>和<code>127/8</code>中的 IP 地址是受信任的。您可以通过在<code>application.properties</code>上添加一个条目来定制阀门的配置，如以下示例所示：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.tomcat.internal-proxies</span>=<span class="string">192\\.168\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note</p>
<p>仅当使用属性文件进行配置时，才需要双反斜杠。如果使用 YAML，则单个反斜杠就足够了，并且与上一个示例中所示的值相等的值为<code>192\.168\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;</code>。</p>
<p>Note</p>
<p>您可以通过将<code>internal-proxies</code>设置为空来信任所有代理(但在生产环境中不要这样做)。</p>
<p>您可以完全关闭 Tomcat <code>RemoteIpValve</code>的配置，方法是关闭自动开关(为此，设置<code>server.use-forward-headers=false</code>)并在<code>TomcatServletWebServerFactory</code> bean 中添加新的 Valve 实例。</p>
</blockquote>
<h2 id="使用Tomcat启用多个连接器"><a href="#使用Tomcat启用多个连接器" class="headerlink" title="使用Tomcat启用多个连接器"></a>使用Tomcat启用多个连接器</h2><p>您可以将<code>org.apache.catalina.connector.Connector</code>添加到<code>TomcatServletWebServerFactory</code>，这可以允许多个连接器，包括 HTTP 和 HTTPS 连接器，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServletWebServerFactory <span class="title">servletContainer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    TomcatServletWebServerFactory tomcat = <span class="keyword">new</span> TomcatServletWebServerFactory();</span><br><span class="line">    tomcat.addAdditionalTomcatConnectors(createSslConnector());</span><br><span class="line">    <span class="keyword">return</span> tomcat;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> Connector <span class="title">createSslConnector</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Connector connector = <span class="keyword">new</span> Connector(<span class="string">&quot;org.apache.coyote.http11.Http11NioProtocol&quot;</span>);</span><br><span class="line">    Http11NioProtocol protocol = (Http11NioProtocol) connector.getProtocolHandler();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        File keystore = <span class="keyword">new</span> ClassPathResource(<span class="string">&quot;keystore&quot;</span>).getFile();</span><br><span class="line">        File truststore = <span class="keyword">new</span> ClassPathResource(<span class="string">&quot;keystore&quot;</span>).getFile();</span><br><span class="line">        connector.setScheme(<span class="string">&quot;https&quot;</span>);</span><br><span class="line">        connector.setSecure(<span class="keyword">true</span>);</span><br><span class="line">        connector.setPort(<span class="number">8443</span>);</span><br><span class="line">        protocol.setSSLEnabled(<span class="keyword">true</span>);</span><br><span class="line">        protocol.setKeystoreFile(keystore.getAbsolutePath());</span><br><span class="line">        protocol.setKeystorePass(<span class="string">&quot;changeit&quot;</span>);</span><br><span class="line">        protocol.setTruststoreFile(truststore.getAbsolutePath());</span><br><span class="line">        protocol.setTruststorePass(<span class="string">&quot;changeit&quot;</span>);</span><br><span class="line">        protocol.setKeyAlias(<span class="string">&quot;apitester&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> connector;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;can&#x27;t access keystore: [&quot;</span> + <span class="string">&quot;keystore&quot;</span></span><br><span class="line">                + <span class="string">&quot;] or truststore: [&quot;</span> + <span class="string">&quot;keystore&quot;</span> + <span class="string">&quot;]&quot;</span>, ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用Tomcat的LegacyCookieProcessor"><a href="#使用Tomcat的LegacyCookieProcessor" class="headerlink" title="使用Tomcat的LegacyCookieProcessor"></a>使用Tomcat的LegacyCookieProcessor</h2><p>默认情况下，Spring Boot 使用的嵌入式 Tomcat 不支持 Cookie 格式的“版本 0”，因此您可能会看到以下错误：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IllegalArgumentException: An invalid character [32] was present <span class="keyword">in</span> the Cookie value</span><br></pre></td></tr></table></figure>
<p>如果有可能，您应该考虑将代码更新为仅存储符合以后 Cookie 规范的值。但是，如果无法更改 cookie 的编写方式，则可以将 Tomcat 配置为使用<code>LegacyCookieProcessor</code>。要切换到<code>LegacyCookieProcessor</code>，请使用添加了<code>TomcatContextCustomizer</code>的<code>WebServerFactoryCustomizer</code> bean，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> WebServerFactoryCustomizer&lt;TomcatServletWebServerFactory&gt; <span class="title">cookieProcessorCustomizer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (factory) -&gt; factory.addContextCustomizers(</span><br><span class="line">            (context) -&gt; context.setCookieProcessor(<span class="keyword">new</span> LegacyCookieProcessor()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用Undertow启用多个侦听器"><a href="#使用Undertow启用多个侦听器" class="headerlink" title="使用Undertow启用多个侦听器"></a>使用Undertow启用多个侦听器</h2><p>将<code>UndertowBuilderCustomizer</code>添加到<code>UndertowServletWebServerFactory</code>并将侦听器添加到<code>Builder</code>，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> UndertowServletWebServerFactory <span class="title">servletWebServerFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    UndertowServletWebServerFactory factory = <span class="keyword">new</span> UndertowServletWebServerFactory();</span><br><span class="line">    factory.addBuilderCustomizers(<span class="keyword">new</span> UndertowBuilderCustomizer() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(Builder builder)</span> </span>&#123;</span><br><span class="line">            builder.addHttpListener(<span class="number">8080</span>, <span class="string">&quot;0.0.0.0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> factory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用ServerEndpoint注解创建WebSocket端点"><a href="#使用ServerEndpoint注解创建WebSocket端点" class="headerlink" title="使用ServerEndpoint注解创建WebSocket端点"></a>使用ServerEndpoint注解创建WebSocket端点</h2><p>如果要在使用嵌入式容器的 Spring Boot 应用程序中使用<code>@ServerEndpoint</code>，则必须声明一个<code>ServerEndpointExporter</code> <code>@Bean</code>，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServerEndpointExporter <span class="title">serverEndpointExporter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ServerEndpointExporter();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>前面示例中显示的 Bean 在基础 WebSocket 容器中注册了所有带有<code>@ServerEndpoint</code>Comments 的 Bean。当部署到独立 servlet 容器时，此角色由 servlet 容器初始化程序执行，并且不需要<code>ServerEndpointExporter</code> bean。</p>
<h1 id="SpringMVC"><a href="#SpringMVC" class="headerlink" title="SpringMVC"></a>SpringMVC</h1><p>Spring Boot 有许多启动器，其中包括 Spring MVC。请注意，一些 Starter 者包括对 Spring MVC 的依赖，而不是直接包含它。本部分回答有关 Spring MVC 和 Spring Boot 的常见问题。</p>
<h2 id="编写JSONREST服务"><a href="#编写JSONREST服务" class="headerlink" title="编写JSONREST服务"></a>编写JSONREST服务</h2><p>默认情况下，只要 Jackson2 在 Classpath 上，Spring Boot 应用程序中的任何 Spring <code>@RestController</code>都应渲染 JSON 响应，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/thing&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MyThing <span class="title">thing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> MyThing();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>只要 Jackson_2 可以将<code>MyThing</code>序列化(对于普通的 POJO 或 Groovy 对象为 true)，则默认情况下<code>localhost:8080/thing</code>为其提供 JSON 表示。请注意，在浏览器中，有时可能会看到 XML 响应，因为浏览器倾向于发送更喜欢 XML 的接受 Headers。</p>
<h2 id="编写XMLREST服务"><a href="#编写XMLREST服务" class="headerlink" title="编写XMLREST服务"></a>编写XMLREST服务</h2><p>如果 Classpath 上具有 Jackson XML extensions(<code>jackson-dataformat-xml</code>)，则可以使用它来渲染 XML 响应。我们用于 JSON 的先前示例可以正常工作。要使用 Jackson XML 渲染器，请将以下依赖项添加到您的项目中：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果无法使用 Jackson 的 XML extensions，则使用 JAXB(JDK 中默认提供)，另外要求将<code>MyThing</code>标注为<code>@XmlRootElement</code>，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@XmlRootElement</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThing</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">// .. getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>要使服务器渲染 XML 而不是 JSON，您可能必须发送<code>Accept: text/xml</code>Headers(或使用浏览器)。</p>
<h2 id="自定义JacksonObjectMapper"><a href="#自定义JacksonObjectMapper" class="headerlink" title="自定义JacksonObjectMapper"></a>自定义JacksonObjectMapper</h2><p>Spring MVC(Client 端和服务器端)使用<code>HttpMessageConverters</code>来协商 HTTP 交换中的内容转换。如果 Jackson 在 Classpath 中，则您已经获得<code>Jackson2ObjectMapperBuilder</code>提供的默认转换器，该转换器的实例已为您自动配置。</p>
<p><code>ObjectMapper</code>(对于 Jackson XML 转换器，则为<code>XmlMapper</code>)实例(默认情况下创建)具有以下自定义属性：</p>
<ul>
<li><code>MapperFeature.DEFAULT_VIEW_INCLUSION</code>已禁用</li>
<li><code>DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES</code>已禁用</li>
<li><code>SerializationFeature.WRITE_DATES_AS_TIMESTAMPS</code>已禁用</li>
</ul>
<p>Spring Boot 还具有一些功能，可以更轻松地自定义此行为。</p>
<p>您可以使用环境配置<code>ObjectMapper</code>和<code>XmlMapper</code>实例。Jackson 提供了一套广泛的简单的开/关功能，可用于配置其处理的各个方面。在六个枚举(在 Jackson 中)中描述了这些功能，这些枚举 Map 到环境中的属性：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Enum</th>
<th>Property</th>
<th>Values</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>com.fasterxml.jackson.databind.DeserializationFeature</code></td>
<td><code>spring.jackson.deserialization.&lt;feature_name&gt;</code></td>
<td><code>true</code> , <code>false</code></td>
</tr>
<tr>
<td><code>com.fasterxml.jackson.core.JsonGenerator.Feature</code></td>
<td><code>spring.jackson.generator.&lt;feature_name&gt;</code></td>
<td><code>true</code> , <code>false</code></td>
</tr>
<tr>
<td><code>com.fasterxml.jackson.databind.MapperFeature</code></td>
<td><code>spring.jackson.mapper.&lt;feature_name&gt;</code></td>
<td><code>true</code> , <code>false</code></td>
</tr>
<tr>
<td><code>com.fasterxml.jackson.core.JsonParser.Feature</code></td>
<td><code>spring.jackson.parser.&lt;feature_name&gt;</code></td>
<td><code>true</code> , <code>false</code></td>
</tr>
<tr>
<td><code>com.fasterxml.jackson.databind.SerializationFeature</code></td>
<td><code>spring.jackson.serialization.&lt;feature_name&gt;</code></td>
<td><code>true</code> , <code>false</code></td>
</tr>
<tr>
<td><code>com.fasterxml.jackson.annotation.JsonInclude.Include</code></td>
<td><code>spring.jackson.default-property-inclusion</code></td>
<td><code>always</code> , <code>non_null</code> , <code>non_absent</code> , <code>non_default</code> , <code>non_empty</code></td>
</tr>
</tbody>
</table>
</div>
<p>例如，要启用漂亮打印，请设置<code>spring.jackson.serialization.indent_output=true</code>。注意，由于使用了<a target="_blank" rel="noopener" href="https://www.docs4dev.com/docs/zh/spring-boot/2.1.1.RELEASE/reference/boot-features-external-config.html#boot-features-external-config-relaxed-binding">relaxed binding</a>，<code>indent_output</code>的情况不必与相应的枚举常量<code>INDENT_OUTPUT</code>的情况匹配。</p>
<p>这种基于环境的配置将应用于自动配置的<code>Jackson2ObjectMapperBuilder</code> bean，并应用于使用构建器创建的任何 Map 器，包括自动配置的<code>ObjectMapper</code> bean。</p>
<p>上下文的<code>Jackson2ObjectMapperBuilder</code>可以由一个或多个<code>Jackson2ObjectMapperBuilderCustomizer</code> bean 进行自定义。可以对此类定制器 bean 进行排序(Boot 自己的定制器的 Sequences 为 0)，从而可以在 Boot 定制之前和之后应用其他定制。</p>
<p>类型为<code>com.fasterxml.jackson.databind.Module</code>的任何 bean 都会自动向自动配置的<code>Jackson2ObjectMapperBuilder</code>注册，并应用于它创建的<code>ObjectMapper</code>实例。当您向应用程序中添加新功能时，这提供了一种用于贡献自定义模块的全局机制。</p>
<p>如果要完全替换默认的<code>ObjectMapper</code>，请定义该类型的<code>@Bean</code>并将其标记为<code>@Primary</code>，或者，如果您更喜欢基于构建器的方法，请定义<code>Jackson2ObjectMapperBuilder</code> <code>@Bean</code>。请注意，无论哪种情况，这样做都会禁用<code>ObjectMapper</code>的所有自动配置。</p>
<p>如果您提供任何<code>MappingJackson2HttpMessageConverter</code>类型的<code>@Beans</code>，它们将替换 MVC 配置中的默认值。此外，还提供了<code>HttpMessageConverters</code>类型的便捷 bean(如果使用默认的 MVC 配置，则始终可用)。它提供了一些有用的方法来访问默认的和用户增强的消息转换器。</p>
<p>有关更多详细信息，请参见“ <a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-使用方法指南/#自定义ResponseBody注解渲染">第 79.4 节“自定义@ResponseBody 渲染”</a>”部分和<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/servlet/WebMvcAutoConfiguration.java">WebMvcAutoConfiguration</a>源代码。</p>
<h2 id="自定义ResponseBody注解渲染"><a href="#自定义ResponseBody注解渲染" class="headerlink" title="自定义ResponseBody注解渲染"></a>自定义ResponseBody注解渲染</h2><p>Spring 使用<code>HttpMessageConverters</code>渲染<code>@ResponseBody</code>(或<code>@RestController</code>的响应)。您可以通过在 Spring Boot 上下文中添加适当类型的 bean 来贡献额外的转换器。如果您添加的 bean 的类型无论如何都是默认包含的(例如<code>MappingJackson2HttpMessageConverter</code>表示 JSON 转换)，它将替换默认值。提供了<code>HttpMessageConverters</code>类型的便捷 bean，如果使用默认的 MVC 配置，它将始终可用。它有一些有用的方法来访问默认的和用户增强的消息转换器(例如，如果要手动将它们注入到自定义<code>RestTemplate</code>中，则可能会很有用)。</p>
<p>与正常的 MVC 用法一样，您提供的任何<code>WebMvcConfigurer</code> bean 也可以通过覆盖<code>configureMessageConverters</code>方法来贡献转换器。但是，与普通的 MVC 不同，您只能提供所需的其他转换器(因为 Spring Boot 使用相同的机制来提供其默认值)。最后，如果您通过提供自己的<code>@EnableWebMvc</code>配置选择退出 Spring Boot 默认 MVC 配置，则可以完全控制并通过使用<code>WebMvcConfigurationSupport</code>中的<code>getMessageConverters</code>手动进行所有操作。</p>
<p>有关更多详细信息，请参见<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/servlet/WebMvcAutoConfiguration.java">WebMvcAutoConfiguration</a>源代码。</p>
<h2 id="处理分段文件上传"><a href="#处理分段文件上传" class="headerlink" title="处理分段文件上传"></a>处理分段文件上传</h2><p>Spring Boot 包含 Servlet 3 <code>javax.servlet.http.Part</code> API 以支持上传文件。默认情况下，Spring Boot 用单个请求将 Spring MVC 配置为每个文件最大大小为 1MB，最大文件数据为 10MB。您可以使用<code>MultipartProperties</code>类中公开的属性覆盖这些值，存储中间数据的位置(例如，存储到<code>/tmp</code>目录)以及将数据刷新到磁盘的阈值。例如，如果要指定文件不受限制，请将<code>spring.servlet.multipart.max-file-size</code>属性设置为<code>-1</code>。</p>
<p>当您想在 Spring MVC 控制器处理程序方法中接收 Multipart 编码的文件数据作为<code>@RequestParam</code>Comments 类型<code>MultipartFile</code>的参数时，Multipart 支持会很有帮助。</p>
<p>有关更多详细信息，请参见<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/servlet/MultipartAutoConfiguration.java">MultipartAutoConfiguration</a>源。</p>
<blockquote>
<p>Note</p>
<p>建议使用容器的内置支持进行分段上传，而不要引入其他依赖项，例如 Apache Commons File Upload。</p>
</blockquote>
<h2 id="关闭SpringMVCDispatcherServlet"><a href="#关闭SpringMVCDispatcherServlet" class="headerlink" title="关闭SpringMVCDispatcherServlet"></a>关闭SpringMVCDispatcherServlet</h2><p>默认情况下，所有内容均从应用程序的根目录(<code>/</code>)提供。如果您希望 Map 到其他路径，则可以如下配置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.mvc.servlet.path</span>=<span class="string">/acme</span></span><br></pre></td></tr></table></figure>
<p>如果您还有其他 servlet，则可以为每个 servlet 声明<code>Servlet</code>或<code>ServletRegistrationBean</code>类型的<code>@Bean</code>，Spring Boot 会将它们透明地注册到容器中。因为 servlet 是通过这种方式注册的，所以可以将它们 Map 到<code>DispatcherServlet</code>的子上下文而无需调用它。</p>
<p>自己配置<code>DispatcherServlet</code>是不寻常的，但如果确实需要配置，则还必须提供<code>DispatcherServletPath</code>类型的<code>@Bean</code>以提供自定义<code>DispatcherServlet</code>的路径。</p>
<h2 id="关闭默认的MVC配置"><a href="#关闭默认的MVC配置" class="headerlink" title="关闭默认的MVC配置"></a>关闭默认的MVC配置</h2><p>完全控制 MVC 配置的最简单方法是为自己的<code>@Configuration</code>提供<code>@EnableWebMvc</code>注解。这样做会使您掌握所有 MVC 配置。</p>
<h2 id="自定义ViewResolvers"><a href="#自定义ViewResolvers" class="headerlink" title="自定义ViewResolvers"></a>自定义ViewResolvers</h2><p><code>ViewResolver</code>是 Spring MVC 的核心组件，将<code>@Controller</code>中的视图名称转换为实际的<code>View</code>实现。请注意，<code>ViewResolvers</code>主要用于 UI 应用程序，而不是 REST 风格的服务(<code>View</code>不用于渲染<code>@ResponseBody</code>)。 <code>ViewResolver</code>的实现有很多可供选择，而 Spring 本身并未就应该使用哪个实现提出意见。另一方面，Spring Boot 会根据您在 Classpath 和应用程序上下文中找到的内容为您安装一两个。 <code>DispatcherServlet</code>使用它在应用程序上下文中找到的所有解析器，依次尝试每个解析器直到得到结果，因此，如果添加自己的解析器，则必须知道解析器的 Sequences 和添加位置。</p>
<p><code>WebMvcAutoConfiguration</code>将以下<code>ViewResolvers</code>添加到您的上下文中：</p>
<ul>
<li><code>InternalResourceViewResolver</code>名为“ defaultViewResolver”。此代码查找可以使用<code>DefaultServlet</code>渲染的物理资源(包括静态资源和 JSP 页面，如果使用的话)。它在视图名称上应用前缀和后缀，然后在 Servlet 上下文中查找具有该路径的物理资源(默认值均为空，但可通过<code>spring.mvc.view.prefix</code>和<code>spring.mvc.view.suffix</code>进行外部配置访问)。您可以通过提供相同类型的 bean 覆盖它。</li>
<li><code>BeanNameViewResolver</code>名为“ beanNameViewResolver”。这是视图解析器链的有用成员，可以拾取与要解析的<code>View</code>同名的所有 bean。不必重写或替换它。</li>
<li>仅当实际存在<code>View</code>类型的 Bean 时，才添加名为<code>ContentNegotiatingViewResolver</code>的“ viewResolver”。这是一个“主”解析器，委派给所有其他解析器，并尝试查找与 Client 端发送的“ Accept” HTTP Headers 匹配的内容。您可能想学习有用的<a target="_blank" rel="noopener" href="https://spring.io/blog/2013/06/03/content-negotiation-using-views">关于 ContentNegotiatingViewResolver 的博客</a>以了解更多信息，也可以查看源代码以获取详细信息。您可以通过定义一个名为’viewResolver’的 bean 来关闭自动配置的<code>ContentNegotiatingViewResolver</code>。</li>
<li>如果您使用 Thymeleaf，则还有一个<code>ThymeleafViewResolver</code>，名为“ thymeleafViewResolver”。它通过在视图名称前后加上前缀和后缀来查找资源。前缀为<code>spring.thymeleaf.prefix</code>，后缀为<code>spring.thymeleaf.suffix</code>。前缀和后缀的值分别默认为“ classpath：/ templates /”和“ .html”。您可以通过提供同名的 bean 来覆盖<code>ThymeleafViewResolver</code>。</li>
<li>如果使用 FreeMarker，则还有一个<code>FreeMarkerViewResolver</code>名为“ freeMarkerViewResolver”。它通过在视图名称前加上前缀和后缀来在加载程序路径(外部化为<code>spring.freemarker.templateLoaderPath</code>且默认值为“ classpath：/ templates /”)中查找资源。前缀外部化为<code>spring.freemarker.prefix</code>，后缀外部化为<code>spring.freemarker.suffix</code>。前缀和后缀的默认值分别为空和’.ftl’。您可以通过提供同名的 bean 来覆盖<code>FreeMarkerViewResolver</code>。</li>
<li>如果您使用 Groovy 模板(实际上，如果<code>groovy-templates</code>在 Classpath 上)，则您也有一个<code>GroovyMarkupViewResolver</code>，名为“ groovyMarkupViewResolver”。它通过在视图名称前加上前缀和后缀(扩展为<code>spring.groovy.template.prefix</code>和<code>spring.groovy.template.suffix</code>)来在加载程序路径中查找资源。前缀和后缀分别具有默认值’classpath：/ templates /‘和’.tpl’。您可以通过提供同名的 bean 来覆盖<code>GroovyMarkupViewResolver</code>。</li>
</ul>
<p>有关更多详细信息，请参见以下部分：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/servlet/WebMvcAutoConfiguration.java">WebMvcAutoConfiguration</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/thymeleaf/ThymeleafAutoConfiguration.java">ThymeleafAutoConfiguration</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/freemarker/FreeMarkerAutoConfiguration.java">FreeMarkerAutoConfiguration</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/groovy/template/GroovyTemplateAutoConfiguration.java">GroovyTemplateAutoConfiguration</a></li>
</ul>
<h1 id="使用SpringSecurity进行测试"><a href="#使用SpringSecurity进行测试" class="headerlink" title="使用SpringSecurity进行测试"></a>使用SpringSecurity进行测试</h1><p>Spring Security 提供了对以特定用户身份运行测试的支持。例如，下面的代码段中的测试将与具有<code>ADMIN</code>角色的经过身份验证的用户一起运行。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@WithMockUser(roles=&quot;ADMIN&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">requestProtectedUrlWithUser</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    mvc</span><br><span class="line">        .perform(get(<span class="string">&quot;/&quot;</span>))</span><br><span class="line">        ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Spring Security 提供了与 Spring MVC Test 的全面集成，并且在使用<code>@WebMvcTest</code> slice 和<code>MockMvc</code>测试控制器时也可以使用它。</p>
<p>有关 Spring Security 的测试支持的更多详细信息，请参阅 Spring Security 的<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/#test">reference documentation</a>。</p>
<h1 id="Jersey"><a href="#Jersey" class="headerlink" title="Jersey"></a>Jersey</h1><h2 id="使用SpringSecurity的安全Jersey端点"><a href="#使用SpringSecurity的安全Jersey端点" class="headerlink" title="使用SpringSecurity的安全Jersey端点"></a>使用SpringSecurity的安全Jersey端点</h2><p>可以使用 Spring Security 来保护基于 Jersey 的 Web 应用程序，其方式与用来保护基于 Spring MVC 的 Web 应用程序的方式几乎相同。但是，如果您想通过 Jersey 使用 Spring Security 的方法级安全性，则必须将 Jersey 配置为使用<code>setStatus(int)</code>而不是<code>sendError(int)</code>。这可以防止 Jersey 在 Spring Security 有机会向 Client 端报告身份验证或授权失败之前提交响应。</p>
<p>必须在应用程序的<code>ResourceConfig</code> bean 上将<code>jersey.config.server.response.setStatusOverSendError</code>属性设置为<code>true</code>，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JerseyConfig</span> <span class="keyword">extends</span> <span class="title">ResourceConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JerseyConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        register(Endpoint.class);</span><br><span class="line">        setProperties(Collections.singletonMap(</span><br><span class="line">                <span class="string">&quot;jersey.config.server.response.setStatusOverSendError&quot;</span>, <span class="keyword">true</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="HTTPClient端"><a href="#HTTPClient端" class="headerlink" title="HTTPClient端"></a>HTTPClient端</h1><p>Spring Boot 提供了许多与 HTTP Client 端一起使用的启动器。本节回答与使用它们有关的问题。</p>
<h2 id="配置RestTemplate以使用代理"><a href="#配置RestTemplate以使用代理" class="headerlink" title="配置RestTemplate以使用代理"></a>配置RestTemplate以使用代理</h2><p>如<a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-SpringBoot功能/#RestTemplate自定义">第 34.1 节“ RestTemplate 自定义”</a>中所述，您可以将<code>RestTemplateCustomizer</code>与<code>RestTemplateBuilder</code>结合使用来构建自定义的<code>RestTemplate</code>。建议使用此方法来创建配置为使用代理的<code>RestTemplate</code>。</p>
<p>代理配置的确切详细信息取决于所使用的基础 Client 端请求工厂。以下示例将<code>HttpComponentsClientRequestFactory</code>与<code>HttpClient</code>配置为对<code>192.168.0.5</code>以外的所有主机使用代理：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyCustomizer</span> <span class="keyword">implements</span> <span class="title">RestTemplateCustomizer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(RestTemplate restTemplate)</span> </span>&#123;</span><br><span class="line">        HttpHost proxy = <span class="keyword">new</span> HttpHost(<span class="string">&quot;proxy.example.com&quot;</span>);</span><br><span class="line">        HttpClient httpClient = HttpClientBuilder.create()</span><br><span class="line">                .setRoutePlanner(<span class="keyword">new</span> DefaultProxyRoutePlanner(proxy) &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> HttpHost <span class="title">determineProxy</span><span class="params">(HttpHost target,</span></span></span><br><span class="line"><span class="function"><span class="params">                            HttpRequest request, HttpContext context)</span></span></span><br><span class="line"><span class="function">                            <span class="keyword">throws</span> HttpException </span>&#123;</span><br><span class="line">                        <span class="keyword">if</span> (target.getHostName().equals(<span class="string">&quot;192.168.0.5&quot;</span>)) &#123;</span><br><span class="line">                            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">super</span>.determineProxy(target, request, context);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;).build();</span><br><span class="line">        restTemplate.setRequestFactory(</span><br><span class="line">                <span class="keyword">new</span> HttpComponentsClientHttpRequestFactory(httpClient));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Logging"><a href="#Logging" class="headerlink" title="Logging"></a>Logging</h1><p>除了通常由 Spring Framework 的<code>spring-jcl</code>模块提供的 Commons Logging API 以外，Spring Boot 没有强制性的日志记录依赖项。要使用<a target="_blank" rel="noopener" href="http://logback.qos.ch/">Logback</a>，您需要在 Classpath 中包括它和<code>spring-jcl</code>。最简单的方法是通过启动器，它们都取决于<code>spring-boot-starter-logging</code>。对于 Web 应用程序，您只需要<code>spring-boot-starter-web</code>，因为它暂时取决于日志记录启动器。如果使用 Maven，则以下依赖项会为您添加日志记录：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Spring Boot 具有<code>LoggingSystem</code>抽象，该抽象试图基于 Classpath 的内容配置日志记录。如果可以使用 Logback，则它是首选。</p>
<p>如果您唯一需要对日志记录进行的更改是设置各种 Logger 的级别，则可以使用“ logging.level”前缀在<code>application.properties</code>中进行设置，如以下示例所示：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">logging.level.org.springframework.web</span>=<span class="string">DEBUG</span></span><br><span class="line"><span class="meta">logging.level.org.hibernate</span>=<span class="string">ERROR</span></span><br></pre></td></tr></table></figure>
<p>您还可以使用“ logging.file”设置日志的文件位置(控制台除外)。</p>
<p>要配置日志记录系统的更细粒度的设置，您需要使用所讨论的<code>LoggingSystem</code>支持的本机配置格式。默认情况下，Spring Boot 从系统的默认位置(例如<code>classpath:logback.xml</code>用于 Logback)获取本地配置，但是您可以使用“ logging.config”属性来设置配置文件的位置。</p>
<h2 id="配置日志记录的日志回传"><a href="#配置日志记录的日志回传" class="headerlink" title="配置日志记录的日志回传"></a>配置日志记录的日志回传</h2><p>如果将<code>logback.xml</code>放在 Classpath 的根目录中，则从那里(或从<code>logback-spring.xml</code>拾取它，以利用 Boot 提供的模板功能)。 Spring Boot 提供了一个默认的基本配置，如果您想设置级别，可以将其包括在内，如以下示例所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">resource</span>=<span class="string">&quot;org/springframework/boot/logging/logback/base.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.springframework.web&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果您在 spring-boot jar 中查看<code>base.xml</code>，您会发现它使用了一些有用的 System 属性，而<code>LoggingSystem</code>会为您创建这些属性：</p>
<ul>
<li><code>$&#123;PID&#125;</code>：当前进程 ID。</li>
<li><code>$&#123;LOG_FILE&#125;</code>：是否在 Boot 的外部配置中设置了<code>logging.file</code>。</li>
<li><code>$&#123;LOG_PATH&#125;</code>：是否在 Boot 的外部配置中设置了<code>logging.path</code>(表示要存放日志文件的目录)。</li>
<li><code>$&#123;LOG_EXCEPTION_CONVERSION_WORD&#125;</code>：是否在 Boot 的外部配置中设置了<code>logging.exception-conversion-word</code>。</li>
</ul>
<p>通过使用自定义的 Logback 转换器，Spring Boot 还可以在控制台上提供一些不错的 ANSI 颜色终端输出(但不在日志文件中)。有关详细信息，请参见默认的<code>base.xml</code>配置。</p>
<p>如果 Groovy 在 Classpath 上，那么您也应该能够使用<code>logback.groovy</code>配置 Logback。如果存在，则优先考虑此设置。</p>
<h3 id="为仅文件输出配置Logback"><a href="#为仅文件输出配置Logback" class="headerlink" title="为仅文件输出配置Logback"></a>为仅文件输出配置Logback</h3><p>如果要禁用控制台日志记录并仅将输出写入文件，则需要一个自定义<code>logback-spring.xml</code>，它导入<code>file-appender.xml</code>但不导入<code>console-appender.xml</code>，如以下示例所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">resource</span>=<span class="string">&quot;org/springframework/boot/logging/logback/defaults.xml&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;LOG_FILE&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;LOG_FILE:-$&#123;LOG_PATH:-$&#123;LOG_TEMP:-$&#123;java.io.tmpdir:-/tmp&#125;&#125;/&#125;spring.log&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">resource</span>=<span class="string">&quot;org/springframework/boot/logging/logback/file-appender.xml&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>您还需要将<code>logging.file</code>添加到<code>application.properties</code>，如以下示例所示：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">logging.file</span>=<span class="string">myapplication.log</span></span><br></pre></td></tr></table></figure>
<h2 id="配置Log4j进行日志记录"><a href="#配置Log4j进行日志记录" class="headerlink" title="配置Log4j进行日志记录"></a>配置Log4j进行日志记录</h2><p>如果 Spring Boot 在 Classpath 中，则支持<a target="_blank" rel="noopener" href="https://logging.apache.org/log4j/2.x">Log4j 2</a>进行日志记录配置。如果使用 Starter 程序来组装依赖项，则必须排除 Logback，然后改为包括 log4j 2.如果您不使用启动器，则除了 Log4j 2 外，还需要(至少)提供<code>spring-jcl</code>。</p>
<p>最简单的方法可能是通过启动程序，即使它需要对排除对象进行微调。以下示例显示了如何在 Maven 中设置启动器：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>以下示例显示了在 Gradle 中设置启动器的一种方法：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile <span class="string">&#x27;org.springframework.boot:spring-boot-starter-web&#x27;</span></span><br><span class="line">    compile <span class="string">&#x27;org.springframework.boot:spring-boot-starter-log4j2&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">configurations &#123;</span><br><span class="line">    all &#123;</span><br><span class="line">        exclude <span class="attr">group:</span> <span class="string">&#x27;org.springframework.boot&#x27;</span>, <span class="attr">module:</span> <span class="string">&#x27;spring-boot-starter-logging&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note</p>
<p>Log4j Starter 人员将依赖关系集中在一起，以满足常见的日志记录要求(例如让 Tomcat 使用<code>java.util.logging</code>，但使用 Log4j 2 配置输出)。有关详细信息，请参见<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples/spring-boot-sample-actuator-log4j2">Actuator Log4j 2</a>示例，并查看实际效果。</p>
<p>Note</p>
<p>为了确保将使用<code>java.util.logging</code>执行的调试日志记录路由到 Log4j 2 中，可以通过将<code>java.util.logging.manager</code>系统属性设置为<code>org.apache.logging.log4j.jul.LogManager</code>来配置其<a target="_blank" rel="noopener" href="https://logging.apache.org/log4j/2.0/log4j-jul/index.html">JDK 记录适配器</a>。</p>
</blockquote>
<h3 id="使用YAML或JSON配置Log4j-2"><a href="#使用YAML或JSON配置Log4j-2" class="headerlink" title="使用YAML或JSON配置Log4j 2"></a>使用YAML或JSON配置Log4j 2</h3><p>除了默认的 XML 配置格式外，Log4j 2 还支持 YAML 和 JSON 配置文件。要将 Log4j 2 配置为使用备用配置文件格式，请将适当的依赖项添加到 Classpath 中，并为您的配置文件命名以匹配您选择的文件格式，如以下示例所示：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Format</th>
<th>Dependencies</th>
<th>File names</th>
</tr>
</thead>
<tbody>
<tr>
<td>YAML</td>
<td><code>com.fasterxml.jackson.core:jackson-databind</code> <code>com.fasterxml.jackson.dataformat:jackson-dataformat-yaml</code></td>
<td><code>log4j2.yaml</code> <code>log4j2.yml</code></td>
</tr>
<tr>
<td>JSON</td>
<td><code>com.fasterxml.jackson.core:jackson-databind</code></td>
<td><code>log4j2.json</code> <code>log4j2.jsn</code></td>
</tr>
</tbody>
</table>
</div>
<h1 id="数据访问"><a href="#数据访问" class="headerlink" title="数据访问"></a>数据访问</h1><p>Spring Boot 包含许多用于处理数据源的启动器。本部分回答与这样做有关的问题。</p>
<h2 id="配置自定义数据源"><a href="#配置自定义数据源" class="headerlink" title="配置自定义数据源"></a>配置自定义数据源</h2><p>要配置自己的<code>DataSource</code>，请在配置中定义该类型的<code>@Bean</code>。 Spring Boot 在需要的任何地方(包括数据库初始化)重用<code>DataSource</code>。如果需要外部化某些设置，则可以将<code>DataSource</code>绑定到环境(请参阅“ <a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-SpringBoot功能/#第三方配置">第 24.8.1 节，“第三方配置”</a>”)。</p>
<p>以下示例显示了如何在 Bean 中定义数据源：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix=&quot;app.datasource&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FancyDataSource();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以下示例显示如何通过设置属性来定义数据源：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">app.datasource.url</span>=<span class="string">jdbc:h2:mem:mydb</span></span><br><span class="line"><span class="meta">app.datasource.username</span>=<span class="string">sa</span></span><br><span class="line"><span class="meta">app.datasource.pool-size</span>=<span class="string">30</span></span><br></pre></td></tr></table></figure>
<p>假设<code>FancyDataSource</code>具有 URL，用户名和池大小的常规 JavaBean 属性，则在<code>DataSource</code>可用于其他组件之前，这些设置会自动绑定。常规<a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-使用方法指南/#初始化数据库">database initialization</a>也会发生(因此<code>spring.datasource.*</code>的相关子集仍可以与您的自定义配置一起使用)。</p>
<p>Spring Boot 还提供了一个名为<code>DataSourceBuilder</code>的 Util 生成器类，该类可用于创建标准数据源之一(如果它在 Classpath 中)。构建器可以根据 Classpath 上可用的内容来检测要使用的一个。它还基于 JDBC URL 自动检测驱动程序。</p>
<p>下面的示例演示如何使用<code>DataSourceBuilder</code>创建数据源：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;app.datasource&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> DataSourceBuilder.create().build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>要使用<code>DataSource</code>运行应用程序，您需要的只是连接信息。还可以提供特定于池的设置。有关更多详细信息，请检查将在运行时使用的实现。</p>
<p>以下示例显示如何通过设置属性来定义 JDBC 数据源：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">app.datasource.url</span>=<span class="string">jdbc:mysql://localhost/test</span></span><br><span class="line"><span class="meta">app.datasource.username</span>=<span class="string">dbuser</span></span><br><span class="line"><span class="meta">app.datasource.password</span>=<span class="string">dbpass</span></span><br><span class="line"><span class="meta">app.datasource.pool-size</span>=<span class="string">30</span></span><br></pre></td></tr></table></figure>
<p>但是，有一个陷阱。由于未公开连接池的实际类型，因此自定义<code>DataSource</code>的元数据中不会生成任何键，并且 IDE 中也无法完成操作(因为<code>DataSource</code>接口未公开任何属性)。另外，如果您碰巧在 Classpath 上有 Hikari，则此基本设置也不起作用，因为 Hikari 没有<code>url</code>属性(但确实具有<code>jdbcUrl</code>属性)。在这种情况下，您必须按照以下方式重写配置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">app.datasource.jdbc-url</span>=<span class="string">jdbc:mysql://localhost/test</span></span><br><span class="line"><span class="meta">app.datasource.username</span>=<span class="string">dbuser</span></span><br><span class="line"><span class="meta">app.datasource.password</span>=<span class="string">dbpass</span></span><br><span class="line"><span class="meta">app.datasource.maximum-pool-size</span>=<span class="string">30</span></span><br></pre></td></tr></table></figure>
<p>您可以通过强制连接池使用并返回专用的实现而不是<code>DataSource</code>来解决此问题。您无法在运行时更改实现，但是选项列表将是明确的。</p>
<p>以下示例显示了如何使用<code>DataSourceBuilder</code>创建<code>HikariDataSource</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;app.datasource&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HikariDataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> DataSourceBuilder.create().type(HikariDataSource.class).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>您甚至可以利用<code>DataSourceProperties</code>为您做的事情进一步 Developing，也就是，如果没有提供 URL，则为默认的嵌入式数据库提供合理的用户名和密码。您可以从任何<code>DataSourceProperties</code>对象的状态轻松地初始化<code>DataSourceBuilder</code>，因此还可以注入 Spring Boot 自动创建的数据源。但是，这会将您的配置分为两个名称空间：<code>spring.datasource</code>上的<code>url</code>，<code>username</code>，<code>password</code>，<code>type</code>和<code>driver</code>，其余的放在您的自定义名称空间(<code>app.datasource</code>)上。为避免这种情况，可以在自定义名称空间上重新定义自定义<code>DataSourceProperties</code>，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;app.datasource&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> DataSourceProperties <span class="title">dataSourceProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DataSourceProperties();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;app.datasource.configuration&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HikariDataSource <span class="title">dataSource</span><span class="params">(DataSourceProperties properties)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> properties.initializeDataSourceBuilder().type(HikariDataSource.class)</span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个设置使您与 Spring Boot 默认为您保持同步，除了选择了一个专用连接池(以代码形式)，并且其设置在<code>app.datasource.configuration</code>子命名空间中公开之外。由于<code>DataSourceProperties</code>正在为您处理<code>url</code>/<code>jdbcUrl</code>转换，因此您可以按以下方式进行配置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">app.datasource.url</span>=<span class="string">jdbc:mysql://localhost/test</span></span><br><span class="line"><span class="meta">app.datasource.username</span>=<span class="string">dbuser</span></span><br><span class="line"><span class="meta">app.datasource.password</span>=<span class="string">dbpass</span></span><br><span class="line"><span class="meta">app.datasource.configuration.maximum-pool-size</span>=<span class="string">30</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Tip</p>
<p>Spring Boot 会将针对 Hikari 的设置公开给<code>spring.datasource.hikari</code>。本示例使用更通用的<code>configuration</code>子命名空间，因为该示例不支持多个数据源实现。</p>
<p>Note</p>
<p>由于您的自定义配置选择使用 Hikari，因此<code>app.datasource.type</code>无效。实际上，将使用您可以在此处设置的任何值初始化构建器，然后通过对<code>.type()</code>的调用来覆盖构建器。</p>
</blockquote>
<p>有关更多详细信息，请参见“ Spring Boot 功能”部分和<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jdbc/DataSourceAutoConfiguration.java">DataSourceAutoConfiguration</a>类中的“ <a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-SpringBoot功能/#配置数据源">第 30.1 节“配置数据源”</a>”。</p>
<h2 id="配置两个数据源"><a href="#配置两个数据源" class="headerlink" title="配置两个数据源"></a>配置两个数据源</h2><p>如果需要配置多个数据源，则可以应用上一节中介绍的相同技巧。但是，您必须将<code>DataSource</code>实例之一标记为<code>@Primary</code>，因为将来各种自动配置都希望能够按类型获得一个。</p>
<p>如果您创建自己的<code>DataSource</code>，则自动配置将退出。在下面的示例中，我们提供与自动配置在主要数据源上提供的功能完全相同的功能：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;app.datasource.first&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> DataSourceProperties <span class="title">firstDataSourceProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DataSourceProperties();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;app.datasource.first.configuration&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HikariDataSource <span class="title">firstDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> firstDataSourceProperties().initializeDataSourceBuilder()</span><br><span class="line">            .type(HikariDataSource.class).build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;app.datasource.second&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> BasicDataSource <span class="title">secondDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> DataSourceBuilder.create().type(BasicDataSource.class).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Tip</p>
<p><code>firstDataSourceProperties</code>必须标记为<code>@Primary</code>，以便数据库初始化程序功能使用您的副本(如果使用初始化程序)。</p>
</blockquote>
<p>这两个数据源也都必须进行高级定制。例如，您可以按以下方式配置它们：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">app.datasource.first.url</span>=<span class="string">jdbc:mysql://localhost/first</span></span><br><span class="line"><span class="meta">app.datasource.first.username</span>=<span class="string">dbuser</span></span><br><span class="line"><span class="meta">app.datasource.first.password</span>=<span class="string">dbpass</span></span><br><span class="line"><span class="meta">app.datasource.first.configuration.maximum-pool-size</span>=<span class="string">30</span></span><br><span class="line"></span><br><span class="line"><span class="meta">app.datasource.second.url</span>=<span class="string">jdbc:mysql://localhost/second</span></span><br><span class="line"><span class="meta">app.datasource.second.username</span>=<span class="string">dbuser</span></span><br><span class="line"><span class="meta">app.datasource.second.password</span>=<span class="string">dbpass</span></span><br><span class="line"><span class="meta">app.datasource.second.max-total</span>=<span class="string">30</span></span><br></pre></td></tr></table></figure>
<p>您也可以将相同的概念应用于辅助<code>DataSource</code>，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;app.datasource.first&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> DataSourceProperties <span class="title">firstDataSourceProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DataSourceProperties();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;app.datasource.first.configuration&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HikariDataSource <span class="title">firstDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> firstDataSourceProperties().initializeDataSourceBuilder()</span><br><span class="line">            .type(HikariDataSource.class).build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;app.datasource.second&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> DataSourceProperties <span class="title">secondDataSourceProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DataSourceProperties();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;app.datasource.second.configuration&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> BasicDataSource <span class="title">secondDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> secondDataSourceProperties().initializeDataSourceBuilder()</span><br><span class="line">            .type(BasicDataSource.class).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>前面的示例在自定义名称空间上配置两个数据源，其逻辑与 Spring Boot 在自动配置中使用的逻辑相同。请注意，每个<code>configuration</code>子命名空间都根据所选实现提供高级设置。</p>
<h2 id="使用Spring数据存储库"><a href="#使用Spring数据存储库" class="headerlink" title="使用Spring数据存储库"></a>使用Spring数据存储库</h2><p>Spring Data 可以创建各种风格的<code>@Repository</code>接口的实现。只要<code>@Repositories</code>包含在<code>@EnableAutoConfiguration</code>类的同一包(或子包)中，Spring Boot 就会为您处理所有这些操作。</p>
<p>对于许多应用程序，您所需要做的就是将正确的 Spring Data 依赖项放在 Classpath 上(对于 JPA，有<code>spring-boot-starter-data-jpa</code>；对于 Mongodb 是<code>spring-boot-starter-data-mongodb</code>)，并创建了一些存储库接口来处理<code>@Entity</code>对象。示例在<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples/spring-boot-sample-data-jpa">JPA sample</a>和<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples/spring-boot-sample-data-mongodb">Mongodb sample</a>中。</p>
<p>Spring Boot 会根据找到的<code>@EnableAutoConfiguration</code>来猜测您的<code>@Repository</code>定义的位置。要获得更多控制权，请使用<code>@EnableJpaRepositories</code>Comments(来自 Spring Data JPA)。</p>
<p>有关 Spring Data 的更多信息，请参见<a target="_blank" rel="noopener" href="https://projects.spring.io/spring-data/">Spring Data 项目页面</a>。</p>
<h2 id="将Entity注解定义与Spring配置分开"><a href="#将Entity注解定义与Spring配置分开" class="headerlink" title="将Entity注解定义与Spring配置分开"></a>将Entity注解定义与Spring配置分开</h2><p>Spring Boot 会根据找到的<code>@EnableAutoConfiguration</code>来猜测您的<code>@Entity</code>定义的位置。要获得更多控制权，可以使用<code>@EntityScan</code>注解，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@EntityScan(basePackageClasses=City.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="配置JPA属性"><a href="#配置JPA属性" class="headerlink" title="配置JPA属性"></a>配置JPA属性</h2><p>Spring Data JPA 已经提供了一些独立于供应商的配置选项(例如用于 SQL 日志记录的那些)，并且 Spring Boot 公开了这些选项，还为 Hibernate 提供了一些其他选项作为外部配置属性。其中一些会根据上下文自动检测到，因此您不必进行设置。</p>
<p><code>spring.jpa.hibernate.ddl-auto</code>是一种特殊情况，因为根据运行时条件，它具有不同的默认值。如果使用嵌入式数据库，并且没有模式 Management 器(例如 Liquibase 或 Flyway)正在处理<code>DataSource</code>，则默认为<code>create-drop</code>。在所有其他情况下，它默认为<code>none</code>。</p>
<p>还会根据当前的<code>DataSource</code>自动检测要使用的方言，但是如果您要明确表示并绕过启动检查，则可以自己设置<code>spring.jpa.database</code>。</p>
<p>Note</p>
<p>指定<code>database</code>将导致配置良好的 Hibernate 方言。多个数据库有多个<code>Dialect</code>，这可能不满足您的需求。在这种情况下，您可以将<code>spring.jpa.database</code>设置为<code>default</code>以便让 Hibernate 弄清楚，也可以通过设置<code>spring.jpa.database-platform</code>属性来设置方言。</p>
<p>以下示例显示了最常用的设置选项：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.jpa.hibernate.naming.physical-strategy</span>=<span class="string">com.example.MyPhysicalNamingStrategy</span></span><br><span class="line"><span class="meta">spring.jpa.show-sql</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>
<p>此外，创建本地<code>EntityManagerFactory</code>时，<code>spring.jpa.properties.*</code>中的所有属性都作为普通 JPA 属性(前缀被去除)传递。</p>
<p>Tip</p>
<p>如果您需要对 Hibernate 属性应用高级自定义，请考虑在创建<code>EntityManagerFactory</code>之前注册将被调用的<code>HibernatePropertiesCustomizer</code> bean。这优先于自动配置应用的任何内容。</p>
<h2 id="配置Hibernate命名策略"><a href="#配置Hibernate命名策略" class="headerlink" title="配置Hibernate命名策略"></a>配置Hibernate命名策略</h2><p>Hibernate 使用<a target="_blank" rel="noopener" href="https://docs.jboss.org/hibernate/orm/5.3/userguide/html_single/Hibernate_User_Guide.html#naming">两种不同的命名策略</a>将名称从对象模型 Map 到相应的数据库名称。可以分别通过设置<code>spring.jpa.hibernate.naming.physical-strategy</code>和<code>spring.jpa.hibernate.naming.implicit-strategy</code>属性来配置物理和隐式策略实现的标准类名。或者，如果<code>ImplicitNamingStrategy</code>或<code>PhysicalNamingStrategy</code> bean 在应用程序上下文中可用，则 Hibernate 将自动配置为使用它们。</p>
<p>默认情况下，Spring Boot 使用<code>SpringPhysicalNamingStrategy</code>配置物理命名策略。此实现提供了与 Hibernate 4 相同的表结构：所有点都由下划线替换，骆驼套也由下划线替换。默认情况下，所有表名均以小写形式生成，但是如果您的模式需要它，则可以覆盖该标志。</p>
<p>例如，一个<code>TelephoneNumber</code>实体被 Map 到<code>telephone_number</code>表。</p>
<p>如果您更喜欢使用 Hibernate 5 的默认设置，请设置以下属性：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.jpa.hibernate.naming.physical-strategy</span>=<span class="string">org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl</span></span><br></pre></td></tr></table></figure>
<p>或者，您可以配置以下 bean：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PhysicalNamingStrategy <span class="title">physicalNamingStrategy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> PhysicalNamingStrategyStandardImpl();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有关更多详细信息，请参见<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaAutoConfiguration.java">HibernateJpaAutoConfiguration</a>和<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/orm/jpa/JpaBaseConfiguration.java">JpaBaseConfiguration</a>。</p>
<h2 id="配置Hibernate二级缓存"><a href="#配置Hibernate二级缓存" class="headerlink" title="配置Hibernate二级缓存"></a>配置Hibernate二级缓存</h2><p>可以为一系列缓存提供程序配置 Hibernate <a target="_blank" rel="noopener" href="https://docs.jboss.org/hibernate/orm/5.3/userguide/html_single/Hibernate_User_Guide.html#caching">second-level cache</a>。与其将 Hibernate 配置为再次查找缓存提供程序，不如提供尽可能在上下文中可用的缓存提供程序。</p>
<p>如果您使用的是 JCache，这非常简单。首先，确保<code>org.hibernate:hibernate-jcache</code>在 Classpath 上可用。然后，添加一个<code>HibernatePropertiesCustomizer</code> bean，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HibernateSecondLevelCacheExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HibernatePropertiesCustomizer <span class="title">hibernateSecondLevelCacheCustomizer</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            JCacheCacheManager cacheManager)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (properties) -&gt; properties.put(ConfigSettings.CACHE_MANAGER,</span><br><span class="line">                cacheManager.getCacheManager());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个定制器将配置 Hibernate 使用与应用程序相同的<code>CacheManager</code>。也可以使用单独的<code>CacheManager</code>实例。有关详细信息，请参阅<a target="_blank" rel="noopener" href="https://docs.jboss.org/hibernate/orm/5.3/userguide/html_single/Hibernate_User_Guide.html#caching-provider-jcache">Hibernate 用户指南</a>。</p>
<h2 id="在Hibernate组件中使用依赖注入"><a href="#在Hibernate组件中使用依赖注入" class="headerlink" title="在Hibernate组件中使用依赖注入"></a>在Hibernate组件中使用依赖注入</h2><p>默认情况下，Spring Boot 注册使用<code>BeanFactory</code>的<code>BeanContainer</code>实现，以便转换器和实体侦听器可以使用常规依赖项注入。</p>
<p>您可以通过注册删除或更改<code>hibernate.resource.beans.container</code>属性的<code>HibernatePropertiesCustomizer</code>来禁用或调整此行为。</p>
<h2 id="使用自定义EntityManagerFactory"><a href="#使用自定义EntityManagerFactory" class="headerlink" title="使用自定义EntityManagerFactory"></a>使用自定义EntityManagerFactory</h2><p>要完全控制<code>EntityManagerFactory</code>的配置，您需要添加一个名为’entityManagerFactory’的<code>@Bean</code>。如果存在这种类型的 Bean，Spring Boot 自动配置将关闭其实体 Management 器。</p>
<h2 id="使用两个EntityManager"><a href="#使用两个EntityManager" class="headerlink" title="使用两个EntityManager"></a>使用两个EntityManager</h2><p>即使默认的<code>EntityManagerFactory</code>可以正常工作，您也需要定义一个新的。否则，该类型的第二个 bean 的存在将关闭默认值。为了简化操作，您可以使用 Spring Boot 提供的便捷的<code>EntityManagerBuilder</code>。另外，您也可以直接从 Spring ORM 中使用<code>LocalContainerEntityManagerFactoryBean</code>，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add two data sources configured as above</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> LocalContainerEntityManagerFactoryBean <span class="title">customerEntityManagerFactory</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        EntityManagerFactoryBuilder builder)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> builder</span><br><span class="line">            .dataSource(customerDataSource())</span><br><span class="line">            .packages(Customer.class)</span><br><span class="line">            .persistenceUnit(<span class="string">&quot;customers&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> LocalContainerEntityManagerFactoryBean <span class="title">orderEntityManagerFactory</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        EntityManagerFactoryBuilder builder)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> builder</span><br><span class="line">            .dataSource(orderDataSource())</span><br><span class="line">            .packages(Order.class)</span><br><span class="line">            .persistenceUnit(<span class="string">&quot;orders&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的配置几乎可以独立工作。要完成图片，您还需要为两个<code>EntityManagers</code>配置<code>TransactionManagers</code>。如果将其中一个标记为<code>@Primary</code>，则可以在 Spring Boot 中将其默认为<code>JpaTransactionManager</code>拾取。另一个必须显式地注入到新实例中。另外，您也许可以使用跨这两者的 JTA 事务 Management 器。</p>
<p>如果使用 Spring Data，则需要相应地配置<code>@EnableJpaRepositories</code>，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableJpaRepositories(basePackageClasses = Customer.class,</span></span><br><span class="line"><span class="meta">        entityManagerFactoryRef = &quot;customerEntityManagerFactory&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerConfiguration</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableJpaRepositories(basePackageClasses = Order.class,</span></span><br><span class="line"><span class="meta">        entityManagerFactoryRef = &quot;orderEntityManagerFactory&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderConfiguration</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用传统的persistence-xml文件"><a href="#使用传统的persistence-xml文件" class="headerlink" title="使用传统的persistence.xml文件"></a>使用传统的persistence.xml文件</h2><p>默认情况下，Spring Boot 不会搜索或使用<code>META-INF/persistence.xml</code>。如果您喜欢使用传统的<code>persistence.xml</code>，则需要定义自己的<code>LocalEntityManagerFactoryBean</code>类型的<code>@Bean</code>(ID 为’entityManagerFactory’)，并在其中设置持久性单元名称。</p>
<p>默认设置请参见<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/orm/jpa/JpaBaseConfiguration.java">JpaBaseConfiguration</a>。</p>
<h2 id="使用SpringDataJPA和Mongo存储库"><a href="#使用SpringDataJPA和Mongo存储库" class="headerlink" title="使用SpringDataJPA和Mongo存储库"></a>使用SpringDataJPA和Mongo存储库</h2><p>Spring Data JPA 和 Spring Data Mongo 都可以为您自动创建<code>Repository</code>实现。如果它们都存在于 Classpath 中，则可能必须做一些额外的配置以告诉 Spring Boot 要创建哪个存储库。最明确的方法是使用标准 Spring Data <code>@EnableJpaRepositories</code>和<code>@EnableMongoRepositories</code>注解并提供<code>Repository</code>接口的位置。</p>
<p>还有一些标志(<code>spring.data.*.repositories.enabled</code>和<code>spring.data.*.repositories.type</code>)，可用于在外部配置中打开和关闭自动配置的存储库。这样做很有用，例如，如果您想关闭 Mongo 存储库并仍然使用自动配置的<code>MongoTemplate</code>。</p>
<p>其他自动配置的 Spring Data 存储库类型(Elasticsearch，Solr 等)存在相同的障碍和相同的功能。要使用它们，请相应地更改 Comments 和标志的名称。</p>
<h2 id="自定义SpringData的Web-支持"><a href="#自定义SpringData的Web-支持" class="headerlink" title="自定义SpringData的Web 支持"></a>自定义SpringData的Web 支持</h2><p>Spring Data 提供了 Web 支持，可简化 Web 应用程序中 Spring Data 存储库的使用。 Spring Boot 在<code>spring.data.web</code>名称空间中提供了用于自定义其配置的属性。请注意，如果您使用的是 Spring Data REST，则必须改为使用<code>spring.data.rest</code>名称空间中的属性。</p>
<h2 id="将Spring数据存储库公开为-REST-端点"><a href="#将Spring数据存储库公开为-REST-端点" class="headerlink" title="将Spring数据存储库公开为 REST 端点"></a>将Spring数据存储库公开为 REST 端点</h2><p>如果已为应用程序启用 Spring MVC，Spring Data REST 可以为您将<code>Repository</code>实现作为 REST 端点公开。</p>
<p>Spring Boot 公开了一组自定义<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/rest/docs/current/api/org/springframework/data/rest/core/config/RepositoryRestConfiguration.html">RepositoryRestConfiguration</a>的有用属性(来自<code>spring.data.rest</code>命名空间)。如果需要提供其他定制，则应使用<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/rest/docs/current/api/org/springframework/data/rest/webmvc/config/RepositoryRestConfigurer.html">RepositoryRestConfigurer</a> bean。</p>
<blockquote>
<p>Note</p>
<p>如果您未在自定义<code>RepositoryRestConfigurer</code>上指定任何 Sequences，它将在一个 Spring Boot 内部使用之后运行。如果您需要指定一个订单，请确保它大于 0.</p>
</blockquote>
<h2 id="配置JPA使用的组件"><a href="#配置JPA使用的组件" class="headerlink" title="配置JPA使用的组件"></a>配置JPA使用的组件</h2><p>如果要配置 JPA 使用的组件，则需要确保在 JPA 之前初始化该组件。当组件被自动配置后，Spring Boot 会为您处理。例如，当自动配置 Flyway 时，会将 Hibernate 配置为依赖 Flyway，以便 Flyway 在 Hibernate 尝试使用它之前有机会初始化数据库。</p>
<p>如果您自己配置组件，则可以使用<code>EntityManagerFactoryDependsOnPostProcessor</code>子类作为构建必要依赖关系的便捷方法。例如，如果您将 Hibernate Search 和 Elasticsearch 用作其索引 Management 器，则必须将任何<code>EntityManagerFactory</code> bean 配置为依赖<code>elasticsearchClient</code> bean，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> EntityManagerFactoryDependsOnPostProcessor&#125; that ensures that</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> EntityManagerFactory&#125; beans depend on the &#123;<span class="doctag">@code</span> elasticsearchClient&#125; bean.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ElasticsearchJpaDependencyConfiguration</span></span></span><br><span class="line"><span class="class">        <span class="keyword">extends</span> <span class="title">EntityManagerFactoryDependsOnPostProcessor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ElasticsearchJpaDependencyConfiguration() &#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="string">&quot;elasticsearchClient&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用两个数据源配置jOOQ"><a href="#使用两个数据源配置jOOQ" class="headerlink" title="使用两个数据源配置jOOQ"></a>使用两个数据源配置jOOQ</h2><p>如果需要将 jOOQ 与多个数据源一起使用，则应该为每个数据源创建自己的<code>DSLContext</code>。有关更多详细信息，请参考<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jooq/JooqAutoConfiguration.java">JooqAutoConfiguration</a>。</p>
<blockquote>
<p>Tip</p>
<p>特别是，<code>JooqExceptionTranslator</code>和<code>SpringTransactionProvider</code>可以重复使用，以提供与自动配置使用单个<code>DataSource</code>相似的功能。</p>
</blockquote>
<h1 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h1><p>可以使用不同的方式初始化 SQL 数据库，具体取决于堆栈是什么。当然，如果数据库是一个单独的过程，您也可以手动执行。</p>
<h2 id="使用JPA初始化数据库"><a href="#使用JPA初始化数据库" class="headerlink" title="使用JPA初始化数据库"></a>使用JPA初始化数据库</h2><p>JPA 具有用于 DDL 生成的功能，可以将其设置为在启动时针对数据库运行。这是通过两个外部属性控制的：</p>
<ul>
<li><code>spring.jpa.generate-ddl</code>(布尔值)打开和关闭该功能，并且与供应商无关。</li>
<li><code>spring.jpa.hibernate.ddl-auto</code>(枚举)是一种 Hibernate 功能，可以更精细地控制行为。此功能将在本指南的后面部分详细介绍。</li>
</ul>
<h2 id="使用Hibernate初始化数据库"><a href="#使用Hibernate初始化数据库" class="headerlink" title="使用Hibernate初始化数据库"></a>使用Hibernate初始化数据库</h2><p>您可以显式设置<code>spring.jpa.hibernate.ddl-auto</code>，并且标准的 Hibernate 属性值为<code>none</code>，<code>validate</code>，<code>update</code>，<code>create</code>和<code>create-drop</code>。 Spring Boot 根据是否认为您的数据库已嵌入为您选择默认值。如果未检测到任何模式 Management 器，则默认为<code>create-drop</code>，否则为<code>none</code>。通过查看<code>Connection</code>类型，可以检测到嵌入式数据库。嵌入了<code>hsqldb</code>，<code>h2</code>和<code>derby</code>，其他未嵌入。从内存数据库转换为“实际”数据库时，请不要对新平台中表和数据的存在做出假设。您必须显式设置<code>ddl-auto</code>或使用其他机制之一来初始化数据库。</p>
<blockquote>
<p>Note</p>
<p>您可以通过启用<code>org.hibernate.SQL</code>Logger 来输出架构创建。如果启用<a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-SpringBoot功能/#控制台输出">debug mode</a>，则会自动为您完成此操作。</p>
<p>另外，如果 Hibernate 从头开始创建架构(即<code>ddl-auto</code>属性设置为<code>create</code>或<code>create-drop</code>)，则在启动时将在 Classpath 的根目录中执行名为<code>import.sql</code>的文件。如果您小心的话，这对于演示和测试很有用，但是您可能不想在生产环境的 Classpath 中使用它。这是一个 Hibernate 功能(与 Spring 无关)。</p>
</blockquote>
<h2 id="初始化数据库-1"><a href="#初始化数据库-1" class="headerlink" title="初始化数据库"></a>初始化数据库</h2><p>Spring Boot 可以自动创建<code>DataSource</code>的架构(DDL 脚本)并对其进行初始化(DML 脚本)。它从标准根 Classpath 位置：<code>schema.sql</code>和<code>data.sql</code>加载 SQL。另外，Spring Boot 处理<code>schema-$&#123;platform&#125;.sql</code>和<code>data-$&#123;platform&#125;.sql</code>文件(如果存在)，其中<code>platform</code>是<code>spring.datasource.platform</code>的值。这使您可以在必要时切换到特定于数据库的脚本。例如，您可以选择将其设置为数据库的供应商名称(<code>hsqldb</code>，<code>h2</code>，<code>oracle</code>，<code>mysql</code>，<code>postgresql</code>等)。</p>
<blockquote>
<p>Note</p>
<p>Spring Boot 自动创建嵌入式<code>DataSource</code>的架构。可以使用<code>spring.datasource.initialization-mode</code>属性来自定义此行为。例如，如果要始终初始化<code>DataSource</code>而不考虑其类型：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.datasource.initialization-mode</span>=<span class="string">always</span></span><br></pre></td></tr></table></figure>
<p>默认情况下，Spring Boot 启用 Spring JDBC 初始化程序的快速失败功能。这意味着，如果脚本导致异常，则应用程序将无法启动。您可以通过设置<code>spring.datasource.continue-on-error</code>来调整行为。</p>
<p>Note</p>
<p>在基于 JPA 的应用程序中，您可以选择让 Hibernate 创建架构或使用<code>schema.sql</code>，但是您不能两者都做。如果使用<code>schema.sql</code>，请确保禁用<code>spring.jpa.hibernate.ddl-auto</code>。</p>
</blockquote>
<h2 id="初始化SpringBatch数据库"><a href="#初始化SpringBatch数据库" class="headerlink" title="初始化SpringBatch数据库"></a>初始化SpringBatch数据库</h2><p>如果您使用 Spring Batch，则它随大多数流行的数据库平台一起预包装了 SQL 初始化脚本。 Spring Boot 可以检测数据库类型并在启动时执行这些脚本。如果您使用嵌入式数据库，则默认情况下会发生这种情况。您还可以为任何数据库类型启用它，如以下示例所示：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.batch.initialize-schema</span>=<span class="string">always</span></span><br></pre></td></tr></table></figure>
<p>您还可以通过设置<code>spring.batch.initialize-schema=never</code>显式关闭初始化。</p>
<h2 id="使用更高级别的数据库迁移工具"><a href="#使用更高级别的数据库迁移工具" class="headerlink" title="使用更高级别的数据库迁移工具"></a>使用更高级别的数据库迁移工具</h2><p>Spring Boot 支持两个更高级别的迁移工具：<a target="_blank" rel="noopener" href="https://flywaydb.org/">Flyway</a>和<a target="_blank" rel="noopener" href="http://www.liquibase.org/">Liquibase</a>。</p>
<h3 id="在启动时执行Flyway数据库迁移"><a href="#在启动时执行Flyway数据库迁移" class="headerlink" title="在启动时执行Flyway数据库迁移"></a>在启动时执行Flyway数据库迁移</h3><p>要在启动时自动运行 Flyway 数据库迁移，请将<code>org.flywaydb:flyway-core</code>添加到您的 Classpath 中。</p>
<p>迁移是格式为<code>V&lt;VERSION&gt;__&lt;NAME&gt;.sql</code>(带有<code>&lt;VERSION&gt;</code>下划线分隔的版本，例如“ 1”或“ 2_1”)的脚本。默认情况下，它们位于名为<code>classpath:db/migration</code>的文件夹中，但是您可以通过设置<code>spring.flyway.locations</code>来修改该位置。这是一个或多个<code>classpath:</code>或<code>filesystem:</code>位置的逗号分隔列表。例如，以下配置将在默认 Classpath 位置和<code>/opt/migration</code>目录中搜索脚本：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.flyway.locations</span>=<span class="string">classpath:db/migration,filesystem:/opt/migration</span></span><br></pre></td></tr></table></figure>
<p>您还可以添加特殊的<code>&#123;vendor&#125;</code>占位符以使用特定于供应商的脚本。假设以下内容：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.flyway.locations</span>=<span class="string">classpath:db/migration/&#123;vendor&#125;</span></span><br></pre></td></tr></table></figure>
<p>前面的配置没有使用<code>db/migration</code>，而是根据数据库的类型(例如<code>db/migration/mysql</code>表示 MySQL)来设置要使用的文件夹。 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jdbc/DatabaseDriver.java">DatabaseDriver</a>中提供了受支持的数据库列表。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/flyway/FlywayProperties.java">FlywayProperties</a>提供了 Flyway 的大多数设置以及少量的其他属性，可用于禁用迁移或关闭位置检查。如果需要对配置进行更多控制，请考虑注册<code>FlywayConfigurationCustomizer</code> bean。</p>
<p>Spring Boot 调用<code>Flyway.migrate()</code>来执行数据库迁移。如果您想要更多控制权，请提供实现<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/flyway/FlywayMigrationStrategy.java">FlywayMigrationStrategy</a>的<code>@Bean</code>。</p>
<p>Flyway 支持 SQL 和 Java <a target="_blank" rel="noopener" href="https://flywaydb.org/documentation/callbacks.html">callbacks</a>。要使用基于 SQL 的回调，请将回调脚本放在<code>classpath:db/migration</code>文件夹中。要使用基于 Java 的回调，请创建一个或多个实现<code>Callback</code>的 bean。任何此类 bean 都会自动通过<code>Flyway</code>注册。可以使用<code>@Order</code>或实现<code>Ordered</code>对其进行排序。也可以检测到实现不推荐使用的<code>FlywayCallback</code>接口的 Bean，但是不能与<code>Callback</code> Bean 一起使用。</p>
<p>默认情况下，Flyway 自动在您的上下文中自动连接(<code>@Primary</code>)<code>DataSource</code>并将其用于迁移。如果您想使用其他<code>DataSource</code>，则可以创建一个并将其<code>@Bean</code>标记为<code>@FlywayDataSource</code>。如果这样做并想要两个数据源，请记住创建另一个数据源并将其标记为<code>@Primary</code>。另外，您可以通过在外部属性中设置<code>spring.flyway.[url,user,password]</code>来使用 Flyway 的本机<code>DataSource</code>。设置<code>spring.flyway.url</code>或<code>spring.flyway.user</code>足以使 Flyway 使用其自己的<code>DataSource</code>。如果未设置这三个属性中的任何一个，则将使用其等效的<code>spring.datasource</code>属性的值。</p>
<p>有一个<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples/spring-boot-sample-flyway">Flyway sample</a>，以便您可以了解如何进行设置。</p>
<p>您还可以使用 Flyway 为特定情况提供数据。例如，您可以将特定于测试的迁移放在<code>src/test/resources</code>中，并且仅在您的应用程序开始进行测试时才运行它们。另外，您可以使用特定于配置文件的配置来自定义<code>spring.flyway.locations</code>，以便仅在特定配置文件处于 Active 状态时才运行某些迁移。例如，在<code>application-dev.properties</code>中，您可以指定以下设置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.flyway.locations</span>=<span class="string">classpath:/db/migration,classpath:/dev/db/migration</span></span><br></pre></td></tr></table></figure>
<p>使用该设置，只有在<code>dev</code>配置文件处于 Active 状态时，才能在<code>dev/db/migration</code>中进行迁移。</p>
<h3 id="在启动时执行Liquibase数据库迁移"><a href="#在启动时执行Liquibase数据库迁移" class="headerlink" title="在启动时执行Liquibase数据库迁移"></a>在启动时执行Liquibase数据库迁移</h3><p>要在启动时自动运行 Liquibase 数据库迁移，请将<code>org.liquibase:liquibase-core</code>添加到您的 Classpath 中。</p>
<p>默认情况下，从<code>db/changelog/db.changelog-master.yaml</code>读取主更改日志，但是您可以通过设置<code>spring.liquibase.change-log</code>来更改位置。除了 YAML，Liquibase 还支持 JSON，XML 和 SQL 更改日志格式。</p>
<p>默认情况下，Liquibase 在您的上下文中自动装配(<code>@Primary</code>)<code>DataSource</code>并将其用于迁移。如果需要使用其他<code>DataSource</code>，则可以创建一个<code>@Bean</code>并将其标记为<code>@LiquibaseDataSource</code>。如果这样做，并且想要两个数据源，请记住创建另一个数据源并将其标记为<code>@Primary</code>。另外，您可以通过在外部属性中设置<code>spring.liquibase.[url,user,password]</code>来使用 Liquibase 的本机<code>DataSource</code>。设置<code>spring.liquibase.url</code>或<code>spring.liquibase.user</code>足以使 Liquibase 使用其自己的<code>DataSource</code>。如果未设置这三个属性中的任何一个，则将使用其等效的<code>spring.datasource</code>属性的值。</p>
<p>有关可用设置(例如上下文，默认架构等)的详细信息，请参见<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/liquibase/LiquibaseProperties.java">LiquibaseProperties</a>。</p>
<p>有一个<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples/spring-boot-sample-liquibase">Liquibase sample</a>，以便您可以了解如何进行设置。</p>
<h1 id="Messaging"><a href="#Messaging" class="headerlink" title="Messaging"></a>Messaging</h1><p>Spring Boot 提供了许多 Starter，包括消息传递。本部分回答了将消息与 Spring Boot 一起使用所引起的问题。</p>
<h2 id="禁用事务JMS会话"><a href="#禁用事务JMS会话" class="headerlink" title="禁用事务JMS会话"></a>禁用事务JMS会话</h2><p>如果您的 JMS 代理不支持事务处理会话，则必须完全禁用对事务的支持。如果您创建自己的<code>JmsListenerContainerFactory</code>，则无需执行任何操作，因为默认情况下无法进行处理。如果您想使用<code>DefaultJmsListenerContainerFactoryConfigurer</code>重用 Spring Boot 的默认值，则可以禁用事务性会话，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> DefaultJmsListenerContainerFactory <span class="title">jmsListenerContainerFactory</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        ConnectionFactory connectionFactory,</span></span></span><br><span class="line"><span class="function"><span class="params">        DefaultJmsListenerContainerFactoryConfigurer configurer)</span> </span>&#123;</span><br><span class="line">    DefaultJmsListenerContainerFactory listenerFactory =</span><br><span class="line">            <span class="keyword">new</span> DefaultJmsListenerContainerFactory();</span><br><span class="line">    configurer.configure(listenerFactory, connectionFactory);</span><br><span class="line">    listenerFactory.setTransactionManager(<span class="keyword">null</span>);</span><br><span class="line">    listenerFactory.setSessionTransacted(<span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">return</span> listenerFactory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的示例将覆盖默认工厂，并且应将其应用于应用程序定义的任何其他工厂(如果有)。</p>
<h1 id="批处理应用程序"><a href="#批处理应用程序" class="headerlink" title="批处理应用程序"></a>批处理应用程序</h1><p>本部分回答了将 Spring Batch 与 Spring Boot 结合使用所引起的问题。</p>
<blockquote>
<p>Note</p>
<p>默认情况下，批处理应用程序需要<code>DataSource</code>来存储作业详细信息。如果要偏离此范围，则需要实现<code>BatchConfigurer</code>。有关更多详细信息，请参见<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-batch/apidocs/org/springframework/batch/core/configuration/annotation/EnableBatchProcessing.html">@EnableBatchProcessing 的 Javadoc</a>。</p>
</blockquote>
<p>有关 Spring Batch 的更多信息，请参见<a target="_blank" rel="noopener" href="https://projects.spring.io/spring-batch/">Spring Batch 项目页面</a>。</p>
<h2 id="在启动时执行SpringBatch作业"><a href="#在启动时执行SpringBatch作业" class="headerlink" title="在启动时执行SpringBatch作业"></a>在启动时执行SpringBatch作业</h2><p>通过在上下文中的某个位置添加<code>@EnableBatchProcessing</code>(来自 Spring Batch)来启用 Spring Batch 自动配置。</p>
<p>默认情况下，它在启动时在应用程序上下文中执行 <strong>all</strong> <code>Jobs</code>(有关详细信息，请参见<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/batch/JobLauncherCommandLineRunner.java">JobLauncherCommandLineRunner</a>)。您可以通过指定<code>spring.batch.job.names</code>(以逗号分隔的作业名称模式列表)来缩小到一个或多个特定作业。</p>
<blockquote>
<p>Tip</p>
<p>与命令行选项参数<a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-SpringBoot功能/#访问命令行属性">在环境中设置属性</a>(即以<code>--</code>开头，例如<code>--my-property=value</code>)不同，作业参数必须在命令行上指定，而不用破折号(例如<code>jobParam=value</code>)。</p>
</blockquote>
<p>如果应用程序上下文包括<code>JobRegistry</code>，则在注册表中查找<code>spring.batch.job.names</code>中的作业，而不是从上下文中自动装配。这是更复杂的系统的常见模式，其中多个作业在子上下文中定义并集中注册。</p>
<p>有关更多详细信息，请参见<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/batch/BatchAutoConfiguration.java">BatchAutoConfiguration</a>和<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-batch/blob/master/spring-batch-core/src/main/java/org/springframework/batch/core/configuration/annotation/EnableBatchProcessing.java">@EnableBatchProcessing</a>。</p>
<h1 id="Actuator"><a href="#Actuator" class="headerlink" title="Actuator"></a>Actuator</h1><p>Spring Boot 包括 Spring Boot Actuator。本节回答了经常因使用而引起的问题。</p>
<h2 id="更改Actuator端点的HTTP端口或地址"><a href="#更改Actuator端点的HTTP端口或地址" class="headerlink" title="更改Actuator端点的HTTP端口或地址"></a>更改Actuator端点的HTTP端口或地址</h2><p>在独立应用程序中，Actuator HTTP 端口默认与主 HTTP 端口相同。要使应用程序在其他端口上侦听，请设置外部属性：<code>management.server.port</code>。要侦听完全不同的网络地址(例如，当您有一个用于 Management 的内部网络而有一个用于用户应用程序的外部网络)时，还可以将<code>management.server.address</code>设置为服务器可以绑定到的有效 IP 地址。</p>
<p>有关更多详细信息，请参见“生产就绪功能”部分中的<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/web/server/ManagementServerProperties.java">ManagementServerProperties</a>源代码和“ <a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-SpringBoot-Actuator可用于生产的功能/#自定义Management服务器端口">第 54.2 节“自定义 Management 服务器端口”</a>”。</p>
<h2 id="自定义“-whitelabel”错误页面"><a href="#自定义“-whitelabel”错误页面" class="headerlink" title="自定义“ whitelabel”错误页面"></a>自定义“ whitelabel”错误页面</h2><p>如果遇到服务器错误，Spring Boot 将安装一个“ whitelabel”错误页面，您会在浏览器 Client 端中看到该错误页面(使用 JSON 和其他媒体类型的机器 Client 端应该看到带有正确错误代码的明智响应)。</p>
<p>Note</p>
<p>设置<code>server.error.whitelabel.enabled=false</code>可关闭默认错误页面。这样做将还原您正在使用的 servlet 容器的默认值。请注意，Spring Boot 仍然尝试解决错误视图，因此您可能应该添加自己的错误页面，而不是完全禁用它。</p>
<p>用自己的方法覆盖错误页面取决于您使用的模板技术。例如，如果您使用 Thymeleaf，则可以添加<code>error.html</code>模板。如果使用 FreeMarker，则可以添加<code>error.ftl</code>模板。通常，您需要使用名称<code>error</code>解析的<code>View</code>或处理<code>/error</code>路径的<code>@Controller</code>。除非您替换了某些默认配置，否则您应该在<code>ApplicationContext</code>中找到一个<code>BeanNameViewResolver</code>，因此一个名为<code>error</code>的<code>@Bean</code>将是一种简单的实现方式。有关更多选项，请参见<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/servlet/error/ErrorMvcAutoConfiguration.java">ErrorMvcAutoConfiguration</a>。</p>
<p>另请参见“ <a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-SpringBoot功能/#错误处理">Error Handling</a>”部分，以获取有关如何在 servlet 容器中注册处理程序的详细信息。</p>
<h2 id="清理合理的值"><a href="#清理合理的值" class="headerlink" title="清理合理的值"></a>清理合理的值</h2><p><code>env</code>和<code>configprops</code>端点返回的信息可能有些敏感，因此默认情况下会清理匹配特定模式的键(即，它们的值将被<code>******</code>替换)。</p>
<p>Spring Boot 对此类密钥使用合理的默认值：例如，对任何以单词“ password”，“ secret”，“ key”或“ token”结尾的密钥进行清理。也可以改用正则表达式，例如<code>*credentials.*</code>来清除将单词<code>credentials</code>作为关键字一部分的任何关键字。</p>
<p>可以分别使用<code>management.endpoint.env.keys-to-sanitize</code>和<code>management.endpoint.configprops.keys-to-sanitize</code>自定义要使用的模式。</p>
<h1 id="Security"><a href="#Security" class="headerlink" title="Security"></a>Security</h1><p>本部分解决有关使用 Spring Boot 时的安全性的问题，包括因将 Spring Security 与 Spring Boot 一起使用而引起的问题。</p>
<p>有关 Spring Security 的更多信息，请参见<a target="_blank" rel="noopener" href="https://projects.spring.io/spring-security/">Spring Security 项目页面</a>。</p>
<h2 id="关闭SpringBoot安全性配置"><a href="#关闭SpringBoot安全性配置" class="headerlink" title="关闭SpringBoot安全性配置"></a>关闭SpringBoot安全性配置</h2><p>如果您在应用程序中定义<code>@Configuration</code>和<code>WebSecurityConfigurerAdapter</code>，它将关闭 Spring Boot 中的默认 Webapp 安全设置。</p>
<h2 id="更改UserDetailsService并添加用户帐户"><a href="#更改UserDetailsService并添加用户帐户" class="headerlink" title="更改UserDetailsService并添加用户帐户"></a>更改UserDetailsService并添加用户帐户</h2><p>如果提供类型<code>AuthenticationManager</code>，<code>AuthenticationProvider</code>或<code>UserDetailsService</code>的<code>@Bean</code>，则不会创建<code>InMemoryUserDetailsManager</code>的默认<code>@Bean</code>，因此您可以使用完整的 Spring Security 功能集(例如<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/#jc-authentication">各种身份验证选项</a>)。</p>
<p>添加用户帐户的最简单方法是提供自己的<code>UserDetailsService</code> bean。</p>
<h2 id="在代理服务器上运行时启用HTTPS"><a href="#在代理服务器上运行时启用HTTPS" class="headerlink" title="在代理服务器上运行时启用HTTPS"></a>在代理服务器上运行时启用HTTPS</h2><p>确保所有主要端点仅可通过 HTTPS 进行访问对于任何应用程序来说都是一项重要的工作。如果您将 Tomcat 用作 servlet 容器，则 Spring Boot 如果检测到某些环境设置，则会自动添加 Tomcat 自己的<code>RemoteIpValve</code>，并且您应该能够依靠<code>HttpServletRequest</code>报告它是否安全(甚至在代理服务器的下游)。处理真实的 SSL 终止)。标准行为由是否存在某些请求 Headers(<code>x-forwarded-for</code>和<code>x-forwarded-proto</code>)确定，它们的名称是常规名称，因此它应适用于大多数前端代理。您可以通过向<code>application.properties</code>添加一些条目来打开阀门，如以下示例所示：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.tomcat.remote-ip-header</span>=<span class="string">x-forwarded-for</span></span><br><span class="line"><span class="meta">server.tomcat.protocol-header</span>=<span class="string">x-forwarded-proto</span></span><br></pre></td></tr></table></figure>
<p>(这些属性中的任何一个都会在阀上切换.或者，您可以通过添加<code>TomcatServletWebServerFactory</code> bean 来添加<code>RemoteIpValve</code>.)</p>
<p>要将 Spring Security 配置为要求所有(或某些)请求使用安全通道，请考虑添加自己的<code>WebSecurityConfigurerAdapter</code>，该<code>WebSecurityConfigurerAdapter</code>将添加以下<code>HttpSecurity</code>配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SslWebSecurityConfigurerAdapter</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// Customize the application security</span></span><br><span class="line">        http.requiresChannel().anyRequest().requiresSecure();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Hot-Swapping"><a href="#Hot-Swapping" class="headerlink" title="Hot Swapping"></a>Hot Swapping</h1><p>Spring Boot 支持热插拔。本部分回答有关其工作方式的问题。</p>
<h2 id="重新加载静态内容"><a href="#重新加载静态内容" class="headerlink" title="重新加载静态内容"></a>重新加载静态内容</h2><p>有几种热重装选项。推荐的方法是使用<a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-使用SpringBoot/#开发者工具">spring-boot-devtools</a>，因为它提供了其他开发时功能，例如对应用程序快速重启和 LiveReload 的支持，以及合理的开发时配置(例如模板缓存)。 Devtools 通过监视 Classpath 的更改来工作。这意味着必须“构建”静态资源更改才能使更改生效。默认情况下，当您保存更改时，这会自动在 Eclipse 中发生。在 IntelliJ IDEA 中，“生成项目”命令将触发必要的构建。由于<a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-使用SpringBoot/#排除资源">默认重启排除</a>，对静态资源的更改不会触发应用程序的重新启动。但是，它们确实会触发实时重新加载。</p>
<p>另外，在 IDE 中运行(特别是在调试时运行)是进行开发的好方法(所有现代 IDE 都允许重新加载静态资源，并且通常还允许热交换 Java 类更改)。</p>
<p>最后，可以配置<a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-构建工具插件/">Maven 和 Gradle 插件</a>(请参见<code>addResources</code>属性)以支持从命令行运行，并直接从源中重新加载静态文件。如果要使用高级工具编写该代码，则可以将其与外部 css/js 编译器进程一起使用。</p>
<h2 id="重新加载模板，而无需重新启动容器"><a href="#重新加载模板，而无需重新启动容器" class="headerlink" title="重新加载模板，而无需重新启动容器"></a>重新加载模板，而无需重新启动容器</h2><p>Spring Boot 支持的大多数模板技术都包含一个用于禁用缓存的配置选项(本文档后面将介绍)。如果您使用<code>spring-boot-devtools</code>模块，那么在开发时这些属性就是<a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-使用SpringBoot/#属性默认值">automatically configured</a>。</p>
<h3 id="Thymeleaf模板"><a href="#Thymeleaf模板" class="headerlink" title="Thymeleaf模板"></a>Thymeleaf模板</h3><p>如果您使用 Thymeleaf，请将<code>spring.thymeleaf.cache</code>设置为<code>false</code>。有关其他 Thymeleaf 定制选项，请参见<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/thymeleaf/ThymeleafAutoConfiguration.java">ThymeleafAutoConfiguration</a>。</p>
<h3 id="FreeMarker模板"><a href="#FreeMarker模板" class="headerlink" title="FreeMarker模板"></a>FreeMarker模板</h3><p>如果您使用 FreeMarker，请将<code>spring.freemarker.cache</code>设置为<code>false</code>。有关其他 FreeMarker 自定义选项，请参见<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/freemarker/FreeMarkerAutoConfiguration.java">FreeMarkerAutoConfiguration</a>。</p>
<h3 id="Groovy模板"><a href="#Groovy模板" class="headerlink" title="Groovy模板"></a>Groovy模板</h3><p>如果您使用 Groovy 模板，请将<code>spring.groovy.template.cache</code>设置为<code>false</code>。有关其他 Groovy 定制选项，请参见<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/groovy/template/GroovyTemplateAutoConfiguration.java">GroovyTemplateAutoConfiguration</a>。</p>
<h2 id="快速启动应用程序"><a href="#快速启动应用程序" class="headerlink" title="快速启动应用程序"></a>快速启动应用程序</h2><p><code>spring-boot-devtools</code>模块包括对应用程序自动重启的支持。虽然不如<a target="_blank" rel="noopener" href="http://zeroturnaround.com/software/jrebel/">JRebel</a>等技术快，但通常比“冷启动”要快得多。在研究本文档后面讨论的一些更复杂的重载选项之前，您可能应该先尝试一下。</p>
<p>有关更多详细信息，请参见<a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-使用SpringBoot/#开发者工具">第 20 章，开发人员工具</a>部分。</p>
<h2 id="无需重新启动容器即可重新加载Java类"><a href="#无需重新启动容器即可重新加载Java类" class="headerlink" title="无需重新启动容器即可重新加载Java类"></a>无需重新启动容器即可重新加载Java类</h2><p>许多现代的 IDE(Eclipse，IDEA 等)都支持字节码的热交换。因此，如果所做的更改不影响类或方法的签名，则应干净地重新加载而没有副作用。</p>
<h1 id="Build"><a href="#Build" class="headerlink" title="Build"></a>Build</h1><p>Spring Boot 包括 Maven 和 Gradle 的构建插件。本部分回答有关这些插件的常见问题。</p>
<h2 id="生成内部版本信息"><a href="#生成内部版本信息" class="headerlink" title="生成内部版本信息"></a>生成内部版本信息</h2><p>Maven 插件和 Gradle 插件都允许生成包含项目的坐标，名称和版本的构建信息。还可以将插件配置为通过配置添加其他属性。当存在这样的文件时，Spring Boot 会自动配置<code>BuildProperties</code> bean。</p>
<p>要使用 Maven 生成构建信息，请为<code>build-info</code>目标添加执行，如以下示例所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>build-info<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Tip</p>
<p>有关更多详细信息，请参见<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/maven-plugin">Spring Boot Maven 插件文档</a>。</p>
<p>下面的示例对 Gradle 执行相同的操作：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">springBoot &#123;</span><br><span class="line">    buildInfo()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Tip</p>
<p>有关更多详细信息，请参见<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/gradle-plugin/reference/html/#integrating-with-actuator-build-info">Spring Boot Gradle 插件文档</a>。</p>
</blockquote>
<h2 id="生成Git信息"><a href="#生成Git信息" class="headerlink" title="生成Git信息"></a>生成Git信息</h2><p>Maven 和 Gradle 都允许生成<code>git.properties</code>文件，该文件包含有关项目构建时<code>git</code>源代码存储库状态的信息。</p>
<p>对于 Maven 用户，<code>spring-boot-starter-parent</code> POM 包含一个预先配置的插件，用于生成<code>git.properties</code>文件。要使用它，请将以下声明添加到您的 POM 中：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>pl.project13.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>git-commit-id-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Gradle 用户可以使用<a target="_blank" rel="noopener" href="https://plugins.gradle.org/plugin/com.gorylenko.gradle-git-properties">gradle-git-properties</a>插件来达到相同的结果，如以下示例所示：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line">    id <span class="string">&quot;com.gorylenko.gradle-git-properties&quot;</span> version <span class="string">&quot;1.5.1&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Tip</p>
<p><code>git.properties</code>中的提交时间应与以下格式匹配：<code>yyyy-MM-dd&#39;T&#39;HH:mm:ssZ</code>。这是上面列出的两个插件的默认格式。使用此格式，可以将时间解析为<code>Date</code>，并将其序列化为 JSON 时的格式由 Jackson 的日期序列化配置设置控制。</p>
</blockquote>
<h2 id="自定义依赖关系版本"><a href="#自定义依赖关系版本" class="headerlink" title="自定义依赖关系版本"></a>自定义依赖关系版本</h2><p>如果您使用的 Maven 构建直接或间接继承自<code>spring-boot-dependencies</code>(例如<code>spring-boot-starter-parent</code>)，但是要覆盖特定的第三方依赖关系，则可以添加适当的<code>&lt;properties&gt;</code>元素。浏览<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-dependencies/pom.xml">spring-boot-dependencies</a> POM 以获取完整的属性列表。例如，要选择其他<code>slf4j</code>版本，您可以添加以下属性：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slf4j.version</span>&gt;</span>1.7.5<span class="tag">&lt;<span class="name">slf4j.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note</p>
<p>仅当您的 Maven 项目(直接或间接)继承<code>spring-boot-dependencies</code>时，此方法才有效。如果您在自己的<code>dependencyManagement</code>部分中使用<code>&lt;scope&gt;import&lt;/scope&gt;</code>添加了<code>spring-boot-dependencies</code>，则必须自己重新定义工件，而不是覆盖该属性。</p>
<p>Warning</p>
<p>每个 Spring Boot 版本都是针对这组特定的第三方依赖关系进行设计和测试的。覆盖版本可能会导致兼容性问题。</p>
<p>要覆盖 Gradle 中的依赖版本，请参阅 Gradle 插件文档中的<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/gradle-plugin/reference/html/#managing-dependencies-customizing">this section</a>。</p>
</blockquote>
<h2 id="使用Maven创建可执行-JAR"><a href="#使用Maven创建可执行-JAR" class="headerlink" title="使用Maven创建可执行 JAR"></a>使用Maven创建可执行 JAR</h2><p><code>spring-boot-maven-plugin</code>可用于创建可执行的“胖” JAR。如果使用<code>spring-boot-starter-parent</code> POM，则可以声明插件，然后将 jar 重新打包，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果您不使用父 POM，则仍然可以使用该插件。但是，您必须另外添加一个<code>&lt;executions&gt;</code>部分，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>有关完整用法的详细信息，请参见<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/maven-plugin/usage.html">plugin documentation</a>。</p>
<h2 id="使用SpringBoot应用程序作为依赖项"><a href="#使用SpringBoot应用程序作为依赖项" class="headerlink" title="使用SpringBoot应用程序作为依赖项"></a>使用SpringBoot应用程序作为依赖项</h2><p>像 war 文件一样，Spring Boot 应用程序也不打算用作依赖项。如果您的应用程序包含要与其他项目共享的类，则建议的方法是将该代码移到单独的模块中。然后，您的应用程序和其他项目可以依赖单独的模块。</p>
<p>如果您不能按照上面的建议重新排列代码，则必须配置 Spring Boot 的 Maven 和 Gradle 插件以生成一个单独的工件，该工件适合用作依赖项。可执行归档文件不能用作<code>BOOT-INF/classes</code>中的<a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-附录/#可执行jar格式">可执行 jar 格式</a>软件包应用程序类的依赖项。这意味着当将可执行 jar 用作依赖项时，找不到它们。</p>
<p>为了产生两个工件，一个可以用作依赖项，另一个可以执行，必须指定分类器。该分类器应用于可执行 Files 的名称，保留默认 Files 作为依赖项。</p>
<p>要在 Maven 中配置<code>exec</code>的分类器，可以使用以下配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">classifier</span>&gt;</span>exec<span class="tag">&lt;/<span class="name">classifier</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="运行可执行jar时提取特定的库"><a href="#运行可执行jar时提取特定的库" class="headerlink" title="运行可执行jar时提取特定的库"></a>运行可执行jar时提取特定的库</h2><p>可执行 jar 中的大多数嵌套库无需解压缩即可运行。但是，某些库可能会有问题。例如，JRuby 包括其自己的嵌套 jar 支持，它假定<code>jruby-complete.jar</code>始终可以直接作为文件直接使用。</p>
<p>为了处理任何有问题的库，您可以标记在可执行 jar 首次运行时应自动解压缩特定的嵌套 jar。这些嵌套的 jar 会写在<code>java.io.tmpdir</code>系统属性标识的临时目录下。</p>
<blockquote>
<p>Warning</p>
<p>应注意确保已配置 os，以便在应用程序仍在运行时不会删除已解压缩到临时目录中的 jar。</p>
</blockquote>
<p>例如，要指示应该使用 Maven 插件将 JRuby 标记为要解包，您可以添加以下配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">requiresUnpack</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jruby<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jruby-complete<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">requiresUnpack</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="创建带有排除项的不可执行的JAR"><a href="#创建带有排除项的不可执行的JAR" class="headerlink" title="创建带有排除项的不可执行的JAR"></a>创建带有排除项的不可执行的JAR</h2><p>通常，如果您具有一个可执行文件和一个不可执行的 jar 作为两个单独的构建产品，则可执行版本具有库 jar 中不需要的其他配置文件。例如，<code>application.yml</code>配置文件可能被排除在不可执行的 JAR 中。</p>
<p>在 Maven 中，可执行 jar 必须是主要工件，您可以为库添加一个分类的 jar，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-jar-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>lib<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">classifier</span>&gt;</span>lib<span class="tag">&lt;/<span class="name">classifier</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>application.yml<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="远程调试以Maven开头的SpringBoot应用程序"><a href="#远程调试以Maven开头的SpringBoot应用程序" class="headerlink" title="远程调试以Maven开头的SpringBoot应用程序"></a>远程调试以Maven开头的SpringBoot应用程序</h2><p>要将远程调试器附加到使用 Maven 启动的 Spring Boot 应用程序，可以使用<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/maven-plugin">maven plugin</a>的<code>jvmArguments</code>属性。</p>
<p>有关更多详细信息，请参见<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/maven-plugin/examples/run-debug.html">this example</a>。</p>
<h2 id="无需使用spring-boot-antlib就可以从Ant构建可执行存档"><a href="#无需使用spring-boot-antlib就可以从Ant构建可执行存档" class="headerlink" title="无需使用spring-boot-antlib就可以从Ant构建可执行存档"></a>无需使用spring-boot-antlib就可以从Ant构建可执行存档</h2><p>要使用 Ant 进行构建，您需要获取依赖项，进行编译，然后创建一个 jar 或 war 存档。要使其可执行，可以使用<code>spring-boot-antlib</code>模块，也可以按照以下说明进行操作：</p>
<ul>
<li>如果要构建 jar，请将应用程序的类和资源打包在嵌套的<code>BOOT-INF/classes</code>目录中。如果要发动 War，请照常将应用程序的类打包在嵌套的<code>WEB-INF/classes</code>目录中。</li>
<li>在 jar 的嵌套<code>BOOT-INF/lib</code>目录中或在 war 的<code>WEB-INF/lib</code>中添加运行时依赖项。记住不要压缩压缩 Files 中的条目。</li>
<li>在 jar 的嵌套<code>BOOT-INF/lib</code>目录中添加<code>provided</code>(嵌入式容器)依赖项，对于 War 则在<code>WEB-INF/lib-provided</code>中添加。记住不要压缩压缩 Files 中的条目。</li>
<li>在 Files 的根目录中添加<code>spring-boot-loader</code>类(以便<code>Main-Class</code>可用)。</li>
<li>使用适当的启动器(例如 jar 文件的<code>JarLauncher</code>)作为 Lists 中的<code>Main-Class</code>属性，并通过设置<code>Start-Class</code>属性来指定它作为 Lists 条目所需的其他属性。</li>
</ul>
<p>以下示例显示了如何使用 Ant 构建可执行归档文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">&quot;build&quot;</span> <span class="attr">depends</span>=<span class="string">&quot;compile&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jar</span> <span class="attr">destfile</span>=<span class="string">&quot;target/$&#123;ant.project.name&#125;-$&#123;spring-boot.version&#125;.jar&quot;</span> <span class="attr">compress</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mappedresources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileset</span> <span class="attr">dir</span>=<span class="string">&quot;target/classes&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">globmapper</span> <span class="attr">from</span>=<span class="string">&quot;*&quot;</span> <span class="attr">to</span>=<span class="string">&quot;BOOT-INF/classes/*&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mappedresources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mappedresources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileset</span> <span class="attr">dir</span>=<span class="string">&quot;src/main/resources&quot;</span> <span class="attr">erroronmissingdir</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">globmapper</span> <span class="attr">from</span>=<span class="string">&quot;*&quot;</span> <span class="attr">to</span>=<span class="string">&quot;BOOT-INF/classes/*&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mappedresources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mappedresources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileset</span> <span class="attr">dir</span>=<span class="string">&quot;$&#123;lib.dir&#125;/runtime&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">globmapper</span> <span class="attr">from</span>=<span class="string">&quot;*&quot;</span> <span class="attr">to</span>=<span class="string">&quot;BOOT-INF/lib/*&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mappedresources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">zipfileset</span> <span class="attr">src</span>=<span class="string">&quot;$&#123;lib.dir&#125;/loader/spring-boot-loader-jar-$&#123;spring-boot.version&#125;.jar&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">attribute</span> <span class="attr">name</span>=<span class="string">&quot;Main-Class&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.springframework.boot.loader.JarLauncher&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">attribute</span> <span class="attr">name</span>=<span class="string">&quot;Start-Class&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;start-class&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">jar</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples/spring-boot-sample-ant">Ant Sample</a>包含一个<code>build.xml</code>文件，该文件具有<code>manual</code>任务，如果使用以下命令运行该文件，该任务应该可以工作：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ant -lib <span class="tag">&lt;<span class="name">folder</span> <span class="attr">containing</span> <span class="attr">ivy-2.2.jar</span>&gt;</span> clean manual</span><br></pre></td></tr></table></figure>
<p>然后，您可以使用以下命令运行该应用程序：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar target/*.jar</span><br></pre></td></tr></table></figure>
<h1 id="传统部署"><a href="#传统部署" class="headerlink" title="传统部署"></a>传统部署</h1><p>Spring Boot 支持传统部署以及更现代的部署形式。本节回答有关传统部署的常见问题。</p>
<h2 id="创建可部署的War文件"><a href="#创建可部署的War文件" class="headerlink" title="创建可部署的War文件"></a>创建可部署的War文件</h2><blockquote>
<p>Warning</p>
<p>由于 Spring WebFlux 不严格依赖 Servlet API，并且默认情况下将应用程序部署在嵌入式 Reactor Netty 服务器上，因此 WebFlux 应用程序不支持 War 部署。</p>
</blockquote>
<p>生成可部署 war 文件的第一步是提供<code>SpringBootServletInitializer</code>子类并覆盖其<code>configure</code>方法。这样做利用了 Spring Framework 的 Servlet 3.0 支持，并允许您在由 Servlet 容器启动应用程序时对其进行配置。通常，应更新应用程序的主类以扩展<code>SpringBootServletInitializer</code>，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> <span class="keyword">extends</span> <span class="title">SpringBootServletInitializer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> SpringApplicationBuilder <span class="title">configure</span><span class="params">(SpringApplicationBuilder application)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> application.sources(Application.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下一步是更新构建配置，以使您的项目生成 war 文件而不是 jar 文件。如果您使用 Maven 和<code>spring-boot-starter-parent</code>(将为您配置 Maven 的 war 插件)，那么您所需要做的就是修改<code>pom.xml</code>以将包装更改为 war，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果使用 Gradle，则需要修改<code>build.gradle</code>，以将 war 插件应用于项目，如下所示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: <span class="string">&#x27;war&#x27;</span></span><br></pre></td></tr></table></figure>
<p>该过程的最后一步是确保嵌入式 servlet 容器不干扰 war 文件所部署到的 servlet 容器。为此，您需要将嵌入式 Servlet 容器依赖性标记为已提供。</p>
<p>如果使用 Maven，则以下示例将 servlet 容器(在本例中为 Tomcat)标记为已提供：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- … --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- … --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果使用 Gradle，则以下示例将 servlet 容器(在本例中为 Tomcat)标记为已提供：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    <span class="comment">// …</span></span><br><span class="line">    providedRuntime <span class="string">&#x27;org.springframework.boot:spring-boot-starter-tomcat&#x27;</span></span><br><span class="line">    <span class="comment">// …</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Tip</p>
<p><code>providedRuntime</code>比 Gradle 的<code>compileOnly</code>配置更可取。除其他限制外，<code>compileOnly</code>依赖项不在测试 Classpath 上，因此任何基于 Web 的集成测试都将失败。</p>
</blockquote>
<p>如果使用<a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-构建工具插件/">Spring Boot 构建工具</a>，则将嵌入式 servlet 容器的相关性标记为已提供将生成一个可执行的 war 文件，其中所提供的相关性打包在<code>lib-provided</code>目录中。这意味着，除了可以部署到 Servlet 容器之外，还可以通过在命令行上使用<code>java -jar</code>运行应用程序。</p>
<blockquote>
<p>Tip</p>
<p>查看 Spring Boot 的示例应用程序中先前配置的<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples/spring-boot-sample-traditional/pom.xml">Maven-based example</a>。</p>
</blockquote>
<h2 id="将现有应用程序转换为SpringBoot"><a href="#将现有应用程序转换为SpringBoot" class="headerlink" title="将现有应用程序转换为SpringBoot"></a>将现有应用程序转换为SpringBoot</h2><p>对于非 Web 应用程序，将现有的 Spring 应用程序转换为 Spring Boot 应用程序应该很容易。为此，请丢弃创建您的<code>ApplicationContext</code>的代码，并将其替换为对<code>SpringApplication</code>或<code>SpringApplicationBuilder</code>的调用。 Spring MVC Web 应用程序通常适合首先创建可部署的 war 应用程序，然后再将其迁移到可执行的 war 或 jar。参见<a target="_blank" rel="noopener" href="https://spring.io/guides/gs/convert-jar-to-war/">将Jar子转换为 War 的 Starter 指南</a>。</p>
<p>要通过扩展<code>SpringBootServletInitializer</code>(例如，在名为<code>Application</code>的类中)并添加 Spring Boot <code>@SpringBootApplication</code>Comments 来创建可部署的 War，请使用类似于以下示例中所示的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> <span class="keyword">extends</span> <span class="title">SpringBootServletInitializer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> SpringApplicationBuilder <span class="title">configure</span><span class="params">(SpringApplicationBuilder application)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Customize the application or call application.sources(...) to add sources</span></span><br><span class="line">        <span class="comment">// Since our example is itself a @Configuration class (via @SpringBootApplication)</span></span><br><span class="line">        <span class="comment">// we actually don&#x27;t need to override this method.</span></span><br><span class="line">        <span class="keyword">return</span> application;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>请记住，无论您 Importing<code>sources</code>只是一个 Spring <code>ApplicationContext</code>。通常，任何已经起作用的东西都应该在这里工作。可能有些 bean 可以稍后删除，然后让 Spring Boot 为它们提供自己的默认值，但是应该可以使某些东西工作，然后再执行此操作。</p>
<p>可以将静态资源移至 Classpath 根目录中的<code>/public</code>(或<code>/static</code>或<code>/resources</code>或<code>/META-INF/resources</code>)。 <code>messages.properties</code>同样适用(Spring Boot 会在 Classpath 的根目录中自动检测到)。</p>
<p>在 Spring <code>DispatcherServlet</code>和 Spring Security 上使用 Vanilla 不需要进一步更改。如果您的应用程序具有其他功能(例如，使用其他 servlet 或过滤器)，则可能需要通过替换<code>web.xml</code>中的那些元素来向<code>Application</code>上下文添加一些配置，如下所示：</p>
<ul>
<li>类型为<code>Servlet</code>或<code>ServletRegistrationBean</code>的<code>@Bean</code>将该 bean 安装在容器中，就好像它是<code>web.xml</code>中的<code>&lt;servlet/&gt;</code>和<code>&lt;servlet-mapping/&gt;</code>一样。</li>
<li><code>Filter</code>或<code>FilterRegistrationBean</code>类型的<code>@Bean</code>的行为类似(如<code>&lt;filter/&gt;</code>和<code>&lt;filter-mapping/&gt;</code>)。</li>
<li>可以通过<code>Application</code>中的<code>@ImportResource</code>添加 XML 文件中的<code>ApplicationContext</code>。或者，可以在几行中将<code>@Bean</code>定义重新创建已经大量使用 Comments 配置的简单情况。</li>
</ul>
<p>war 文件运行后，可以通过向<code>Application</code>添加<code>main</code>方法使其变为可执行文件，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    SpringApplication.run(Application.class, args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Note</p>
<p>如果您打算以 War 或可执行应用程序的形式启动应用程序，则需要使用<code>SpringBootServletInitializer</code>回调可用的方法和<code>main</code>方法中的类(类似于以下类)共享构建器的自定义项：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> <span class="keyword">extends</span> <span class="title">SpringBootServletInitializer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> SpringApplicationBuilder <span class="title">configure</span><span class="params">(SpringApplicationBuilder builder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> configureApplication(builder);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        configureApplication(<span class="keyword">new</span> SpringApplicationBuilder()).run(args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> SpringApplicationBuilder <span class="title">configureApplication</span><span class="params">(SpringApplicationBuilder builder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> builder.sources(Application.class).bannerMode(Banner.Mode.OFF);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>应用程序可以分为多个类别：</p>
<ul>
<li>没有<code>web.xml</code>的 Servlet 3.0 应用程序。</li>
<li>带有<code>web.xml</code>的应用程序。</li>
<li>具有上下文层次结构的应用程序。</li>
<li>没有上下文层次结构的应用程序。</li>
</ul>
<p>所有这些都应该适合翻译，但每种都可能需要稍微不同的技术。</p>
<p>如果 Servlet 3.0 应用程序已经使用了 Spring Servlet 3.0 初始化程序支持类，则它们可能很容易转换。通常，现有<code>WebApplicationInitializer</code>中的所有代码都可以移到<code>SpringBootServletInitializer</code>中。如果您现有的应用程序有多个<code>ApplicationContext</code>(例如，如果使用<code>AbstractDispatcherServletInitializer</code>)，则您可以将所有上下文源组合为一个<code>SpringApplication</code>。您可能遇到的主要并发症是，如果合并不起作用，并且您需要维护上下文层次结构。有关示例，请参见<a target="_blank" rel="noopener" href="https://route-nice.github.io/2020/08/31/SpringBoot官方文档翻译-使用方法指南/#构建ApplicationContext层次结构(添加父上下文或根上下文">构建层次结构的 Starter</a>)。通常需要分解包含特定于 Web 的功能的现有父上下文，以便所有<code>ServletContextAware</code>组件都位于子上下文中。</p>
<p>还不是 Spring 应用程序的应用程序可以转换为 Spring Boot 应用程序，前面提到的指南可能会有所帮助。但是，您可能仍然遇到问题。在这种情况下，我们建议<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/tagged/spring-boot">用 spring-boot 标签在 Stack Overflow 上提问</a>。</p>
<h2 id="将WAR部署到WebLogic"><a href="#将WAR部署到WebLogic" class="headerlink" title="将WAR部署到WebLogic"></a>将WAR部署到WebLogic</h2><p>要将 Spring Boot 应用程序部署到 WebLogic，必须确保 Servlet 初始化程序直接实现<code>WebApplicationInitializer</code>(即使您是从已经实现它的 Base Class 中扩展过来的)。</p>
<p>WebLogic 的典型初始化程序应类似于以下示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.support.SpringBootServletInitializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.WebApplicationInitializer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> <span class="keyword">extends</span> <span class="title">SpringBootServletInitializer</span> <span class="keyword">implements</span> <span class="title">WebApplicationInitializer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果使用 Logback，则还需要告诉 WebLogic 首选打包版本，而不是服务器预先安装的版本。您可以通过添加具有以下内容的<code>WEB-INF/weblogic.xml</code>文件来做到这一点：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">wls:weblogic-web-app</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:wls</span>=<span class="string">&quot;http://xmlns.oracle.com/weblogic/weblogic-web-app&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://java.sun.com/xml/ns/javaee/ejb-jar_3_0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://xmlns.oracle.com/weblogic/weblogic-web-app</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://xmlns.oracle.com/weblogic/weblogic-web-app/1.4/weblogic-web-app.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">wls:container-descriptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">wls:prefer-application-packages</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">wls:package-name</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">wls:package-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">wls:prefer-application-packages</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">wls:container-descriptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">wls:weblogic-web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="使用Jedis代替Lettuce"><a href="#使用Jedis代替Lettuce" class="headerlink" title="使用Jedis代替Lettuce"></a>使用Jedis代替Lettuce</h2><p>默认情况下，Spring Boot 启动器(<code>spring-boot-starter-data-redis</code>)使用<a target="_blank" rel="noopener" href="https://github.com/lettuce-io/lettuce-core/">Lettuce</a>。您需要排除该依赖性，而改为包含<a target="_blank" rel="noopener" href="https://github.com/xetorthio/jedis/">Jedis</a>个。 Spring Boot Management 这些依赖关系，以帮助简化此过程。</p>
<p>以下示例显示了如何在 Maven 中执行此操作：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.lettuce<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lettuce-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>以下示例显示了如何在 Gradle 中执行此操作：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">configurations &#123;</span><br><span class="line">    compile.exclude <span class="attr">module:</span> <span class="string">&quot;lettuce&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile(<span class="string">&quot;redis.clients:jedis&quot;</span>)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/SpringBoot/" rel="tag"># SpringBoot</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/08/31/SpringBoot%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91-%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7%E6%8F%92%E4%BB%B6/" rel="prev" title="SpringBoot官方文档翻译-构建工具插件">
      <i class="fa fa-chevron-left"></i> SpringBoot官方文档翻译-构建工具插件
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/08/31/SpringBoot%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91-%E9%99%84%E5%BD%95/" rel="next" title="SpringBoot官方文档翻译-附录">
      SpringBoot官方文档翻译-附录 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#SpringBoot%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">1.</span> <span class="nav-text">SpringBoot应用程序</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84FailureAnalyzer"><span class="nav-number">1.1.</span> <span class="nav-text">创建自己的FailureAnalyzer</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4"><span class="nav-number">1.2.</span> <span class="nav-text">自动配置故障排除</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8%E5%90%AF%E5%8A%A8%E7%8E%AF%E5%A2%83%E6%88%96ApplicationContext%E4%B9%8B%E5%89%8D%E5%AF%B9%E5%85%B6%E8%BF%9B%E8%A1%8C%E8%87%AA%E5%AE%9A%E4%B9%89"><span class="nav-number">1.3.</span> <span class="nav-text">在启动环境或ApplicationContext之前对其进行自定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9E%84%E5%BB%BAApplicationContext%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84-%E6%B7%BB%E5%8A%A0%E7%88%B6%E4%B8%8A%E4%B8%8B%E6%96%87%E6%88%96%E6%A0%B9%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="nav-number">1.4.</span> <span class="nav-text">构建ApplicationContext层次结构(添加父上下文或根上下文)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E9%9D%9EWeb%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">1.5.</span> <span class="nav-text">创建非Web应用程序</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B1%9E%E6%80%A7%E5%92%8C%E9%85%8D%E7%BD%AE"><span class="nav-number">2.</span> <span class="nav-text">属性和配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8%E6%9E%84%E5%BB%BA%E6%97%B6%E8%87%AA%E5%8A%A8%E6%89%A9%E5%B1%95%E5%B1%9E%E6%80%A7"><span class="nav-number">2.1.</span> <span class="nav-text">在构建时自动扩展属性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Maven%E8%87%AA%E5%8A%A8%E6%89%A9%E5%B1%95%E5%B1%9E%E6%80%A7"><span class="nav-number">2.1.1.</span> <span class="nav-text">使用Maven自动扩展属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Gradle%E8%87%AA%E5%8A%A8%E6%89%A9%E5%B1%95%E5%B1%9E%E6%80%A7"><span class="nav-number">2.1.2.</span> <span class="nav-text">使用Gradle自动扩展属性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%96%E9%83%A8%E5%8C%96SpringApplication%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-number">2.2.</span> <span class="nav-text">外部化SpringApplication的配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9B%B4%E6%94%B9%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%A4%96%E9%83%A8%E5%B1%9E%E6%80%A7%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="nav-number">2.3.</span> <span class="nav-text">更改应用程序外部属性的位置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E2%80%9C%E7%AE%80%E7%9F%AD%E2%80%9D%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0"><span class="nav-number">2.4.</span> <span class="nav-text">使用“简短”命令行参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%B9%E5%A4%96%E9%83%A8%E5%B1%9E%E6%80%A7%E4%BD%BF%E7%94%A8YAML"><span class="nav-number">2.5.</span> <span class="nav-text">对外部属性使用YAML</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AEActiveSpring%E8%BD%AE%E5%BB%93"><span class="nav-number">2.6.</span> <span class="nav-text">设置ActiveSpring轮廓</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%B9%E6%8D%AE%E7%8E%AF%E5%A2%83%E6%9B%B4%E6%94%B9%E9%85%8D%E7%BD%AE"><span class="nav-number">2.7.</span> <span class="nav-text">根据环境更改配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%91%E7%8E%B0%E5%A4%96%E9%83%A8%E5%B1%9E%E6%80%A7%E7%9A%84%E5%86%85%E7%BD%AE%E9%80%89%E9%A1%B9"><span class="nav-number">2.8.</span> <span class="nav-text">发现外部属性的内置选项</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B5%8C%E5%85%A5%E5%BC%8FWeb%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">3.</span> <span class="nav-text">嵌入式Web服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%85%B6%E4%BB%96Web%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">3.1.</span> <span class="nav-text">使用其他Web服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A6%81%E7%94%A8Web%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">3.2.</span> <span class="nav-text">禁用Web服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9B%B4%E6%94%B9HTTP%E7%AB%AF%E5%8F%A3"><span class="nav-number">3.3.</span> <span class="nav-text">更改HTTP端口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E9%9A%8F%E6%9C%BA%E6%9C%AA%E5%88%86%E9%85%8D%E7%9A%84HTTP%E7%AB%AF%E5%8F%A3"><span class="nav-number">3.4.</span> <span class="nav-text">使用随机未分配的HTTP端口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8%E8%BF%90%E8%A1%8C%E6%97%B6%E5%8F%91%E7%8E%B0HTTP%E7%AB%AF%E5%8F%A3"><span class="nav-number">3.5.</span> <span class="nav-text">在运行时发现HTTP端口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%AF%E7%94%A8HTTP%E5%93%8D%E5%BA%94%E5%8E%8B%E7%BC%A9"><span class="nav-number">3.6.</span> <span class="nav-text">启用HTTP响应压缩</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AESSL"><span class="nav-number">3.7.</span> <span class="nav-text">配置SSL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEHTTP-2"><span class="nav-number">3.8.</span> <span class="nav-text">配置HTTP&#x2F;2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B7%E6%9C%89Undertow%E7%9A%84HTTP-2"><span class="nav-number">3.8.1.</span> <span class="nav-text">具有Undertow的HTTP&#x2F;2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Jetty%E7%9A%84HTTP-2"><span class="nav-number">3.8.2.</span> <span class="nav-text">使用Jetty的HTTP&#x2F;2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%A6%E6%9C%89Tomcat%E7%9A%84HTTP-2"><span class="nav-number">3.8.3.</span> <span class="nav-text">带有Tomcat的HTTP&#x2F;2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B7%E6%9C%89ReactorNetty%E7%9A%84HTTP-2"><span class="nav-number">3.8.4.</span> <span class="nav-text">具有ReactorNetty的HTTP&#x2F;2</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEWeb%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">3.9.</span> <span class="nav-text">配置Web服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%86Servlet%EF%BC%8C%E8%BF%87%E6%BB%A4%E5%99%A8%E6%88%96%E4%BE%A6%E5%90%AC%E5%99%A8%E6%B7%BB%E5%8A%A0%E5%88%B0%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">3.10.</span> <span class="nav-text">将Servlet，过滤器或侦听器添加到应用程序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8SpringBean%E6%B7%BB%E5%8A%A0Servlet%EF%BC%8C%E8%BF%87%E6%BB%A4%E5%99%A8%E6%88%96%E4%BE%A6%E5%90%AC%E5%99%A8"><span class="nav-number">3.10.1.</span> <span class="nav-text">使用SpringBean添加Servlet，过滤器或侦听器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A6%81%E7%94%A8Servlet%E6%88%96%E8%BF%87%E6%BB%A4%E5%99%A8%E7%9A%84%E6%B3%A8%E5%86%8C"><span class="nav-number">3.10.1.1.</span> <span class="nav-text">禁用Servlet或过滤器的注册</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Classpath%E6%89%AB%E6%8F%8F%E6%B7%BB%E5%8A%A0Servlet%EF%BC%8C%E8%BF%87%E6%BB%A4%E5%99%A8%E5%92%8C%E4%BE%A6%E5%90%AC%E5%99%A8"><span class="nav-number">3.10.2.</span> <span class="nav-text">使用Classpath扫描添加Servlet，过滤器和侦听器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E8%AE%BF%E9%97%AE%E6%97%A5%E5%BF%97"><span class="nav-number">3.11.</span> <span class="nav-text">配置访问日志</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%8E%E9%9D%A2%E8%BF%90%E8%A1%8C"><span class="nav-number">3.12.</span> <span class="nav-text">在前端代理服务器后面运行</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89Tomcat%E7%9A%84%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE"><span class="nav-number">3.12.1.</span> <span class="nav-text">自定义Tomcat的代理配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Tomcat%E5%90%AF%E7%94%A8%E5%A4%9A%E4%B8%AA%E8%BF%9E%E6%8E%A5%E5%99%A8"><span class="nav-number">3.13.</span> <span class="nav-text">使用Tomcat启用多个连接器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Tomcat%E7%9A%84LegacyCookieProcessor"><span class="nav-number">3.14.</span> <span class="nav-text">使用Tomcat的LegacyCookieProcessor</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Undertow%E5%90%AF%E7%94%A8%E5%A4%9A%E4%B8%AA%E4%BE%A6%E5%90%AC%E5%99%A8"><span class="nav-number">3.15.</span> <span class="nav-text">使用Undertow启用多个侦听器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8ServerEndpoint%E6%B3%A8%E8%A7%A3%E5%88%9B%E5%BB%BAWebSocket%E7%AB%AF%E7%82%B9"><span class="nav-number">3.16.</span> <span class="nav-text">使用ServerEndpoint注解创建WebSocket端点</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SpringMVC"><span class="nav-number">4.</span> <span class="nav-text">SpringMVC</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%96%E5%86%99JSONREST%E6%9C%8D%E5%8A%A1"><span class="nav-number">4.1.</span> <span class="nav-text">编写JSONREST服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%96%E5%86%99XMLREST%E6%9C%8D%E5%8A%A1"><span class="nav-number">4.2.</span> <span class="nav-text">编写XMLREST服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89JacksonObjectMapper"><span class="nav-number">4.3.</span> <span class="nav-text">自定义JacksonObjectMapper</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89ResponseBody%E6%B3%A8%E8%A7%A3%E6%B8%B2%E6%9F%93"><span class="nav-number">4.4.</span> <span class="nav-text">自定义ResponseBody注解渲染</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E5%88%86%E6%AE%B5%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="nav-number">4.5.</span> <span class="nav-text">处理分段文件上传</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B3%E9%97%ADSpringMVCDispatcherServlet"><span class="nav-number">4.6.</span> <span class="nav-text">关闭SpringMVCDispatcherServlet</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B3%E9%97%AD%E9%BB%98%E8%AE%A4%E7%9A%84MVC%E9%85%8D%E7%BD%AE"><span class="nav-number">4.7.</span> <span class="nav-text">关闭默认的MVC配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89ViewResolvers"><span class="nav-number">4.8.</span> <span class="nav-text">自定义ViewResolvers</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8SpringSecurity%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95"><span class="nav-number">5.</span> <span class="nav-text">使用SpringSecurity进行测试</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Jersey"><span class="nav-number">6.</span> <span class="nav-text">Jersey</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8SpringSecurity%E7%9A%84%E5%AE%89%E5%85%A8Jersey%E7%AB%AF%E7%82%B9"><span class="nav-number">6.1.</span> <span class="nav-text">使用SpringSecurity的安全Jersey端点</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#HTTPClient%E7%AB%AF"><span class="nav-number">7.</span> <span class="nav-text">HTTPClient端</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AERestTemplate%E4%BB%A5%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86"><span class="nav-number">7.1.</span> <span class="nav-text">配置RestTemplate以使用代理</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Logging"><span class="nav-number">8.</span> <span class="nav-text">Logging</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%E7%9A%84%E6%97%A5%E5%BF%97%E5%9B%9E%E4%BC%A0"><span class="nav-number">8.1.</span> <span class="nav-text">配置日志记录的日志回传</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%85%E6%96%87%E4%BB%B6%E8%BE%93%E5%87%BA%E9%85%8D%E7%BD%AELogback"><span class="nav-number">8.1.1.</span> <span class="nav-text">为仅文件输出配置Logback</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AELog4j%E8%BF%9B%E8%A1%8C%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95"><span class="nav-number">8.2.</span> <span class="nav-text">配置Log4j进行日志记录</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8YAML%E6%88%96JSON%E9%85%8D%E7%BD%AELog4j-2"><span class="nav-number">8.2.1.</span> <span class="nav-text">使用YAML或JSON配置Log4j 2</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE"><span class="nav-number">9.</span> <span class="nav-text">数据访问</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="nav-number">9.1.</span> <span class="nav-text">配置自定义数据源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E4%B8%A4%E4%B8%AA%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="nav-number">9.2.</span> <span class="nav-text">配置两个数据源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Spring%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E5%BA%93"><span class="nav-number">9.3.</span> <span class="nav-text">使用Spring数据存储库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%86Entity%E6%B3%A8%E8%A7%A3%E5%AE%9A%E4%B9%89%E4%B8%8ESpring%E9%85%8D%E7%BD%AE%E5%88%86%E5%BC%80"><span class="nav-number">9.4.</span> <span class="nav-text">将Entity注解定义与Spring配置分开</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEJPA%E5%B1%9E%E6%80%A7"><span class="nav-number">9.5.</span> <span class="nav-text">配置JPA属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEHibernate%E5%91%BD%E5%90%8D%E7%AD%96%E7%95%A5"><span class="nav-number">9.6.</span> <span class="nav-text">配置Hibernate命名策略</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEHibernate%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="nav-number">9.7.</span> <span class="nav-text">配置Hibernate二级缓存</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8Hibernate%E7%BB%84%E4%BB%B6%E4%B8%AD%E4%BD%BF%E7%94%A8%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"><span class="nav-number">9.8.</span> <span class="nav-text">在Hibernate组件中使用依赖注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89EntityManagerFactory"><span class="nav-number">9.9.</span> <span class="nav-text">使用自定义EntityManagerFactory</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E4%B8%A4%E4%B8%AAEntityManager"><span class="nav-number">9.10.</span> <span class="nav-text">使用两个EntityManager</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E4%BC%A0%E7%BB%9F%E7%9A%84persistence-xml%E6%96%87%E4%BB%B6"><span class="nav-number">9.11.</span> <span class="nav-text">使用传统的persistence.xml文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8SpringDataJPA%E5%92%8CMongo%E5%AD%98%E5%82%A8%E5%BA%93"><span class="nav-number">9.12.</span> <span class="nav-text">使用SpringDataJPA和Mongo存储库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89SpringData%E7%9A%84Web-%E6%94%AF%E6%8C%81"><span class="nav-number">9.13.</span> <span class="nav-text">自定义SpringData的Web 支持</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%86Spring%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E5%BA%93%E5%85%AC%E5%BC%80%E4%B8%BA-REST-%E7%AB%AF%E7%82%B9"><span class="nav-number">9.14.</span> <span class="nav-text">将Spring数据存储库公开为 REST 端点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEJPA%E4%BD%BF%E7%94%A8%E7%9A%84%E7%BB%84%E4%BB%B6"><span class="nav-number">9.15.</span> <span class="nav-text">配置JPA使用的组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E4%B8%A4%E4%B8%AA%E6%95%B0%E6%8D%AE%E6%BA%90%E9%85%8D%E7%BD%AEjOOQ"><span class="nav-number">9.16.</span> <span class="nav-text">使用两个数据源配置jOOQ</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">10.</span> <span class="nav-text">初始化数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8JPA%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">10.1.</span> <span class="nav-text">使用JPA初始化数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Hibernate%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">10.2.</span> <span class="nav-text">使用Hibernate初始化数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93-1"><span class="nav-number">10.3.</span> <span class="nav-text">初始化数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96SpringBatch%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">10.4.</span> <span class="nav-text">初始化SpringBatch数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%9B%B4%E9%AB%98%E7%BA%A7%E5%88%AB%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%81%E7%A7%BB%E5%B7%A5%E5%85%B7"><span class="nav-number">10.5.</span> <span class="nav-text">使用更高级别的数据库迁移工具</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8%E5%90%AF%E5%8A%A8%E6%97%B6%E6%89%A7%E8%A1%8CFlyway%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%81%E7%A7%BB"><span class="nav-number">10.5.1.</span> <span class="nav-text">在启动时执行Flyway数据库迁移</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8%E5%90%AF%E5%8A%A8%E6%97%B6%E6%89%A7%E8%A1%8CLiquibase%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%81%E7%A7%BB"><span class="nav-number">10.5.2.</span> <span class="nav-text">在启动时执行Liquibase数据库迁移</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Messaging"><span class="nav-number">11.</span> <span class="nav-text">Messaging</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A6%81%E7%94%A8%E4%BA%8B%E5%8A%A1JMS%E4%BC%9A%E8%AF%9D"><span class="nav-number">11.1.</span> <span class="nav-text">禁用事务JMS会话</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%89%B9%E5%A4%84%E7%90%86%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">12.</span> <span class="nav-text">批处理应用程序</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8%E5%90%AF%E5%8A%A8%E6%97%B6%E6%89%A7%E8%A1%8CSpringBatch%E4%BD%9C%E4%B8%9A"><span class="nav-number">12.1.</span> <span class="nav-text">在启动时执行SpringBatch作业</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Actuator"><span class="nav-number">13.</span> <span class="nav-text">Actuator</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9B%B4%E6%94%B9Actuator%E7%AB%AF%E7%82%B9%E7%9A%84HTTP%E7%AB%AF%E5%8F%A3%E6%88%96%E5%9C%B0%E5%9D%80"><span class="nav-number">13.1.</span> <span class="nav-text">更改Actuator端点的HTTP端口或地址</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E2%80%9C-whitelabel%E2%80%9D%E9%94%99%E8%AF%AF%E9%A1%B5%E9%9D%A2"><span class="nav-number">13.2.</span> <span class="nav-text">自定义“ whitelabel”错误页面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B8%85%E7%90%86%E5%90%88%E7%90%86%E7%9A%84%E5%80%BC"><span class="nav-number">13.3.</span> <span class="nav-text">清理合理的值</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Security"><span class="nav-number">14.</span> <span class="nav-text">Security</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B3%E9%97%ADSpringBoot%E5%AE%89%E5%85%A8%E6%80%A7%E9%85%8D%E7%BD%AE"><span class="nav-number">14.1.</span> <span class="nav-text">关闭SpringBoot安全性配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9B%B4%E6%94%B9UserDetailsService%E5%B9%B6%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7%E5%B8%90%E6%88%B7"><span class="nav-number">14.2.</span> <span class="nav-text">更改UserDetailsService并添加用户帐户</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8C%E6%97%B6%E5%90%AF%E7%94%A8HTTPS"><span class="nav-number">14.3.</span> <span class="nav-text">在代理服务器上运行时启用HTTPS</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Hot-Swapping"><span class="nav-number">15.</span> <span class="nav-text">Hot Swapping</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%87%8D%E6%96%B0%E5%8A%A0%E8%BD%BD%E9%9D%99%E6%80%81%E5%86%85%E5%AE%B9"><span class="nav-number">15.1.</span> <span class="nav-text">重新加载静态内容</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%87%8D%E6%96%B0%E5%8A%A0%E8%BD%BD%E6%A8%A1%E6%9D%BF%EF%BC%8C%E8%80%8C%E6%97%A0%E9%9C%80%E9%87%8D%E6%96%B0%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8"><span class="nav-number">15.2.</span> <span class="nav-text">重新加载模板，而无需重新启动容器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Thymeleaf%E6%A8%A1%E6%9D%BF"><span class="nav-number">15.2.1.</span> <span class="nav-text">Thymeleaf模板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FreeMarker%E6%A8%A1%E6%9D%BF"><span class="nav-number">15.2.2.</span> <span class="nav-text">FreeMarker模板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Groovy%E6%A8%A1%E6%9D%BF"><span class="nav-number">15.2.3.</span> <span class="nav-text">Groovy模板</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BF%AB%E9%80%9F%E5%90%AF%E5%8A%A8%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">15.3.</span> <span class="nav-text">快速启动应用程序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%A0%E9%9C%80%E9%87%8D%E6%96%B0%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8%E5%8D%B3%E5%8F%AF%E9%87%8D%E6%96%B0%E5%8A%A0%E8%BD%BDJava%E7%B1%BB"><span class="nav-number">15.4.</span> <span class="nav-text">无需重新启动容器即可重新加载Java类</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Build"><span class="nav-number">16.</span> <span class="nav-text">Build</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E5%86%85%E9%83%A8%E7%89%88%E6%9C%AC%E4%BF%A1%E6%81%AF"><span class="nav-number">16.1.</span> <span class="nav-text">生成内部版本信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E6%88%90Git%E4%BF%A1%E6%81%AF"><span class="nav-number">16.2.</span> <span class="nav-text">生成Git信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB%E7%89%88%E6%9C%AC"><span class="nav-number">16.3.</span> <span class="nav-text">自定义依赖关系版本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Maven%E5%88%9B%E5%BB%BA%E5%8F%AF%E6%89%A7%E8%A1%8C-JAR"><span class="nav-number">16.4.</span> <span class="nav-text">使用Maven创建可执行 JAR</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8SpringBoot%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E4%BD%9C%E4%B8%BA%E4%BE%9D%E8%B5%96%E9%A1%B9"><span class="nav-number">16.5.</span> <span class="nav-text">使用SpringBoot应用程序作为依赖项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E5%8F%AF%E6%89%A7%E8%A1%8Cjar%E6%97%B6%E6%8F%90%E5%8F%96%E7%89%B9%E5%AE%9A%E7%9A%84%E5%BA%93"><span class="nav-number">16.6.</span> <span class="nav-text">运行可执行jar时提取特定的库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%B8%A6%E6%9C%89%E6%8E%92%E9%99%A4%E9%A1%B9%E7%9A%84%E4%B8%8D%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%9A%84JAR"><span class="nav-number">16.7.</span> <span class="nav-text">创建带有排除项的不可执行的JAR</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95%E4%BB%A5Maven%E5%BC%80%E5%A4%B4%E7%9A%84SpringBoot%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">16.8.</span> <span class="nav-text">远程调试以Maven开头的SpringBoot应用程序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%A0%E9%9C%80%E4%BD%BF%E7%94%A8spring-boot-antlib%E5%B0%B1%E5%8F%AF%E4%BB%A5%E4%BB%8EAnt%E6%9E%84%E5%BB%BA%E5%8F%AF%E6%89%A7%E8%A1%8C%E5%AD%98%E6%A1%A3"><span class="nav-number">16.9.</span> <span class="nav-text">无需使用spring-boot-antlib就可以从Ant构建可执行存档</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BC%A0%E7%BB%9F%E9%83%A8%E7%BD%B2"><span class="nav-number">17.</span> <span class="nav-text">传统部署</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%8F%AF%E9%83%A8%E7%BD%B2%E7%9A%84War%E6%96%87%E4%BB%B6"><span class="nav-number">17.1.</span> <span class="nav-text">创建可部署的War文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%86%E7%8E%B0%E6%9C%89%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%BD%AC%E6%8D%A2%E4%B8%BASpringBoot"><span class="nav-number">17.2.</span> <span class="nav-text">将现有应用程序转换为SpringBoot</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%86WAR%E9%83%A8%E7%BD%B2%E5%88%B0WebLogic"><span class="nav-number">17.3.</span> <span class="nav-text">将WAR部署到WebLogic</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Jedis%E4%BB%A3%E6%9B%BFLettuce"><span class="nav-number">17.4.</span> <span class="nav-text">使用Jedis代替Lettuce</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Route-nice"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Route-nice</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">25</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/route-nice" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;route-nice" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:route.lvy.roman@gmail.com" title="E-Mail → mailto:route.lvy.roman@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Route-nice</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://route-nice.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "http://yoursite.com/2020/08/31/SpringBoot%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91-%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E6%8C%87%E5%8D%97/";
    this.page.identifier = "2020/08/31/SpringBoot官方文档翻译-使用方法指南/";
    this.page.title = "SpringBoot官方文档翻译-使用方法指南";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://route-nice.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

</body>
</html>
